!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=127)}([function(t,e,n){var i=n(2),r=n(8),o=n(15),s=n(12),a=n(18),l=function(t,e,n){var u,h,c,f,d=t&l.F,p=t&l.G,g=t&l.S,m=t&l.P,v=t&l.B,y=p?i:g?i[e]||(i[e]={}):(i[e]||{}).prototype,b=p?r:r[e]||(r[e]={}),_=b.prototype||(b.prototype={});for(u in p&&(n=e),n)c=((h=!d&&y&&void 0!==y[u])?y:n)[u],f=v&&h?a(c,i):m&&"function"==typeof c?a(Function.call,c):c,y&&s(y,u,c,t&l.U),b[u]!=c&&o(b,u,f),m&&_[u]!=c&&(_[u]=c)};i.core=r,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e,n){"use strict";const i=2.3283064365386963e-10;class r{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*i,t=69069*t+1>>>0,this._s1=t*i,t=69069*t+1>>>0,this._s2=t*i,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*i;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let n=Math.max(t,e),i=Math.min(t,e);return Math.floor(this.getUniform()*(n-i+1))+i}getNormal(t=0,e=1){let n,i,r;do{n=2*this.getUniform()-1,i=2*this.getUniform()-1,r=n*n+i*i}while(r>1||0==r);return t+n*Math.sqrt(-2*Math.log(r)/r)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],n=t.slice();for(;n.length;){let t=n.indexOf(this.getItem(n));e.push(n.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let n in t)e+=t[n];let n,i=this.getUniform()*e,r=0;for(n in t)if(r+=t[n],i<r)return n;return n}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new r).setState(this.getState())}}e.a=(new r).setSeed(Date.now())},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){var i=n(5);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var i=n(52)("wks"),r=n(32),o=n(2).Symbol,s="function"==typeof o;(t.exports=function(t){return i[t]||(i[t]=s&&o[t]||(s?o:r)("Symbol."+t))}).store=i},function(t,e,n){var i=n(20),r=Math.min;t.exports=function(t){return t>0?r(i(t),9007199254740991):0}},function(t,e){var n=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(t,e,n){t.exports=!n(3)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e,n){var i=n(4),r=n(94),o=n(29),s=Object.defineProperty;e.f=n(9)?Object.defineProperty:function(t,e,n){if(i(t),e=o(e,!0),i(n),r)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var i=n(26);t.exports=function(t){return Object(i(t))}},function(t,e,n){var i=n(2),r=n(15),o=n(14),s=n(32)("src"),a=n(132),l=(""+a).split("toString");n(8).inspectSource=function(t){return a.call(t)},(t.exports=function(t,e,n,a){var u="function"==typeof n;u&&(o(n,"name")||r(n,"name",e)),t[e]!==n&&(u&&(o(n,s)||r(n,s,t[e]?""+t[e]:l.join(String(e)))),t===i?t[e]=n:a?t[e]?t[e]=n:r(t,e,n):(delete t[e],r(t,e,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[s]||a.call(this)}))},function(t,e,n){var i=n(0),r=n(3),o=n(26),s=/"/g,a=function(t,e,n,i){var r=String(o(t)),a="<"+e;return""!==n&&(a+=" "+n+'="'+String(i).replace(s,"&quot;")+'"'),a+">"+r+"</"+e+">"};t.exports=function(t,e){var n={};n[t]=e(a),i(i.P+i.F*r((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",n)}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var i=n(10),r=n(31);t.exports=n(9)?function(t,e,n){return i.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var i=n(48),r=n(26);t.exports=function(t){return i(r(t))}},function(t,e,n){"use strict";var i=n(3);t.exports=function(t,e){return!!t&&i((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},function(t,e,n){var i=n(19);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:n)(t)}},function(t,e,n){var i=n(49),r=n(31),o=n(16),s=n(29),a=n(14),l=n(94),u=Object.getOwnPropertyDescriptor;e.f=n(9)?u:function(t,e){if(t=o(t),e=s(e,!0),l)try{return u(t,e)}catch(t){}if(a(t,e))return r(!i.f.call(t,e),t[e])}},function(t,e,n){var i=n(0),r=n(8),o=n(3);t.exports=function(t,e){var n=(r.Object||{})[t]||Object[t],s={};s[t]=e(n),i(i.S+i.F*o((function(){n(1)})),"Object",s)}},function(t,e,n){var i=n(18),r=n(48),o=n(11),s=n(7),a=n(110);t.exports=function(t,e){var n=1==t,l=2==t,u=3==t,h=4==t,c=6==t,f=5==t||c,d=e||a;return function(e,a,p){for(var g,m,v=o(e),y=r(v),b=i(a,p,3),_=s(y.length),S=0,w=n?d(e,_):l?d(e,0):void 0;_>S;S++)if((f||S in y)&&(m=b(g=y[S],S,v),t))if(n)w[S]=m;else if(m)switch(t){case 3:return!0;case 5:return g;case 6:return S;case 2:w.push(g)}else if(h)return!1;return c?-1:u||h?h:w}}},function(t,e,n){"use strict";function i(t,e){return(t%e+e)%e}function r(t,e=0,n=1){return t<e?e:t>n?n:t}function o(t){return t.charAt(0).toUpperCase()+t.substring(1)}function s(t,...e){let n=s.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(i,r,s,a){if("%"==t.charAt(a-1))return i.substring(1);if(!e.length)return i;let l=e[0],u=(r||s).split(","),h=u.shift()||"",c=n[h.toLowerCase()];if(!c)return i;l=e.shift();let f=l[c].apply(l,u),d=h.charAt(0);return d!=d.toLowerCase()&&(f=o(f)),f}))}n.r(e),n.d(e,"mod",(function(){return i})),n.d(e,"clamp",(function(){return r})),n.d(e,"capitalize",(function(){return o})),n.d(e,"format",(function(){return s})),s.map={s:"toString"}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){"use strict";if(n(9)){var i=n(33),r=n(2),o=n(3),s=n(0),a=n(63),l=n(88),u=n(18),h=n(45),c=n(31),f=n(15),d=n(46),p=n(20),g=n(7),m=n(121),v=n(35),y=n(29),b=n(14),_=n(50),S=n(5),w=n(11),x=n(80),C=n(36),N=n(38),T=n(37).f,k=n(82),E=n(32),P=n(6),O=n(23),I=n(53),A=n(51),F=n(84),W=n(43),M=n(56),R=n(44),L=n(83),j=n(112),G=n(10),V=n(21),D=G.f,U=V.f,B=r.RangeError,z=r.TypeError,q=r.Uint8Array,H=Array.prototype,Y=l.ArrayBuffer,X=l.DataView,K=O(0),J=O(2),$=O(3),Q=O(4),Z=O(5),tt=O(6),et=I(!0),nt=I(!1),it=F.values,rt=F.keys,ot=F.entries,st=H.lastIndexOf,at=H.reduce,lt=H.reduceRight,ut=H.join,ht=H.sort,ct=H.slice,ft=H.toString,dt=H.toLocaleString,pt=P("iterator"),gt=P("toStringTag"),mt=E("typed_constructor"),vt=E("def_constructor"),yt=a.CONSTR,bt=a.TYPED,_t=a.VIEW,St=O(1,(function(t,e){return Tt(A(t,t[vt]),e)})),wt=o((function(){return 1===new q(new Uint16Array([1]).buffer)[0]})),xt=!!q&&!!q.prototype.set&&o((function(){new q(1).set({})})),Ct=function(t,e){var n=p(t);if(n<0||n%e)throw B("Wrong offset!");return n},Nt=function(t){if(S(t)&&bt in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,e){if(!S(t)||!(mt in t))throw z("It is not a typed array constructor!");return new t(e)},kt=function(t,e){return Et(A(t,t[vt]),e)},Et=function(t,e){for(var n=0,i=e.length,r=Tt(t,i);i>n;)r[n]=e[n++];return r},Pt=function(t,e,n){D(t,e,{get:function(){return this._d[n]}})},Ot=function(t){var e,n,i,r,o,s,a=w(t),l=arguments.length,h=l>1?arguments[1]:void 0,c=void 0!==h,f=k(a);if(null!=f&&!x(f)){for(s=f.call(a),i=[],e=0;!(o=s.next()).done;e++)i.push(o.value);a=i}for(c&&l>2&&(h=u(h,arguments[2],2)),e=0,n=g(a.length),r=Tt(this,n);n>e;e++)r[e]=c?h(a[e],e):a[e];return r},It=function(){for(var t=0,e=arguments.length,n=Tt(this,e);e>t;)n[t]=arguments[t++];return n},At=!!q&&o((function(){dt.call(new q(1))})),Ft=function(){return dt.apply(At?ct.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,e){return j.call(Nt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return Q(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return L.apply(Nt(this),arguments)},filter:function(t){return kt(this,J(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){K(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ut.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return St(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return at.apply(Nt(this),arguments)},reduceRight:function(t){return lt.apply(Nt(this),arguments)},reverse:function(){for(var t,e=Nt(this).length,n=Math.floor(e/2),i=0;i<n;)t=this[i],this[i++]=this[--e],this[e]=t;return this},some:function(t){return $(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return ht.call(Nt(this),t)},subarray:function(t,e){var n=Nt(this),i=n.length,r=v(t,i);return new(A(n,n[vt]))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,g((void 0===e?i:v(e,i))-r))}},Mt=function(t,e){return kt(this,ct.call(Nt(this),t,e))},Rt=function(t){Nt(this);var e=Ct(arguments[1],1),n=this.length,i=w(t),r=g(i.length),o=0;if(r+e>n)throw B("Wrong length!");for(;o<r;)this[e+o]=i[o++]},Lt={entries:function(){return ot.call(Nt(this))},keys:function(){return rt.call(Nt(this))},values:function(){return it.call(Nt(this))}},jt=function(t,e){return S(t)&&t[bt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Gt=function(t,e){return jt(t,e=y(e,!0))?c(2,t[e]):U(t,e)},Vt=function(t,e,n){return!(jt(t,e=y(e,!0))&&S(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?D(t,e,n):(t[e]=n.value,t)};yt||(V.f=Gt,G.f=Vt),s(s.S+s.F*!yt,"Object",{getOwnPropertyDescriptor:Gt,defineProperty:Vt}),o((function(){ft.call({})}))&&(ft=dt=function(){return ut.call(this)});var Dt=d({},Wt);d(Dt,Lt),f(Dt,pt,Lt.values),d(Dt,{slice:Mt,set:Rt,constructor:function(){},toString:ft,toLocaleString:Ft}),Pt(Dt,"buffer","b"),Pt(Dt,"byteOffset","o"),Pt(Dt,"byteLength","l"),Pt(Dt,"length","e"),D(Dt,gt,{get:function(){return this[bt]}}),t.exports=function(t,e,n,l){var u=t+((l=!!l)?"Clamped":"")+"Array",c="get"+t,d="set"+t,p=r[u],v=p||{},y=p&&N(p),b=!p||!a.ABV,w={},x=p&&p.prototype,k=function(t,n){D(t,n,{get:function(){return function(t,n){var i=t._d;return i.v[c](n*e+i.o,wt)}(this,n)},set:function(t){return function(t,n,i){var r=t._d;l&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),r.v[d](n*e+r.o,i,wt)}(this,n,t)},enumerable:!0})};b?(p=n((function(t,n,i,r){h(t,p,u,"_d");var o,s,a,l,c=0,d=0;if(S(n)){if(!(n instanceof Y||"ArrayBuffer"==(l=_(n))||"SharedArrayBuffer"==l))return bt in n?Et(p,n):Ot.call(p,n);o=n,d=Ct(i,e);var v=n.byteLength;if(void 0===r){if(v%e)throw B("Wrong length!");if((s=v-d)<0)throw B("Wrong length!")}else if((s=g(r)*e)+d>v)throw B("Wrong length!");a=s/e}else a=m(n),o=new Y(s=a*e);for(f(t,"_d",{b:o,o:d,l:s,e:a,v:new X(o)});c<a;)k(t,c++)})),x=p.prototype=C(Dt),f(x,"constructor",p)):o((function(){p(1)}))&&o((function(){new p(-1)}))&&M((function(t){new p,new p(null),new p(1.5),new p(t)}),!0)||(p=n((function(t,n,i,r){var o;return h(t,p,u),S(n)?n instanceof Y||"ArrayBuffer"==(o=_(n))||"SharedArrayBuffer"==o?void 0!==r?new v(n,Ct(i,e),r):void 0!==i?new v(n,Ct(i,e)):new v(n):bt in n?Et(p,n):Ot.call(p,n):new v(m(n))})),K(y!==Function.prototype?T(v).concat(T(y)):T(v),(function(t){t in p||f(p,t,v[t])})),p.prototype=x,i||(x.constructor=p));var E=x[pt],P=!!E&&("values"==E.name||null==E.name),O=Lt.values;f(p,mt,!0),f(x,bt,u),f(x,_t,!0),f(x,vt,p),(l?new p(1)[gt]==u:gt in x)||D(x,gt,{get:function(){return u}}),w[u]=p,s(s.G+s.W+s.F*(p!=v),w),s(s.S,u,{BYTES_PER_ELEMENT:e}),s(s.S+s.F*o((function(){v.of.call(p,1)})),u,{from:Ot,of:It}),"BYTES_PER_ELEMENT"in x||f(x,"BYTES_PER_ELEMENT",e),s(s.P,u,Wt),R(u),s(s.P+s.F*xt,u,{set:Rt}),s(s.P+s.F*!P,u,Lt),i||x.toString==ft||(x.toString=ft),s(s.P+s.F*o((function(){new p(1).slice()})),u,{slice:Mt}),s(s.P+s.F*(o((function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()}))||!o((function(){x.toLocaleString.call([1,2])}))),u,{toLocaleString:Ft}),W[u]=P?E:O,i||P||f(x,pt,O)}}else t.exports=function(){}},function(t,e,n){"use strict";n.r(e),n.d(e,"fromString",(function(){return o})),n.d(e,"add",(function(){return s})),n.d(e,"add_",(function(){return a})),n.d(e,"multiply",(function(){return l})),n.d(e,"multiply_",(function(){return u})),n.d(e,"interpolate",(function(){return h})),n.d(e,"lerp",(function(){return c})),n.d(e,"interpolateHSL",(function(){return f})),n.d(e,"lerpHSL",(function(){return d})),n.d(e,"randomize",(function(){return p})),n.d(e,"rgb2hsl",(function(){return g})),n.d(e,"hsl2rgb",(function(){return v})),n.d(e,"toRGB",(function(){return y})),n.d(e,"toHex",(function(){return b}));var i=n(24),r=n(1);function o(t){let e,n;if(t in _)e=_[t];else{if("#"==t.charAt(0)){let n=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==n.length)e=n.map(t=>17*t);else{for(let t=0;t<3;t++)n[t+1]+=16*n[t],n.splice(t,1);e=n}}else e=(n=t.match(/rgb\(([0-9, ]+)\)/i))?n[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];_[t]=e}return e.slice()}function s(t,...e){let n=t.slice();for(let t=0;t<3;t++)for(let i=0;i<e.length;i++)n[t]+=e[i][t];return n}function a(t,...e){for(let n=0;n<3;n++)for(let i=0;i<e.length;i++)t[n]+=e[i][n];return t}function l(t,...e){let n=t.slice();for(let t=0;t<3;t++){for(let i=0;i<e.length;i++)n[t]*=e[i][t]/255;n[t]=Math.round(n[t])}return n}function u(t,...e){for(let n=0;n<3;n++){for(let i=0;i<e.length;i++)t[n]*=e[i][n]/255;t[n]=Math.round(t[n])}return t}function h(t,e,n=.5){let i=t.slice();for(let r=0;r<3;r++)i[r]=Math.round(i[r]+n*(e[r]-t[r]));return i}const c=h;function f(t,e,n=.5){let i=g(t),r=g(e);for(let t=0;t<3;t++)i[t]+=n*(r[t]-i[t]);return v(i)}const d=f;function p(t,e){e instanceof Array||(e=Math.round(r.a.getNormal(0,e)));let n=t.slice();for(let t=0;t<3;t++)n[t]+=e instanceof Array?Math.round(r.a.getNormal(0,e[t])):e;return n}function g(t){let e,n=t[0]/255,i=t[1]/255,r=t[2]/255,o=Math.max(n,i,r),s=Math.min(n,i,r),a=0,l=(o+s)/2;if(o==s)e=0;else{let t=o-s;switch(e=l>.5?t/(2-o-s):t/(o+s),o){case n:a=(i-r)/t+(i<r?6:0);break;case i:a=(r-n)/t+2;break;case r:a=(n-i)/t+4}a/=6}return[a,e,l]}function m(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function v(t){let e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];{let n=t[1],i=e<.5?e*(1+n):e+n-e*n,r=2*e-i,o=m(r,i,t[0]+1/3),s=m(r,i,t[0]),a=m(r,i,t[0]-1/3);return[Math.round(255*o),Math.round(255*s),Math.round(255*a)]}}function y(t){return`rgb(${t.map(t=>Object(i.clamp)(t,0,255)).join(",")})`}function b(t){return"#"+t.map(t=>Object(i.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}const _={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e,n){var i=n(5);t.exports=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var i=n(32)("meta"),r=n(5),o=n(14),s=n(10).f,a=0,l=Object.isExtensible||function(){return!0},u=!n(3)((function(){return l(Object.preventExtensions({}))})),h=function(t){s(t,i,{value:{i:"O"+ ++a,w:{}}})},c=t.exports={KEY:i,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,i)){if(!l(t))return"F";if(!e)return"E";h(t)}return t[i].i},getWeak:function(t,e){if(!o(t,i)){if(!l(t))return!0;if(!e)return!1;h(t)}return t[i].w},onFreeze:function(t){return u&&c.NEED&&l(t)&&!o(t,i)&&h(t),t}}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e){t.exports=!1},function(t,e,n){var i=n(96),r=n(67);t.exports=Object.keys||function(t){return i(t,r)}},function(t,e,n){var i=n(20),r=Math.max,o=Math.min;t.exports=function(t,e){return(t=i(t))<0?r(t+e,0):o(t,e)}},function(t,e,n){var i=n(4),r=n(97),o=n(67),s=n(66)("IE_PROTO"),a=function(){},l=function(){var t,e=n(64)("iframe"),i=o.length;for(e.style.display="none",n(68).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;i--;)delete l.prototype[o[i]];return l()};t.exports=Object.create||function(t,e){var n;return null!==t?(a.prototype=i(t),n=new a,a.prototype=null,n[s]=t):n=l(),void 0===e?n:r(n,e)}},function(t,e,n){var i=n(96),r=n(67).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,r)}},function(t,e,n){var i=n(14),r=n(11),o=n(66)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),i(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e,n){var i=n(6)("unscopables"),r=Array.prototype;null==r[i]&&n(15)(r,i,{}),t.exports=function(t){r[i][t]=!0}},function(t,e,n){var i=n(5);t.exports=function(t,e){if(!i(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,n){var i=n(10).f,r=n(14),o=n(6)("toStringTag");t.exports=function(t,e,n){t&&!r(t=n?t:t.prototype,o)&&i(t,o,{configurable:!0,value:e})}},function(t,e,n){var i=n(0),r=n(26),o=n(3),s=n(70),a="["+s+"]",l=RegExp("^"+a+a+"*"),u=RegExp(a+a+"*$"),h=function(t,e,n){var r={},a=o((function(){return!!s[t]()||"​"!="​"[t]()})),l=r[t]=a?e(c):s[t];n&&(r[n]=l),i(i.P+i.F*a,"String",r)},c=h.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=h},function(t,e){t.exports={}},function(t,e,n){"use strict";var i=n(2),r=n(10),o=n(9),s=n(6)("species");t.exports=function(t){var e=i[t];o&&e&&!e[s]&&r.f(e,s,{configurable:!0,get:function(){return this}})}},function(t,e){t.exports=function(t,e,n,i){if(!(t instanceof e)||void 0!==i&&i in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,e,n){var i=n(12);t.exports=function(t,e,n){for(var r in e)i(t,r,e[r],n);return t}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));class i{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e,n){var i=n(25);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,n){var i=n(25),r=n(6)("toStringTag"),o="Arguments"==i(function(){return arguments}());t.exports=function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?n:o?i(e):"Object"==(s=i(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,n){var i=n(4),r=n(19),o=n(6)("species");t.exports=function(t,e){var n,s=i(t).constructor;return void 0===s||null==(n=i(s)[o])?e:r(n)}},function(t,e,n){var i=n(8),r=n(2),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:n(33)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,n){var i=n(16),r=n(7),o=n(35);t.exports=function(t){return function(e,n,s){var a,l=i(e),u=r(l.length),h=o(s,u);if(t&&n!=n){for(;u>h;)if((a=l[h++])!=a)return!0}else for(;u>h;h++)if((t||h in l)&&l[h]===n)return t||h||0;return!t&&-1}}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var i=n(25);t.exports=Array.isArray||function(t){return"Array"==i(t)}},function(t,e,n){var i=n(6)("iterator"),r=!1;try{var o=[7][i]();o.return=function(){r=!0},Array.from(o,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var n=!1;try{var o=[7],s=o[i]();s.next=function(){return{done:n=!0}},o[i]=function(){return s},t(o)}catch(t){}return n}},function(t,e,n){"use strict";var i=n(4);t.exports=function(){var t=i(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,n){"use strict";var i=n(50),r=RegExp.prototype.exec;t.exports=function(t,e){var n=t.exec;if("function"==typeof n){var o=n.call(t,e);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==i(t))throw new TypeError("RegExp#exec called on incompatible receiver");return r.call(t,e)}},function(t,e,n){"use strict";n(114);var i=n(12),r=n(15),o=n(3),s=n(26),a=n(6),l=n(85),u=a("species"),h=!o((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),c=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();t.exports=function(t,e,n){var f=a(t),d=!o((function(){var e={};return e[f]=function(){return 7},7!=""[t](e)})),p=d?!o((function(){var e=!1,n=/a/;return n.exec=function(){return e=!0,null},"split"===t&&(n.constructor={},n.constructor[u]=function(){return n}),n[f](""),!e})):void 0;if(!d||!p||"replace"===t&&!h||"split"===t&&!c){var g=/./[f],m=n(s,f,""[t],(function(t,e,n,i,r){return e.exec===l?d&&!r?{done:!0,value:g.call(e,n,i)}:{done:!0,value:t.call(n,e,i)}:{done:!1}})),v=m[0],y=m[1];i(String.prototype,t,v),r(RegExp.prototype,f,2==e?function(t,e){return y.call(t,this,e)}:function(t){return y.call(t,this)})}}},function(t,e,n){var i=n(18),r=n(109),o=n(80),s=n(4),a=n(7),l=n(82),u={},h={};(e=t.exports=function(t,e,n,c,f){var d,p,g,m,v=f?function(){return t}:l(t),y=i(n,c,e?2:1),b=0;if("function"!=typeof v)throw TypeError(t+" is not iterable!");if(o(v)){for(d=a(t.length);d>b;b++)if((m=e?y(s(p=t[b])[0],p[1]):y(t[b]))===u||m===h)return m}else for(g=v.call(t);!(p=g.next()).done;)if((m=r(g,y,p.value,e))===u||m===h)return m}).BREAK=u,e.RETURN=h},function(t,e,n){var i=n(2).navigator;t.exports=i&&i.userAgent||""},function(t,e,n){"use strict";var i=n(2),r=n(0),o=n(12),s=n(46),a=n(30),l=n(60),u=n(45),h=n(5),c=n(3),f=n(56),d=n(41),p=n(71);t.exports=function(t,e,n,g,m,v){var y=i[t],b=y,_=m?"set":"add",S=b&&b.prototype,w={},x=function(t){var e=S[t];o(S,t,"delete"==t||"has"==t?function(t){return!(v&&!h(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return v&&!h(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,n){return e.call(this,0===t?0:t,n),this})};if("function"==typeof b&&(v||S.forEach&&!c((function(){(new b).entries().next()})))){var C=new b,N=C[_](v?{}:-0,1)!=C,T=c((function(){C.has(1)})),k=f((function(t){new b(t)})),E=!v&&c((function(){for(var t=new b,e=5;e--;)t[_](e,e);return!t.has(-0)}));k||((b=e((function(e,n){u(e,b,t);var i=p(new y,e,b);return null!=n&&l(n,m,i[_],i),i}))).prototype=S,S.constructor=b),(T||E)&&(x("delete"),x("has"),m&&x("get")),(E||N)&&x(_),v&&S.clear&&delete S.clear}else b=g.getConstructor(e,t,m,_),s(b.prototype,n),a.NEED=!0;return d(b,t),w[t]=b,r(r.G+r.W+r.F*(b!=y),w),v||g.setStrong(b,t,m),b}},function(t,e,n){for(var i,r=n(2),o=n(15),s=n(32),a=s("typed_array"),l=s("view"),u=!(!r.ArrayBuffer||!r.DataView),h=u,c=0,f="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");c<9;)(i=r[f[c++]])?(o(i.prototype,a,!0),o(i.prototype,l,!0)):h=!1;t.exports={ABV:u,CONSTR:h,TYPED:a,VIEW:l}},function(t,e,n){var i=n(5),r=n(2).document,o=i(r)&&i(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,n){e.f=n(6)},function(t,e,n){var i=n(52)("keys"),r=n(32);t.exports=function(t){return i[t]||(i[t]=r(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){var i=n(2).document;t.exports=i&&i.documentElement},function(t,e,n){var i=n(5),r=n(4),o=function(t,e){if(r(t),!i(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,i){try{(i=n(18)(Function.call,n(21).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return o(t,n),e?t.__proto__=n:i(t,n),t}}({},!1):void 0),check:o}},function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,e,n){var i=n(5),r=n(69).set;t.exports=function(t,e,n){var o,s=e.constructor;return s!==n&&"function"==typeof s&&(o=s.prototype)!==n.prototype&&i(o)&&r&&r(t,o),t}},function(t,e,n){"use strict";var i=n(20),r=n(26);t.exports=function(t){var e=String(r(this)),n="",o=i(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(n+=e);return n}},function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,e){var n=Math.expm1;t.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:n},function(t,e,n){var i=n(20),r=n(26);t.exports=function(t){return function(e,n){var o,s,a=String(r(e)),l=i(n),u=a.length;return l<0||l>=u?t?"":void 0:(o=a.charCodeAt(l))<55296||o>56319||l+1===u||(s=a.charCodeAt(l+1))<56320||s>57343?t?a.charAt(l):o:t?a.slice(l,l+2):s-56320+(o-55296<<10)+65536}}},function(t,e,n){"use strict";var i=n(33),r=n(0),o=n(12),s=n(15),a=n(43),l=n(108),u=n(41),h=n(38),c=n(6)("iterator"),f=!([].keys&&"next"in[].keys()),d=function(){return this};t.exports=function(t,e,n,p,g,m,v){l(n,e,p);var y,b,_,S=function(t){if(!f&&t in N)return N[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},w=e+" Iterator",x="values"==g,C=!1,N=t.prototype,T=N[c]||N["@@iterator"]||g&&N[g],k=T||S(g),E=g?x?S("entries"):k:void 0,P="Array"==e&&N.entries||T;if(P&&(_=h(P.call(new t)))!==Object.prototype&&_.next&&(u(_,w,!0),i||"function"==typeof _[c]||s(_,c,d)),x&&T&&"values"!==T.name&&(C=!0,k=function(){return T.call(this)}),i&&!v||!f&&!C&&N[c]||s(N,c,k),a[e]=k,a[w]=d,g)if(y={values:x?k:S("values"),keys:m?k:S("keys"),entries:E},v)for(b in y)b in N||o(N,b,y[b]);else r(r.P+r.F*(f||C),e,y);return y}},function(t,e,n){var i=n(78),r=n(26);t.exports=function(t,e,n){if(i(e))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(t))}},function(t,e,n){var i=n(5),r=n(25),o=n(6)("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[o])?!!e:"RegExp"==r(t))}},function(t,e,n){var i=n(6)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[i]=!1,!"/./"[t](e)}catch(t){}}return!0}},function(t,e,n){var i=n(43),r=n(6)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||o[r]===t)}},function(t,e,n){"use strict";var i=n(10),r=n(31);t.exports=function(t,e,n){e in t?i.f(t,e,r(0,n)):t[e]=n}},function(t,e,n){var i=n(50),r=n(6)("iterator"),o=n(43);t.exports=n(8).getIteratorMethod=function(t){if(null!=t)return t[r]||t["@@iterator"]||o[i(t)]}},function(t,e,n){"use strict";var i=n(11),r=n(35),o=n(7);t.exports=function(t){for(var e=i(this),n=o(e.length),s=arguments.length,a=r(s>1?arguments[1]:void 0,n),l=s>2?arguments[2]:void 0,u=void 0===l?n:r(l,n);u>a;)e[a++]=t;return e}},function(t,e,n){"use strict";var i=n(39),r=n(113),o=n(43),s=n(16);t.exports=n(76)(Array,"Array",(function(t,e){this._t=s(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(t,e,n){"use strict";var i,r,o=n(57),s=RegExp.prototype.exec,a=String.prototype.replace,l=s,u=(i=/a/,r=/b*/g,s.call(i,"a"),s.call(r,"a"),0!==i.lastIndex||0!==r.lastIndex),h=void 0!==/()??/.exec("")[1];(u||h)&&(l=function(t){var e,n,i,r,l=this;return h&&(n=new RegExp("^"+l.source+"$(?!\\s)",o.call(l))),u&&(e=l.lastIndex),i=s.call(l,t),u&&i&&(l.lastIndex=l.global?i.index+i[0].length:e),h&&i&&i.length>1&&a.call(i[0],n,(function(){for(r=1;r<arguments.length-2;r++)void 0===arguments[r]&&(i[r]=void 0)})),i}),t.exports=l},function(t,e,n){"use strict";var i=n(75)(!0);t.exports=function(t,e,n){return e+(n?i(t,e).length:1)}},function(t,e,n){var i,r,o,s=n(18),a=n(102),l=n(68),u=n(64),h=n(2),c=h.process,f=h.setImmediate,d=h.clearImmediate,p=h.MessageChannel,g=h.Dispatch,m=0,v={},y=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},b=function(t){y.call(t.data)};f&&d||(f=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return v[++m]=function(){a("function"==typeof t?t:Function(t),e)},i(m),m},d=function(t){delete v[t]},"process"==n(25)(c)?i=function(t){c.nextTick(s(y,t,1))}:g&&g.now?i=function(t){g.now(s(y,t,1))}:p?(o=(r=new p).port2,r.port1.onmessage=b,i=s(o.postMessage,o,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(i=function(t){h.postMessage(t+"","*")},h.addEventListener("message",b,!1)):i="onreadystatechange"in u("script")?function(t){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),y.call(t)}}:function(t){setTimeout(s(y,t,1),0)}),t.exports={set:f,clear:d}},function(t,e,n){"use strict";var i=n(2),r=n(9),o=n(33),s=n(63),a=n(15),l=n(46),u=n(3),h=n(45),c=n(20),f=n(7),d=n(121),p=n(37).f,g=n(10).f,m=n(83),v=n(41),y=i.ArrayBuffer,b=i.DataView,_=i.Math,S=i.RangeError,w=i.Infinity,x=y,C=_.abs,N=_.pow,T=_.floor,k=_.log,E=_.LN2,P=r?"_b":"buffer",O=r?"_l":"byteLength",I=r?"_o":"byteOffset";function A(t,e,n){var i,r,o,s=new Array(n),a=8*n-e-1,l=(1<<a)-1,u=l>>1,h=23===e?N(2,-24)-N(2,-77):0,c=0,f=t<0||0===t&&1/t<0?1:0;for((t=C(t))!=t||t===w?(r=t!=t?1:0,i=l):(i=T(k(t)/E),t*(o=N(2,-i))<1&&(i--,o*=2),(t+=i+u>=1?h/o:h*N(2,1-u))*o>=2&&(i++,o/=2),i+u>=l?(r=0,i=l):i+u>=1?(r=(t*o-1)*N(2,e),i+=u):(r=t*N(2,u-1)*N(2,e),i=0));e>=8;s[c++]=255&r,r/=256,e-=8);for(i=i<<e|r,a+=e;a>0;s[c++]=255&i,i/=256,a-=8);return s[--c]|=128*f,s}function F(t,e,n){var i,r=8*n-e-1,o=(1<<r)-1,s=o>>1,a=r-7,l=n-1,u=t[l--],h=127&u;for(u>>=7;a>0;h=256*h+t[l],l--,a-=8);for(i=h&(1<<-a)-1,h>>=-a,a+=e;a>0;i=256*i+t[l],l--,a-=8);if(0===h)h=1-s;else{if(h===o)return i?NaN:u?-w:w;i+=N(2,e),h-=s}return(u?-1:1)*i*N(2,h-e)}function W(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function M(t){return[255&t]}function R(t){return[255&t,t>>8&255]}function L(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function j(t){return A(t,52,8)}function G(t){return A(t,23,4)}function V(t,e,n){g(t.prototype,e,{get:function(){return this[n]}})}function D(t,e,n,i){var r=d(+n);if(r+e>t[O])throw S("Wrong index!");var o=t[P]._b,s=r+t[I],a=o.slice(s,s+e);return i?a:a.reverse()}function U(t,e,n,i,r,o){var s=d(+n);if(s+e>t[O])throw S("Wrong index!");for(var a=t[P]._b,l=s+t[I],u=i(+r),h=0;h<e;h++)a[l+h]=u[o?h:e-h-1]}if(s.ABV){if(!u((function(){y(1)}))||!u((function(){new y(-1)}))||u((function(){return new y,new y(1.5),new y(NaN),"ArrayBuffer"!=y.name}))){for(var B,z=(y=function(t){return h(this,y),new x(d(t))}).prototype=x.prototype,q=p(x),H=0;q.length>H;)(B=q[H++])in y||a(y,B,x[B]);o||(z.constructor=y)}var Y=new b(new y(2)),X=b.prototype.setInt8;Y.setInt8(0,2147483648),Y.setInt8(1,2147483649),!Y.getInt8(0)&&Y.getInt8(1)||l(b.prototype,{setInt8:function(t,e){X.call(this,t,e<<24>>24)},setUint8:function(t,e){X.call(this,t,e<<24>>24)}},!0)}else y=function(t){h(this,y,"ArrayBuffer");var e=d(t);this._b=m.call(new Array(e),0),this[O]=e},b=function(t,e,n){h(this,b,"DataView"),h(t,y,"DataView");var i=t[O],r=c(e);if(r<0||r>i)throw S("Wrong offset!");if(r+(n=void 0===n?i-r:f(n))>i)throw S("Wrong length!");this[P]=t,this[I]=r,this[O]=n},r&&(V(y,"byteLength","_l"),V(b,"buffer","_b"),V(b,"byteLength","_l"),V(b,"byteOffset","_o")),l(b.prototype,{getInt8:function(t){return D(this,1,t)[0]<<24>>24},getUint8:function(t){return D(this,1,t)[0]},getInt16:function(t){var e=D(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=D(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return W(D(this,4,t,arguments[1]))},getUint32:function(t){return W(D(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return F(D(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return F(D(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){U(this,1,t,M,e)},setUint8:function(t,e){U(this,1,t,M,e)},setInt16:function(t,e){U(this,2,t,R,e,arguments[2])},setUint16:function(t,e){U(this,2,t,R,e,arguments[2])},setInt32:function(t,e){U(this,4,t,L,e,arguments[2])},setUint32:function(t,e){U(this,4,t,L,e,arguments[2])},setFloat32:function(t,e){U(this,4,t,G,e,arguments[2])},setFloat64:function(t,e){U(this,8,t,j,e,arguments[2])}});v(y,"ArrayBuffer"),v(b,"DataView"),a(b.prototype,s.VIEW,!0),e.ArrayBuffer=y,e.DataView=b},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){t.exports=!n(126)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e,n){!function(t){"use strict";class e{constructor(){if(this._components=[],this._componentsString=null,this._isRelative=!1,"string"==typeof arguments[0]){let t=arguments[0];this.componentsString=t}else if(arguments[0]instanceof e.Component&&arguments[1]instanceof e){let t=arguments[0],e=arguments[1];this._components.push(t),this._components=this._components.concat(e._components)}else if(arguments[0]instanceof Array){let t=arguments[0],e=!!arguments[1];this._components=this._components.concat(t),this._isRelative=e}}get isRelative(){return this._isRelative}get componentCount(){return this._components.length}get head(){return this._components.length>0?this._components[0]:null}get tail(){if(this._components.length>=2){let t=this._components.slice(1,this._components.length);return new e(t)}return e.self}get length(){return this._components.length}get lastComponent(){let t=this._components.length-1;return t>=0?this._components[t]:null}get containsNamedComponent(){for(let t=0,e=this._components.length;t<e;t++)if(!this._components[t].isIndex)return!0;return!1}static get self(){let t=new e;return t._isRelative=!0,t}GetComponent(t){return this._components[t]}PathByAppendingPath(t){let n=new e,i=0;for(let e=0;e<t._components.length&&t._components[e].isParent;++e)i++;for(let t=0;t<this._components.length-i;++t)n._components.push(this._components[t]);for(let e=i;e<t._components.length;++e)n._components.push(t._components[e]);return n}get componentsString(){return null==this._componentsString&&(this._componentsString=this._components.join("."),this.isRelative&&(this._componentsString="."+this._componentsString)),this._componentsString}set componentsString(t){if(this._components.length=0,this._componentsString=t,null==this._componentsString||""==this._componentsString)return;"."==this._componentsString[0]&&(this._isRelative=!0,this._componentsString=this._componentsString.substring(1));let n=this._componentsString.split(".");for(let t of n)/^(\-|\+)?([0-9]+|Infinity)$/.test(t)?this._components.push(new e.Component(parseInt(t))):this._components.push(new e.Component(t))}toString(){return this.componentsString}Equals(t){if(null==t)return!1;if(t._components.length!=this._components.length)return!1;if(t.isRelative!=this.isRelative)return!1;for(let e=0,n=t._components.length;e<n;e++)if(!t._components[e].Equals(this._components[e]))return!1;return!0}PathByAppendingComponent(t){let n=new e;return n._components.push.apply(n._components,this._components),n._components.push(t),n}}var n,i,r;function o(t,e){return t instanceof e?h(t):null}function s(t,e){if(t instanceof e)return h(t);throw new Error(`${t} is not of type ${e}`)}function a(t){return t.hasValidName&&t.name?t:null}function l(t){return void 0===t?null:t}function u(t){return"object"==typeof t&&"function"==typeof t.Equals}function h(t,e){return t}e.parentId="^",function(t){class e{constructor(t){this.index=-1,this.name=null,"string"==typeof t?this.name=t:this.index=t}get isIndex(){return this.index>=0}get isParent(){return this.name==t.parentId}static ToParent(){return new e(t.parentId)}toString(){return this.isIndex?this.index.toString():this.name}Equals(t){return null!=t&&t.isIndex==this.isIndex&&(this.isIndex?this.index==t.index:this.name==t.name)}}t.Component=e}(e||(e={})),function(t){function e(t,e){if(!t)throw void 0!==e&&console.warn(e),console.trace&&console.trace(),new Error("")}t.AssertType=function(t,n,i){e(t instanceof n,i)},t.Assert=e}(n||(n={}));class c extends Error{}function f(t){throw new c(t+" is null or undefined")}class d{constructor(){this.parent=null,this._debugMetadata=null,this._path=null}get debugMetadata(){return null===this._debugMetadata&&this.parent?this.parent.debugMetadata:this._debugMetadata}set debugMetadata(t){this._debugMetadata=t}get ownDebugMetadata(){return this._debugMetadata}DebugLineNumberOfPath(t){if(null===t)return null;let e=this.rootContentContainer;if(e){let n=e.ContentAtPath(t).obj;if(n){let t=n.debugMetadata;if(null!==t)return t.startLineNumber}}return null}get path(){if(null==this._path)if(null==this.parent)this._path=new e;else{let t=[],n=this,i=o(n.parent,E);for(;null!==i;){let r=a(n);null!=r&&r.hasValidName?t.unshift(new e.Component(r.name)):t.unshift(new e.Component(i.content.indexOf(n))),n=i,i=o(i.parent,E)}this._path=new e(t)}return this._path}ResolvePath(t){if(null===t)return f("path");if(t.isRelative){let e=o(this,E);return null===e&&(n.Assert(null!==this.parent,"Can't resolve relative path because we don't have a parent"),e=o(this.parent,E),n.Assert(null!==e,"Expected parent to be a container"),n.Assert(t.GetComponent(0).isParent),t=t.tail),null===e?f("nearestContainer"):e.ContentAtPath(t)}{let e=this.rootContentContainer;return null===e?f("contentContainer"):e.ContentAtPath(t)}}ConvertPathToRelative(t){let n=this.path,i=Math.min(t.length,n.length),r=-1;for(let e=0;e<i;++e){let i=n.GetComponent(e),o=t.GetComponent(e);if(!i.Equals(o))break;r=e}if(-1==r)return t;let o=n.componentCount-1-r,s=[];for(let t=0;t<o;++t)s.push(e.Component.ToParent());for(let e=r+1;e<t.componentCount;++e)s.push(t.GetComponent(e));return new e(s,!0)}CompactPathString(t){let e=null,n=null;return t.isRelative?(n=t.componentsString,e=this.path.PathByAppendingPath(t).componentsString):(n=this.ConvertPathToRelative(t).componentsString,e=t.componentsString),n.length<e.length?n:e}get rootContentContainer(){let t=this;for(;t.parent;)t=t.parent;return o(t,E)}Copy(){throw Error("Not Implemented: Doesn't support copying")}SetChild(t,e,n){t[e]&&(t[e]=null),t[e]=n,t[e]&&(t[e].parent=this)}}class p{constructor(t){t=void 0!==t?t.toString():"",this.string=t}get Length(){return this.string.length}Append(t){null!==t&&(this.string+=t)}AppendLine(t){void 0!==t&&this.Append(t),this.string+="\n"}AppendFormat(t,...e){this.string+=t.replace(/{(\d+)}/g,(t,n)=>void 0!==e[n]?e[n]:t)}toString(){return this.string}}class g{constructor(){if(this.originName=null,this.itemName=null,void 0!==arguments[1]){let t=arguments[0],e=arguments[1];this.originName=t,this.itemName=e}else if(arguments[0]){let t=arguments[0].toString().split(".");this.originName=t[0],this.itemName=t[1]}}static get Null(){return new g(null,null)}get isNull(){return null==this.originName&&null==this.itemName}get fullName(){return(null!==this.originName?this.originName:"?")+"."+this.itemName}toString(){return this.fullName}Equals(t){if(t instanceof g){let e=t;return e.itemName==this.itemName&&e.originName==this.originName}return!1}copy(){return new g(this.originName,this.itemName)}serialized(){return JSON.stringify({originName:this.originName,itemName:this.itemName})}static fromSerializedKey(t){let e=JSON.parse(t);if(!g.isLikeInkListItem(e))return g.Null;let n=e;return new g(n.originName,n.itemName)}static isLikeInkListItem(t){return!("object"!=typeof t||!t.hasOwnProperty("originName")||!t.hasOwnProperty("itemName")||"string"!=typeof t.originName&&null!==typeof t.originName||"string"!=typeof t.itemName&&null!==typeof t.itemName)}}class m extends Map{constructor(){if(super(arguments[0]instanceof m?arguments[0]:[]),this.origins=null,this._originNames=[],arguments[0]instanceof m){let t=arguments[0];t._originNames&&(this._originNames=t._originNames.slice())}else if("string"==typeof arguments[0]){let t=arguments[0],e=arguments[1];this.SetInitialOriginName(t);let n=e.listDefinitions.TryListGetDefinition(t,null);if(!n.exists)throw new Error("InkList origin could not be found in story when constructing new list: "+t);this.origins=[n.result]}else if("object"==typeof arguments[0]&&arguments[0].hasOwnProperty("Key")&&arguments[0].hasOwnProperty("Value")){let t=arguments[0];this.Add(t.Key,t.Value)}}AddItem(t){if(t instanceof g){let e=t;if(null==e.originName)return void this.AddItem(e.itemName);if(null===this.origins)return f("this.origins");for(let t of this.origins)if(t.name==e.originName){let n=t.TryGetValueForItem(e,0);if(n.exists)return void this.Add(e,n.result);throw new Error("Could not add the item "+e+" to this list because it doesn't exist in the original list definition in ink.")}throw new Error("Failed to add item to list because the item was from a new list definition that wasn't previously known to this list. Only items from previously known lists can be used, so that the int value can be found.")}{let e=t,n=null;if(null===this.origins)return f("this.origins");for(let t of this.origins){if(null===e)return f("itemName");if(t.ContainsItemWithName(e)){if(null!=n)throw new Error("Could not add the item "+e+" to this list because it could come from either "+t.name+" or "+n.name);n=t}}if(null==n)throw new Error("Could not add the item "+e+" to this list because it isn't known to any list definitions previously associated with this list.");let i=new g(n.name,e),r=n.ValueForItem(i);this.Add(i,r)}}ContainsItemNamed(t){for(let[e]of this)if(g.fromSerializedKey(e).itemName==t)return!0;return!1}ContainsKey(t){return this.has(t.serialized())}Add(t,e){let n=t.serialized();if(this.has(n))throw new Error("The Map already contains an entry for "+t);this.set(n,e)}Remove(t){return this.delete(t.serialized())}get Count(){return this.size}get originOfMaxItem(){if(null==this.origins)return null;let t=this.maxItem.Key.originName,e=null;return this.origins.every(n=>n.name!=t||(e=n,!1)),e}get originNames(){if(this.Count>0){null==this._originNames&&this.Count>0?this._originNames=[]:(this._originNames||(this._originNames=[]),this._originNames.length=0);for(let[t]of this){let e=g.fromSerializedKey(t);if(null===e.originName)return f("item.originName");this._originNames.push(e.originName)}}return this._originNames}SetInitialOriginName(t){this._originNames=[t]}SetInitialOriginNames(t){this._originNames=null==t?null:t.slice()}get maxItem(){let t={Key:g.Null,Value:0};for(let[e,n]of this){let i=g.fromSerializedKey(e);(t.Key.isNull||n>t.Value)&&(t={Key:i,Value:n})}return t}get minItem(){let t={Key:g.Null,Value:0};for(let[e,n]of this){let i=g.fromSerializedKey(e);(t.Key.isNull||n<t.Value)&&(t={Key:i,Value:n})}return t}get inverse(){let t=new m;if(null!=this.origins)for(let e of this.origins)for(let[n,i]of e.items){let e=g.fromSerializedKey(n);this.ContainsKey(e)||t.Add(e,i)}return t}get all(){let t=new m;if(null!=this.origins)for(let e of this.origins)for(let[n,i]of e.items){let e=g.fromSerializedKey(n);t.set(e.serialized(),i)}return t}Union(t){let e=new m(this);for(let[n,i]of t)e.set(n,i);return e}Intersect(t){let e=new m;for(let[n,i]of this)t.has(n)&&e.set(n,i);return e}Without(t){let e=new m(this);for(let[n]of t)e.delete(n);return e}Contains(t){for(let[e]of t)if(!this.has(e))return!1;return!0}GreaterThan(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>t.maxItem.Value)}GreaterThanOrEquals(t){return 0!=this.Count&&(0==t.Count||this.minItem.Value>=t.minItem.Value&&this.maxItem.Value>=t.maxItem.Value)}LessThan(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<t.minItem.Value)}LessThanOrEquals(t){return 0!=t.Count&&(0==this.Count||this.maxItem.Value<=t.maxItem.Value&&this.minItem.Value<=t.minItem.Value)}MaxAsList(){return this.Count>0?new m(this.maxItem):new m}MinAsList(){return this.Count>0?new m(this.minItem):new m}ListWithSubRange(t,e){if(0==this.Count)return new m;let n=this.orderedItems,i=0,r=Number.MAX_SAFE_INTEGER;Number.isInteger(t)?i=t:t instanceof m&&t.Count>0&&(i=t.minItem.Value),Number.isInteger(e)?r=e:t instanceof m&&t.Count>0&&(r=e.maxItem.Value);let o=new m;o.SetInitialOriginNames(this.originNames);for(let t of n)t.Value>=i&&t.Value<=r&&o.Add(t.Key,t.Value);return o}Equals(t){if(t instanceof m==0)return!1;if(t.Count!=this.Count)return!1;for(let[e]of this)if(!t.has(e))return!1;return!0}get orderedItems(){let t=new Array;for(let[e,n]of this){let i=g.fromSerializedKey(e);t.push({Key:i,Value:n})}return t.sort((t,e)=>null===t.Key.originName?f("x.Key.originName"):null===e.Key.originName?f("y.Key.originName"):t.Value==e.Value?t.Key.originName.localeCompare(e.Key.originName):t.Value<e.Value?-1:t.Value>e.Value?1:0),t}toString(){let t=this.orderedItems,e=new p;for(let n=0;n<t.length;n++){n>0&&e.Append(", ");let i=t[n].Key;if(null===i.itemName)return f("item.itemName");e.Append(i.itemName)}return e.toString()}valueOf(){return NaN}}class v extends Error{constructor(t){super(t),this.useEndLineNumber=!1,this.message=t,this.name="StoryException"}}function y(t,e,n){if(null===t)return{result:n,exists:!1};let i=t.get(e);return void 0===i?{result:n,exists:!1}:{result:i,exists:!0}}class b extends d{static Create(t,n){if(n){if(n===i.Int&&Number.isInteger(Number(t)))return new S(Number(t));if(n===i.Float&&!isNaN(t))return new w(Number(t))}return"boolean"==typeof t&&(t=t?1:0),"string"==typeof t?new x(String(t)):Number.isInteger(Number(t))?new S(Number(t)):isNaN(t)?t instanceof e?new C(s(t,e)):t instanceof m?new T(s(t,m)):null:new w(Number(t))}Copy(){return s(b.Create(this),d)}BadCastException(t){return new v("Can't cast "+this.valueObject+" from "+this.valueType+" to "+t)}}class _ extends b{constructor(t){super(),this.value=t}get valueObject(){return this.value}toString(){return null===this.value?f("Value.value"):this.value.toString()}}class S extends _{constructor(t){super(t||0)}get isTruthy(){return 0!=this.value}get valueType(){return i.Int}Cast(t){if(null===this.value)return f("Value.value");if(t==this.valueType)return this;if(t==i.Float)return new w(this.value);if(t==i.String)return new x(""+this.value);throw this.BadCastException(t)}}class w extends _{constructor(t){super(t||0)}get isTruthy(){return 0!=this.value}get valueType(){return i.Float}Cast(t){if(null===this.value)return f("Value.value");if(t==this.valueType)return this;if(t==i.Int)return new S(this.value);if(t==i.String)return new x(""+this.value);throw this.BadCastException(t)}}class x extends _{constructor(t){if(super(t||""),this._isNewline="\n"==this.value,this._isInlineWhitespace=!0,null===this.value)return f("Value.value");this.value.length>0&&this.value.split("").every(t=>" "==t||"\t"==t||(this._isInlineWhitespace=!1,!1))}get valueType(){return i.String}get isTruthy(){return null===this.value?f("Value.value"):this.value.length>0}get isNewline(){return this._isNewline}get isInlineWhitespace(){return this._isInlineWhitespace}get isNonWhitespace(){return!this.isNewline&&!this.isInlineWhitespace}Cast(t){if(t==this.valueType)return this;if(t==i.Int){let e=function(t,e=0){let n=parseInt(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}(this.value);if(e.exists)return new S(e.result);throw this.BadCastException(t)}if(t==i.Float){let e=function(t,e=0){let n=parseFloat(t);return Number.isNaN(n)?{result:e,exists:!1}:{result:n,exists:!0}}(this.value);if(e.exists)return new w(e.result);throw this.BadCastException(t)}throw this.BadCastException(t)}}class C extends _{constructor(t){super(t)}get valueType(){return i.DivertTarget}get targetPath(){return null===this.value?f("Value.value"):this.value}set targetPath(t){this.value=t}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a divert target")}Cast(t){if(t==this.valueType)return this;throw this.BadCastException(t)}toString(){return"DivertTargetValue("+this.targetPath+")"}}class N extends _{constructor(t,e=-1){super(t),this._contextIndex=e}get contextIndex(){return this._contextIndex}set contextIndex(t){this._contextIndex=t}get variableName(){return null===this.value?f("Value.value"):this.value}set variableName(t){this.value=t}get valueType(){return i.VariablePointer}get isTruthy(){throw new Error("Shouldn't be checking the truthiness of a variable pointer")}Cast(t){if(t==this.valueType)return this;throw this.BadCastException(t)}toString(){return"VariablePointerValue("+this.variableName+")"}Copy(){return new N(this.variableName,this.contextIndex)}}class T extends _{get isTruthy(){return null===this.value?f("this.value"):this.value.Count>0}get valueType(){return i.List}Cast(t){if(null===this.value)return f("Value.value");if(t==i.Int){let t=this.value.maxItem;return t.Key.isNull?new S(0):new S(t.Value)}if(t==i.Float){let t=this.value.maxItem;return t.Key.isNull?new w(0):new w(t.Value)}if(t==i.String){let t=this.value.maxItem;return t.Key.isNull?new x(""):new x(t.Key.toString())}if(t==this.valueType)return this;throw this.BadCastException(t)}constructor(t,e){super(null),t||e?t instanceof m?this.value=new m(t):t instanceof g&&"number"==typeof e&&(this.value=new m({Key:t,Value:e})):this.value=new m}static RetainListOriginsForAssignment(t,e){let n=o(t,T),i=o(e,T);return i&&null===i.value?f("newList.value"):n&&null===n.value?f("oldList.value"):void(n&&i&&0==i.value.Count&&i.value.SetInitialOriginNames(n.value.originNames))}}!function(t){t[t.Int=0]="Int",t[t.Float=1]="Float",t[t.List=2]="List",t[t.String=3]="String",t[t.DivertTarget=4]="DivertTarget",t[t.VariablePointer=5]="VariablePointer"}(i||(i={}));class k{constructor(){this.obj=null,this.approximate=!1}get correctObj(){return this.approximate?null:this.obj}get container(){return this.obj instanceof E?this.obj:null}copy(){let t=new k;return t.obj=this.obj,t.approximate=this.approximate,t}}class E extends d{constructor(){super(...arguments),this.name="",this._content=[],this.namedContent=new Map,this.visitsShouldBeCounted=!1,this.turnIndexShouldBeCounted=!1,this.countingAtStartOnly=!1,this._pathToFirstLeafContent=null}get hasValidName(){return null!=this.name&&this.name.length>0}get content(){return this._content}set content(t){this.AddContent(t)}get namedOnlyContent(){let t=new Map;for(let[e,n]of this.namedContent){let i=s(n,d);t.set(e,i)}for(let e of this.content){let n=a(e);null!=n&&n.hasValidName&&t.delete(n.name)}return 0==t.size&&(t=null),t}set namedOnlyContent(t){let e=this.namedOnlyContent;if(null!=e)for(let[t]of e)this.namedContent.delete(t);if(null!=t)for(let[,e]of t){let t=a(e);null!=t&&this.AddToNamedContentOnly(t)}}get countFlags(){let t=0;return this.visitsShouldBeCounted&&(t|=E.CountFlags.Visits),this.turnIndexShouldBeCounted&&(t|=E.CountFlags.Turns),this.countingAtStartOnly&&(t|=E.CountFlags.CountStartOnly),t==E.CountFlags.CountStartOnly&&(t=0),t}set countFlags(t){let e=t;(e&E.CountFlags.Visits)>0&&(this.visitsShouldBeCounted=!0),(e&E.CountFlags.Turns)>0&&(this.turnIndexShouldBeCounted=!0),(e&E.CountFlags.CountStartOnly)>0&&(this.countingAtStartOnly=!0)}get pathToFirstLeafContent(){return null==this._pathToFirstLeafContent&&(this._pathToFirstLeafContent=this.path.PathByAppendingPath(this.internalPathToFirstLeafContent)),this._pathToFirstLeafContent}get internalPathToFirstLeafContent(){let t=[],n=this;for(;n instanceof E;)n.content.length>0&&(t.push(new e.Component(0)),n=n.content[0]);return new e(t)}AddContent(t){if(t instanceof Array){let e=t;for(let t of e)this.AddContent(t)}else{let e=t;if(this._content.push(e),e.parent)throw new Error("content is already in "+e.parent);e.parent=this,this.TryAddNamedContent(e)}}TryAddNamedContent(t){let e=a(t);null!=e&&e.hasValidName&&this.AddToNamedContentOnly(e)}AddToNamedContentOnly(t){n.AssertType(t,d,"Can only add Runtime.Objects to a Runtime.Container"),s(t,d).parent=this,this.namedContent.set(t.name,t)}ContentAtPath(t,e=0,n=-1){-1==n&&(n=t.length);let i=new k;i.approximate=!1;let r=this,s=this;for(let a=e;a<n;++a){let e=t.GetComponent(a);if(null==r){i.approximate=!0;break}let n=r.ContentWithPathComponent(e);if(null==n){i.approximate=!0;break}s=n,r=o(n,E)}return i.obj=s,i}InsertContent(t,e){if(this.content[e]=t,t.parent)throw new Error("content is already in "+t.parent);t.parent=this,this.TryAddNamedContent(t)}AddContentsOfContainer(t){this.content=this.content.concat(t.content);for(let e of t.content)e.parent=this,this.TryAddNamedContent(e)}ContentWithPathComponent(t){if(t.isIndex)return t.index>=0&&t.index<this.content.length?this.content[t.index]:null;if(t.isParent)return this.parent;{if(null===t.name)return f("component.name");let e=y(this.namedContent,t.name,null);return e.exists?s(e.result,d):null}}BuildStringOfHierarchy(){let t;if(0==arguments.length)return t=new p,this.BuildStringOfHierarchy(t,0,null),t.toString();t=arguments[0];let e=arguments[1],i=arguments[2];function r(){for(let n=0;n<4*e;++n)t.Append(" ")}r(),t.Append("["),this.hasValidName&&t.AppendFormat(" ({0})",this.name),this==i&&t.Append("  <---"),t.AppendLine(),e++;for(let n=0;n<this.content.length;++n){let o=this.content[n];o instanceof E?o.BuildStringOfHierarchy(t,e,i):(r(),o instanceof x?(t.Append('"'),t.Append(o.toString().replace("\n","\\n")),t.Append('"')):t.Append(o.toString())),n!=this.content.length-1&&t.Append(","),o instanceof E||o!=i||t.Append("  <---"),t.AppendLine()}let o=new Map;for(let[t,e]of this.namedContent)this.content.indexOf(s(e,d))>=0||o.set(t,e);if(o.size>0){r(),t.AppendLine("-- named: --");for(let[,r]of o)n.AssertType(r,E,"Can only print out named Containers"),r.BuildStringOfHierarchy(t,e,i),t.AppendLine()}e--,r(),t.Append("]")}}!function(t){let e;!function(t){t[t.Visits=1]="Visits",t[t.Turns=2]="Turns",t[t.CountStartOnly=4]="CountStartOnly"}(e=t.CountFlags||(t.CountFlags={}))}(E||(E={}));class P extends d{toString(){return"Glue"}}class O extends d{constructor(t=O.CommandType.NotSet){super(),this._commandType=t}get commandType(){return this._commandType}Copy(){return new O(this.commandType)}static EvalStart(){return new O(O.CommandType.EvalStart)}static EvalOutput(){return new O(O.CommandType.EvalOutput)}static EvalEnd(){return new O(O.CommandType.EvalEnd)}static Duplicate(){return new O(O.CommandType.Duplicate)}static PopEvaluatedValue(){return new O(O.CommandType.PopEvaluatedValue)}static PopFunction(){return new O(O.CommandType.PopFunction)}static PopTunnel(){return new O(O.CommandType.PopTunnel)}static BeginString(){return new O(O.CommandType.BeginString)}static EndString(){return new O(O.CommandType.EndString)}static NoOp(){return new O(O.CommandType.NoOp)}static ChoiceCount(){return new O(O.CommandType.ChoiceCount)}static Turns(){return new O(O.CommandType.Turns)}static TurnsSince(){return new O(O.CommandType.TurnsSince)}static ReadCount(){return new O(O.CommandType.ReadCount)}static Random(){return new O(O.CommandType.Random)}static SeedRandom(){return new O(O.CommandType.SeedRandom)}static VisitIndex(){return new O(O.CommandType.VisitIndex)}static SequenceShuffleIndex(){return new O(O.CommandType.SequenceShuffleIndex)}static StartThread(){return new O(O.CommandType.StartThread)}static Done(){return new O(O.CommandType.Done)}static End(){return new O(O.CommandType.End)}static ListFromInt(){return new O(O.CommandType.ListFromInt)}static ListRange(){return new O(O.CommandType.ListRange)}static ListRandom(){return new O(O.CommandType.ListRandom)}toString(){return this.commandType.toString()}}!function(t){let e;!function(t){t[t.NotSet=-1]="NotSet",t[t.EvalStart=0]="EvalStart",t[t.EvalOutput=1]="EvalOutput",t[t.EvalEnd=2]="EvalEnd",t[t.Duplicate=3]="Duplicate",t[t.PopEvaluatedValue=4]="PopEvaluatedValue",t[t.PopFunction=5]="PopFunction",t[t.PopTunnel=6]="PopTunnel",t[t.BeginString=7]="BeginString",t[t.EndString=8]="EndString",t[t.NoOp=9]="NoOp",t[t.ChoiceCount=10]="ChoiceCount",t[t.Turns=11]="Turns",t[t.TurnsSince=12]="TurnsSince",t[t.Random=13]="Random",t[t.SeedRandom=14]="SeedRandom",t[t.VisitIndex=15]="VisitIndex",t[t.SequenceShuffleIndex=16]="SequenceShuffleIndex",t[t.StartThread=17]="StartThread",t[t.Done=18]="Done",t[t.End=19]="End",t[t.ListFromInt=20]="ListFromInt",t[t.ListRange=21]="ListRange",t[t.ListRandom=22]="ListRandom",t[t.ReadCount=23]="ReadCount",t[t.TOTAL_VALUES=24]="TOTAL_VALUES"}(e=t.CommandType||(t.CommandType={}))}(O||(O={})),function(t){t[t.Tunnel=0]="Tunnel",t[t.Function=1]="Function",t[t.FunctionEvaluationFromGame=2]="FunctionEvaluationFromGame"}(r||(r={}));class I{constructor(){this.container=null,this.index=-1,2===arguments.length&&(this.container=arguments[0],this.index=arguments[1])}Resolve(){return this.index<0?this.container:null==this.container?null:0==this.container.content.length?this.container:this.index>=this.container.content.length?null:this.container.content[this.index]}get isNull(){return null==this.container}get path(){return this.isNull?null:this.index>=0?this.container.path.PathByAppendingComponent(new e.Component(this.index)):this.container.path}toString(){return this.container?"Ink Pointer -> "+this.container.path.toString()+" -- index "+this.index:"Ink Pointer (null)"}copy(){return new I(this.container,this.index)}static StartOf(t){return new I(t,0)}static get Null(){return new I(null,-1)}}class A extends d{constructor(t){super(),this._targetPath=null,this._targetPointer=I.Null,this.variableDivertName=null,this.pushesToStack=!1,this.stackPushType=0,this.isExternal=!1,this.externalArgs=0,this.isConditional=!1,this.pushesToStack=!1,void 0!==t&&(this.pushesToStack=!0,this.stackPushType=t)}get targetPath(){if(null!=this._targetPath&&this._targetPath.isRelative){let t=this.targetPointer.Resolve();t&&(this._targetPath=t.path)}return this._targetPath}set targetPath(t){this._targetPath=t,this._targetPointer=I.Null}get targetPointer(){if(this._targetPointer.isNull){let t=this.ResolvePath(this._targetPath).obj;if(null===this._targetPath)return f("this._targetPath");if(null===this._targetPath.lastComponent)return f("this._targetPath.lastComponent");if(this._targetPath.lastComponent.isIndex){if(null===t)return f("targetObj");this._targetPointer.container=t.parent instanceof E?t.parent:null,this._targetPointer.index=this._targetPath.lastComponent.index}else this._targetPointer=I.StartOf(t instanceof E?t:null)}return this._targetPointer.copy()}get targetPathString(){return null==this.targetPath?null:this.CompactPathString(this.targetPath)}set targetPathString(t){this.targetPath=null==t?null:new e(t)}get hasVariableTarget(){return null!=this.variableDivertName}Equals(t){let e=t;return e instanceof A&&this.hasVariableTarget==e.hasVariableTarget&&(this.hasVariableTarget?this.variableDivertName==e.variableDivertName:null===this.targetPath?f("this.targetPath"):this.targetPath.Equals(e.targetPath))}toString(){if(this.hasVariableTarget)return"Divert(variable: "+this.variableDivertName+")";if(null==this.targetPath)return"Divert(null)";{let t=new p,e=this.targetPath.toString();return t.Append("Divert"),this.isConditional&&t.Append("?"),this.pushesToStack&&(this.stackPushType==r.Function?t.Append(" function"):t.Append(" tunnel")),t.Append(" -> "),t.Append(this.targetPathString),t.Append(" ("),t.Append(e),t.Append(")"),t.toString()}}}class F extends d{constructor(t=!0){super(),this._pathOnChoice=null,this.hasCondition=!1,this.hasStartContent=!1,this.hasChoiceOnlyContent=!1,this.isInvisibleDefault=!1,this.onceOnly=!0,this.onceOnly=t}get pathOnChoice(){if(null!=this._pathOnChoice&&this._pathOnChoice.isRelative){let t=this.choiceTarget;t&&(this._pathOnChoice=t.path)}return this._pathOnChoice}set pathOnChoice(t){this._pathOnChoice=t}get choiceTarget(){return null===this._pathOnChoice?f("ChoicePoint._pathOnChoice"):this.ResolvePath(this._pathOnChoice).container}get pathStringOnChoice(){return null===this.pathOnChoice?f("ChoicePoint.pathOnChoice"):this.CompactPathString(this.pathOnChoice)}set pathStringOnChoice(t){this.pathOnChoice=new e(t)}get flags(){let t=0;return this.hasCondition&&(t|=1),this.hasStartContent&&(t|=2),this.hasChoiceOnlyContent&&(t|=4),this.isInvisibleDefault&&(t|=8),this.onceOnly&&(t|=16),t}set flags(t){this.hasCondition=(1&t)>0,this.hasStartContent=(2&t)>0,this.hasChoiceOnlyContent=(4&t)>0,this.isInvisibleDefault=(8&t)>0,this.onceOnly=(16&t)>0}toString(){return null===this.pathOnChoice?f("ChoicePoint.pathOnChoice"):"Choice: -> "+this.pathOnChoice.toString()}}class W extends d{constructor(t=null){super(),this.pathForCount=null,this.name=t}get containerForCount(){return null===this.pathForCount?null:this.ResolvePath(this.pathForCount).container}get pathStringForCount(){return null===this.pathForCount?null:this.CompactPathString(this.pathForCount)}set pathStringForCount(t){this.pathForCount=null===t?null:new e(t)}toString(){return null!=this.name?"var("+this.name+")":"read_count("+this.pathStringForCount+")"}}class M extends d{constructor(t,e){super(),this.variableName=t||null,this.isNewDeclaration=!!e,this.isGlobal=!1}toString(){return"VarAssign to "+this.variableName}}class R extends d{}class L extends d{constructor(){if(super(),this._name=null,this._numberOfParameters=0,this._prototype=null,this._isPrototype=!1,this._operationFuncs=null,0===arguments.length)L.GenerateNativeFunctionsIfNecessary();else if(1===arguments.length){let t=arguments[0];L.GenerateNativeFunctionsIfNecessary(),this.name=t}else if(2===arguments.length){let t=arguments[0],e=arguments[1];this._isPrototype=!0,this.name=t,this.numberOfParameters=e}}static CallWithName(t){return new L(t)}static CallExistsWithName(t){return this.GenerateNativeFunctionsIfNecessary(),this._nativeFunctions.get(t)}get name(){return null===this._name?f("NativeFunctionCall._name"):this._name}set name(t){this._name=t,this._isPrototype||(null===L._nativeFunctions?f("NativeFunctionCall._nativeFunctions"):this._prototype=L._nativeFunctions.get(this._name)||null)}get numberOfParameters(){return this._prototype?this._prototype.numberOfParameters:this._numberOfParameters}set numberOfParameters(t){this._numberOfParameters=t}Call(t){if(this._prototype)return this._prototype.Call(t);if(this.numberOfParameters!=t.length)throw new Error("Unexpected number of parameters");let e=!1;for(let n of t){if(n instanceof R)throw new v('Attempting to perform operation on a void value. Did you forget to "return" a value from a function you called here?');n instanceof T&&(e=!0)}if(2==t.length&&e)return this.CallBinaryListOperation(t);let n=this.CoerceValuesToSingleType(t),r=n[0].valueType;return r==i.Int||r==i.Float||r==i.String||r==i.DivertTarget||r==i.List?this.CallType(n):null}CallType(t){let e=s(t[0],_),n=e.valueType,r=e,o=t.length;if(2==o||1==o){if(null===this._operationFuncs)return f("NativeFunctionCall._operationFuncs");let a=this._operationFuncs.get(n);if(!a){const t=i[n];throw new v("Cannot perform operation "+this.name+" on "+t)}if(2==o){let e=s(t[1],_),n=a;if(null===r.value||null===e.value)return f("NativeFunctionCall.Call BinaryOp values");let i=n(r.value,e.value);return _.Create(i)}{let t=a;if(null===r.value)return f("NativeFunctionCall.Call UnaryOp value");let n=t(r.value);return this.name===L.Int?_.Create(n,i.Int):this.name===L.Float?_.Create(n,i.Float):_.Create(n,e.valueType)}}throw new Error("Unexpected number of parameters to NativeFunctionCall: "+t.length)}CallBinaryListOperation(t){if(("+"==this.name||"-"==this.name)&&t[0]instanceof T&&t[1]instanceof S)return this.CallListIncrementOperation(t);let e=s(t[0],_),n=s(t[1],_);if(!("&&"!=this.name&&"||"!=this.name||e.valueType==i.List&&n.valueType==i.List)){if(null===this._operationFuncs)return f("NativeFunctionCall._operationFuncs");let t=this._operationFuncs.get(i.Int);if(null===t)return f("NativeFunctionCall.CallBinaryListOperation op");let r=t(e.isTruthy?1:0,n.isTruthy?1:0);return new S(r)}if(e.valueType==i.List&&n.valueType==i.List)return this.CallType([e,n]);throw new v("Can not call use "+this.name+" operation on "+i[e.valueType]+" and "+i[n.valueType])}CallListIncrementOperation(t){let e=s(t[0],T),n=s(t[1],S),r=new m;if(null===e.value)return f("NativeFunctionCall.CallListIncrementOperation listVal.value");for(let[t,o]of e.value){let s=g.fromSerializedKey(t);if(null===this._operationFuncs)return f("NativeFunctionCall._operationFuncs");let a=this._operationFuncs.get(i.Int);if(null===n.value)return f("NativeFunctionCall.CallListIncrementOperation intVal.value");let l=a(o,n.value),u=null;if(null===e.value.origins)return f("NativeFunctionCall.CallListIncrementOperation listVal.value.origins");for(let t of e.value.origins)if(t.name==s.originName){u=t;break}if(null!=u){let t=u.TryGetItemWithValue(l,g.Null);t.exists&&r.Add(t.result,l)}}return new T(r)}CoerceValuesToSingleType(t){let e=i.Int,n=null;for(let r of t){let t=s(r,_);t.valueType>e&&(e=t.valueType),t.valueType==i.List&&(n=o(t,T))}let r=[];if(i[e]==i[i.List])for(let e of t){let t=s(e,_);if(t.valueType==i.List)r.push(t);else{if(t.valueType!=i.Int){const e=i[t.valueType];throw new v("Cannot mix Lists and "+e+" values in this operation")}{let e=parseInt(t.valueObject);if(n=s(n,T),null===n.value)return f("NativeFunctionCall.CoerceValuesToSingleType specialCaseList.value");let i=n.value.originOfMaxItem;if(null===i)return f("NativeFunctionCall.CoerceValuesToSingleType list");let o=i.TryGetItemWithValue(e,g.Null);if(!o.exists)throw new v("Could not find List item with the value "+e+" in "+i.name);{let t=new T(o.result,e);r.push(t)}}}}else for(let n of t){let t=s(n,_).Cast(e);r.push(t)}return r}static Identity(t){return t}static GenerateNativeFunctionsIfNecessary(){if(null==this._nativeFunctions){this._nativeFunctions=new Map,this.AddIntBinaryOp(this.Add,(t,e)=>t+e),this.AddIntBinaryOp(this.Subtract,(t,e)=>t-e),this.AddIntBinaryOp(this.Multiply,(t,e)=>t*e),this.AddIntBinaryOp(this.Divide,(t,e)=>Math.floor(t/e)),this.AddIntBinaryOp(this.Mod,(t,e)=>t%e),this.AddIntUnaryOp(this.Negate,t=>-t),this.AddIntBinaryOp(this.Equal,(t,e)=>t==e?1:0),this.AddIntBinaryOp(this.Greater,(t,e)=>t>e?1:0),this.AddIntBinaryOp(this.Less,(t,e)=>t<e?1:0),this.AddIntBinaryOp(this.GreaterThanOrEquals,(t,e)=>t>=e?1:0),this.AddIntBinaryOp(this.LessThanOrEquals,(t,e)=>t<=e?1:0),this.AddIntBinaryOp(this.NotEquals,(t,e)=>t!=e?1:0),this.AddIntUnaryOp(this.Not,t=>0==t?1:0),this.AddIntBinaryOp(this.And,(t,e)=>0!=t&&0!=e?1:0),this.AddIntBinaryOp(this.Or,(t,e)=>0!=t||0!=e?1:0),this.AddIntBinaryOp(this.Max,(t,e)=>Math.max(t,e)),this.AddIntBinaryOp(this.Min,(t,e)=>Math.min(t,e)),this.AddIntBinaryOp(this.Pow,(t,e)=>Math.pow(t,e)),this.AddIntUnaryOp(this.Floor,L.Identity),this.AddIntUnaryOp(this.Ceiling,L.Identity),this.AddIntUnaryOp(this.Int,L.Identity),this.AddIntUnaryOp(this.Float,t=>t),this.AddFloatBinaryOp(this.Add,(t,e)=>t+e),this.AddFloatBinaryOp(this.Subtract,(t,e)=>t-e),this.AddFloatBinaryOp(this.Multiply,(t,e)=>t*e),this.AddFloatBinaryOp(this.Divide,(t,e)=>t/e),this.AddFloatBinaryOp(this.Mod,(t,e)=>t%e),this.AddFloatUnaryOp(this.Negate,t=>-t),this.AddFloatBinaryOp(this.Equal,(t,e)=>t==e?1:0),this.AddFloatBinaryOp(this.Greater,(t,e)=>t>e?1:0),this.AddFloatBinaryOp(this.Less,(t,e)=>t<e?1:0),this.AddFloatBinaryOp(this.GreaterThanOrEquals,(t,e)=>t>=e?1:0),this.AddFloatBinaryOp(this.LessThanOrEquals,(t,e)=>t<=e?1:0),this.AddFloatBinaryOp(this.NotEquals,(t,e)=>t!=e?1:0),this.AddFloatUnaryOp(this.Not,t=>0==t?1:0),this.AddFloatBinaryOp(this.And,(t,e)=>0!=t&&0!=e?1:0),this.AddFloatBinaryOp(this.Or,(t,e)=>0!=t||0!=e?1:0),this.AddFloatBinaryOp(this.Max,(t,e)=>Math.max(t,e)),this.AddFloatBinaryOp(this.Min,(t,e)=>Math.min(t,e)),this.AddFloatBinaryOp(this.Pow,(t,e)=>Math.pow(t,e)),this.AddFloatUnaryOp(this.Floor,t=>Math.floor(t)),this.AddFloatUnaryOp(this.Ceiling,t=>Math.ceil(t)),this.AddFloatUnaryOp(this.Int,t=>Math.floor(t)),this.AddFloatUnaryOp(this.Float,L.Identity),this.AddStringBinaryOp(this.Add,(t,e)=>t+e),this.AddStringBinaryOp(this.Equal,(t,e)=>t===e?1:0),this.AddStringBinaryOp(this.NotEquals,(t,e)=>t!==e?1:0),this.AddStringBinaryOp(this.Has,(t,e)=>t.includes(e)?1:0),this.AddStringBinaryOp(this.Hasnt,(t,e)=>t.includes(e)?0:1),this.AddListBinaryOp(this.Add,(t,e)=>t.Union(e)),this.AddListBinaryOp(this.Subtract,(t,e)=>t.Without(e)),this.AddListBinaryOp(this.Has,(t,e)=>t.Contains(e)?1:0),this.AddListBinaryOp(this.Hasnt,(t,e)=>t.Contains(e)?0:1),this.AddListBinaryOp(this.Intersect,(t,e)=>t.Intersect(e)),this.AddListBinaryOp(this.Equal,(t,e)=>t.Equals(e)?1:0),this.AddListBinaryOp(this.Greater,(t,e)=>t.GreaterThan(e)?1:0),this.AddListBinaryOp(this.Less,(t,e)=>t.LessThan(e)?1:0),this.AddListBinaryOp(this.GreaterThanOrEquals,(t,e)=>t.GreaterThanOrEquals(e)?1:0),this.AddListBinaryOp(this.LessThanOrEquals,(t,e)=>t.LessThanOrEquals(e)?1:0),this.AddListBinaryOp(this.NotEquals,(t,e)=>t.Equals(e)?0:1),this.AddListBinaryOp(this.And,(t,e)=>t.Count>0&&e.Count>0?1:0),this.AddListBinaryOp(this.Or,(t,e)=>t.Count>0||e.Count>0?1:0),this.AddListUnaryOp(this.Not,t=>0==t.Count?1:0),this.AddListUnaryOp(this.Invert,t=>t.inverse),this.AddListUnaryOp(this.All,t=>t.all),this.AddListUnaryOp(this.ListMin,t=>t.MinAsList()),this.AddListUnaryOp(this.ListMax,t=>t.MaxAsList()),this.AddListUnaryOp(this.Count,t=>t.Count),this.AddListUnaryOp(this.ValueOfList,t=>t.maxItem.Value);let t=(t,e)=>t.Equals(e)?1:0,e=(t,e)=>t.Equals(e)?0:1;this.AddOpToNativeFunc(this.Equal,2,i.DivertTarget,t),this.AddOpToNativeFunc(this.NotEquals,2,i.DivertTarget,e)}}AddOpFuncForType(t,e){null==this._operationFuncs&&(this._operationFuncs=new Map),this._operationFuncs.set(t,e)}static AddOpToNativeFunc(t,e,n,i){if(null===this._nativeFunctions)return f("NativeFunctionCall._nativeFunctions");let r=this._nativeFunctions.get(t);r||(r=new L(t,e),this._nativeFunctions.set(t,r)),r.AddOpFuncForType(n,i)}static AddIntBinaryOp(t,e){this.AddOpToNativeFunc(t,2,i.Int,e)}static AddIntUnaryOp(t,e){this.AddOpToNativeFunc(t,1,i.Int,e)}static AddFloatBinaryOp(t,e){this.AddOpToNativeFunc(t,2,i.Float,e)}static AddFloatUnaryOp(t,e){this.AddOpToNativeFunc(t,1,i.Float,e)}static AddStringBinaryOp(t,e){this.AddOpToNativeFunc(t,2,i.String,e)}static AddListBinaryOp(t,e){this.AddOpToNativeFunc(t,2,i.List,e)}static AddListUnaryOp(t,e){this.AddOpToNativeFunc(t,1,i.List,e)}toString(){return'Native "'+this.name+'"'}}L.Add="+",L.Subtract="-",L.Divide="/",L.Multiply="*",L.Mod="%",L.Negate="_",L.Equal="==",L.Greater=">",L.Less="<",L.GreaterThanOrEquals=">=",L.LessThanOrEquals="<=",L.NotEquals="!=",L.Not="!",L.And="&&",L.Or="||",L.Min="MIN",L.Max="MAX",L.Pow="POW",L.Floor="FLOOR",L.Ceiling="CEILING",L.Int="INT",L.Float="FLOAT",L.Has="?",L.Hasnt="!?",L.Intersect="^",L.ListMin="LIST_MIN",L.ListMax="LIST_MAX",L.All="LIST_ALL",L.Count="LIST_COUNT",L.ValueOfList="LIST_VALUE",L.Invert="LIST_INVERT",L._nativeFunctions=null;class j extends d{constructor(t){super(),this.text=t.toString()||""}toString(){return"# "+this.text}}class G extends d{constructor(){super(...arguments),this.text="",this.index=0,this.threadAtGeneration=null,this.sourcePath="",this.targetPath=null,this.isInvisibleDefault=!1,this.originalThreadIndex=0}get pathStringOnChoice(){return null===this.targetPath?f("Choice.targetPath"):this.targetPath.toString()}set pathStringOnChoice(t){this.targetPath=new e(t)}}class V{constructor(t,e){this._name=t||"",this._items=null,this._itemNameToValues=e||new Map}get name(){return this._name}get items(){if(null==this._items){this._items=new Map;for(let[t,e]of this._itemNameToValues){let n=new g(this.name,t);this._items.set(n.serialized(),e)}}return this._items}ValueForItem(t){if(!t.itemName)return 0;let e=this._itemNameToValues.get(t.itemName);return void 0!==e?e:0}ContainsItem(t){return!!t.itemName&&t.originName==this.name&&this._itemNameToValues.has(t.itemName)}ContainsItemWithName(t){return this._itemNameToValues.has(t)}TryGetItemWithValue(t,e){for(let[e,n]of this._itemNameToValues)if(n==t)return{result:new g(this.name,e),exists:!0};return{result:g.Null,exists:!1}}TryGetValueForItem(t,e){if(!t.itemName)return{result:0,exists:!1};let n=this._itemNameToValues.get(t.itemName);return n?{result:n,exists:!0}:{result:0,exists:!1}}}class D{constructor(t){this._lists=new Map,this._allUnambiguousListValueCache=new Map;for(let e of t){this._lists.set(e.name,e);for(let[t,n]of e.items){let e=g.fromSerializedKey(t),i=new T(e,n);if(!e.itemName)throw new Error("item.itemName is null or undefined.");this._allUnambiguousListValueCache.set(e.itemName,i),this._allUnambiguousListValueCache.set(e.fullName,i)}}}get lists(){let t=[];for(let[,e]of this._lists)t.push(e);return t}TryListGetDefinition(t,e){if(null===t)return{result:e,exists:!1};let n=this._lists.get(t);return n?{result:n,exists:!0}:{result:e,exists:!1}}FindSingleItemListWithName(t){if(null===t)return f("name");let e=this._allUnambiguousListValueCache.get(t);return void 0!==e?e:null}}class U{static JArrayToRuntimeObjList(t,e=!1){let n=t.length;e&&n--;let i=[];for(let e=0;e<n;e++){let n=t[e],r=this.JTokenToRuntimeObject(n);if(null===r)return f("runtimeObj");i.push(r)}return i}static WriteDictionaryRuntimeObjs(t,e){t.WriteObjectStart();for(let[n,i]of e)t.WritePropertyStart(n),this.WriteRuntimeObject(t,i),t.WritePropertyEnd();t.WriteObjectEnd()}static WriteListRuntimeObjs(t,e){t.WriteArrayStart();for(let n of e)this.WriteRuntimeObject(t,n);t.WriteArrayEnd()}static WriteIntDictionary(t,e){t.WriteObjectStart();for(let[n,i]of e)t.WriteIntProperty(n,i);t.WriteObjectEnd()}static WriteRuntimeObject(t,e){let n=o(e,E);if(n)return void this.WriteRuntimeContainer(t,n);let i=o(e,A);if(i){let e,n="->";return i.isExternal?n="x()":i.pushesToStack&&(i.stackPushType==r.Function?n="f()":i.stackPushType==r.Tunnel&&(n="->t->")),e=i.hasVariableTarget?i.variableDivertName:i.targetPathString,t.WriteObjectStart(),t.WriteProperty(n,e),i.hasVariableTarget&&t.WriteProperty("var",!0),i.isConditional&&t.WriteProperty("c",!0),i.externalArgs>0&&t.WriteIntProperty("exArgs",i.externalArgs),void t.WriteObjectEnd()}let s=o(e,F);if(s)return t.WriteObjectStart(),t.WriteProperty("*",s.pathStringOnChoice),t.WriteIntProperty("flg",s.flags),void t.WriteObjectEnd();let a=o(e,S);if(a)return void t.WriteInt(a.value);let l=o(e,w);if(l)return void t.WriteFloat(l.value);let u=o(e,x);if(u)return void(u.isNewline?t.Write("\n",!1):(t.WriteStringStart(),t.WriteStringInner("^"),t.WriteStringInner(u.value),t.WriteStringEnd()));let h=o(e,T);if(h)return void this.WriteInkList(t,h);let c=o(e,C);if(c)return t.WriteObjectStart(),null===c.value?f("divTargetVal.value"):(t.WriteProperty("^->",c.value.componentsString),void t.WriteObjectEnd());let d=o(e,N);if(d)return t.WriteObjectStart(),t.WriteProperty("^var",d.value),t.WriteIntProperty("ci",d.contextIndex),void t.WriteObjectEnd();if(o(e,P))return void t.Write("<>");let p=o(e,O);if(p)return void t.Write(U._controlCommandNames[p.commandType]);let g=o(e,L);if(g){let e=g.name;return"^"==e&&(e="L^"),void t.Write(e)}let m=o(e,W);if(m){t.WriteObjectStart();let e=m.pathStringForCount;return null!=e?t.WriteProperty("CNT?",e):t.WriteProperty("VAR?",m.name),void t.WriteObjectEnd()}let v=o(e,M);if(v){t.WriteObjectStart();let e=v.isGlobal?"VAR=":"temp=";return t.WriteProperty(e,v.variableName),v.isNewDeclaration||t.WriteProperty("re",!0),void t.WriteObjectEnd()}if(o(e,R))return void t.Write("void");let y=o(e,j);if(y)return t.WriteObjectStart(),t.WriteProperty("#",y.text),void t.WriteObjectEnd();let b=o(e,G);if(!b)throw new Error("Failed to convert runtime object to Json token: "+e);this.WriteChoice(t,b)}static JObjectToDictionaryRuntimeObjs(t){let e=new Map;for(let n in t)if(t.hasOwnProperty(n)){let i=this.JTokenToRuntimeObject(t[n]);if(null===i)return f("inkObject");e.set(n,i)}return e}static JObjectToIntDictionary(t){let e=new Map;for(let n in t)t.hasOwnProperty(n)&&e.set(n,parseInt(t[n]));return e}static JTokenToRuntimeObject(t){if("number"==typeof t&&!isNaN(t))return _.Create(t);if("string"==typeof t){let e=t.toString(),n=e[0];if("^"==n)return new x(e.substring(1));if("\n"==n&&1==e.length)return new x("\n");if("<>"==e)return new P;for(let t=0;t<U._controlCommandNames.length;++t)if(e==U._controlCommandNames[t])return new O(t);if("L^"==e&&(e="^"),L.CallExistsWithName(e))return L.CallWithName(e);if("->->"==e)return O.PopTunnel();if("~ret"==e)return O.PopFunction();if("void"==e)return new R}if("object"==typeof t&&!Array.isArray(t)){let n,i=t;if(i["^->"])return n=i["^->"],new C(new e(n.toString()));if(i["^var"]){n=i["^var"];let t=new N(n.toString());return"ci"in i&&(n=i.ci,t.contextIndex=parseInt(n)),t}let o=!1,s=!1,a=r.Function,l=!1;if((n=i["->"])?o=!0:(n=i["f()"])?(o=!0,s=!0,a=r.Function):(n=i["->t->"])?(o=!0,s=!0,a=r.Tunnel):(n=i["x()"])&&(o=!0,l=!0,s=!1,a=r.Function),o){let t=new A;t.pushesToStack=s,t.stackPushType=a,t.isExternal=l;let e=n.toString();return(n=i.var)?t.variableDivertName=e:t.targetPathString=e,t.isConditional=!!i.c,l&&(n=i.exArgs)&&(t.externalArgs=parseInt(n)),t}if(n=i["*"]){let t=new F;return t.pathStringOnChoice=n.toString(),(n=i.flg)&&(t.flags=parseInt(n)),t}if(n=i["VAR?"])return new W(n.toString());if(n=i["CNT?"]){let t=new W;return t.pathStringForCount=n.toString(),t}let u=!1,h=!1;if((n=i["VAR="])?(u=!0,h=!0):(n=i["temp="])&&(u=!0,h=!1),u){let t=n.toString(),e=!i.re,r=new M(t,e);return r.isGlobal=h,r}if(void 0!==i["#"])return n=i["#"],new j(n.toString());if(n=i.list){let t=n,e=new m;if(n=i.origins){let t=n;e.SetInitialOriginNames(t)}for(let n in t)if(t.hasOwnProperty(n)){let i=t[n],r=new g(n),o=parseInt(i);e.Add(r,o)}return new T(e)}if(null!=i.originalChoicePath)return this.JObjectToChoice(i)}if(Array.isArray(t))return this.JArrayToContainer(t);if(null==t)return null;throw new Error("Failed to convert token to runtime object: "+JSON.stringify(t))}static WriteRuntimeContainer(t,e,n=!1){if(t.WriteArrayStart(),null===e)return f("container");for(let n of e.content)this.WriteRuntimeObject(t,n);let i=e.namedOnlyContent,r=e.countFlags,s=null!=e.name&&!n,a=null!=i||r>0||s;if(a&&t.WriteObjectStart(),null!=i)for(let[e,n]of i){let i=e,r=o(n,E);t.WritePropertyStart(i),this.WriteRuntimeContainer(t,r,!0),t.WritePropertyEnd()}s&&t.WriteProperty("#n",e.name),a?t.WriteObjectEnd():t.WriteNull(),t.WriteArrayEnd()}static JArrayToContainer(t){let e=new E;e.content=this.JArrayToRuntimeObjList(t,!0);let n=t[t.length-1];if(null!=n){let t=new Map;for(let i in n)if("#f"==i)e.countFlags=parseInt(n[i]);else if("#n"==i)e.name=n[i].toString();else{let e=this.JTokenToRuntimeObject(n[i]),r=o(e,E);r&&(r.name=i),t.set(i,e)}e.namedOnlyContent=t}return e}static JObjectToChoice(t){let e=new G;return e.text=t.text.toString(),e.index=parseInt(t.index),e.sourcePath=t.originalChoicePath.toString(),e.originalThreadIndex=parseInt(t.originalThreadIndex),e.pathStringOnChoice=t.targetPath.toString(),e}static WriteChoice(t,e){t.WriteObjectStart(),t.WriteProperty("text",e.text),t.WriteIntProperty("index",e.index),t.WriteProperty("originalChoicePath",e.sourcePath),t.WriteIntProperty("originalThreadIndex",e.originalThreadIndex),t.WriteProperty("targetPath",e.pathStringOnChoice),t.WriteObjectEnd()}static WriteInkList(t,e){let n=e.value;if(null===n)return f("rawList");t.WriteObjectStart(),t.WritePropertyStart("list"),t.WriteObjectStart();for(let[e,i]of n){let n=g.fromSerializedKey(e),r=i;if(null===n.itemName)return f("item.itemName");t.WritePropertyNameStart(),t.WritePropertyNameInner(n.originName?n.originName:"?"),t.WritePropertyNameInner("."),t.WritePropertyNameInner(n.itemName),t.WritePropertyNameEnd(),t.Write(r),t.WritePropertyEnd()}if(t.WriteObjectEnd(),t.WritePropertyEnd(),0==n.Count&&null!=n.originNames&&n.originNames.length>0){t.WritePropertyStart("origins"),t.WriteArrayStart();for(let e of n.originNames)t.Write(e);t.WriteArrayEnd(),t.WritePropertyEnd()}t.WriteObjectEnd()}static ListDefinitionsToJToken(t){let e={};for(let n of t.lists){let t={};for(let[e,i]of n.items){let n=g.fromSerializedKey(e);if(null===n.itemName)return f("item.itemName");t[n.itemName]=i}e[n.name]=t}return e}static JTokenToListDefinitions(t){let e=t,n=[];for(let t in e)if(e.hasOwnProperty(t)){let i=t.toString(),r=e[t],o=new Map;for(let n in r)if(e.hasOwnProperty(t)){let t=r[n];o.set(n,parseInt(t))}let s=new V(i,o);n.push(s)}return new D(n)}}U._controlCommandNames=(()=>{let t=[];t[O.CommandType.EvalStart]="ev",t[O.CommandType.EvalOutput]="out",t[O.CommandType.EvalEnd]="/ev",t[O.CommandType.Duplicate]="du",t[O.CommandType.PopEvaluatedValue]="pop",t[O.CommandType.PopFunction]="~ret",t[O.CommandType.PopTunnel]="->->",t[O.CommandType.BeginString]="str",t[O.CommandType.EndString]="/str",t[O.CommandType.NoOp]="nop",t[O.CommandType.ChoiceCount]="choiceCnt",t[O.CommandType.Turns]="turn",t[O.CommandType.TurnsSince]="turns",t[O.CommandType.ReadCount]="readc",t[O.CommandType.Random]="rnd",t[O.CommandType.SeedRandom]="srnd",t[O.CommandType.VisitIndex]="visit",t[O.CommandType.SequenceShuffleIndex]="seq",t[O.CommandType.StartThread]="thread",t[O.CommandType.Done]="done",t[O.CommandType.End]="end",t[O.CommandType.ListFromInt]="listInt",t[O.CommandType.ListRange]="range",t[O.CommandType.ListRandom]="lrnd";for(let e=0;e<O.CommandType.TOTAL_VALUES;++e)if(null==t[e])throw new Error("Control command not accounted for in serialisation");return t})();class B{constructor(){if(this._threadCounter=0,this._startOfRoot=I.Null,arguments[0]instanceof J){let t=arguments[0];this._startOfRoot=I.StartOf(t.rootContentContainer),this.Reset()}else{let t=arguments[0];this._threads=[];for(let e of t._threads)this._threads.push(e.Copy());this._threadCounter=t._threadCounter,this._startOfRoot=t._startOfRoot}}get elements(){return this.callStack}get depth(){return this.elements.length}get currentElement(){let t=this._threads[this._threads.length-1].callstack;return t[t.length-1]}get currentElementIndex(){return this.callStack.length-1}get currentThread(){return this._threads[this._threads.length-1]}set currentThread(t){n.Assert(1==this._threads.length,"Shouldn't be directly setting the current thread when we have a stack of them"),this._threads.length=0,this._threads.push(t)}get canPop(){return this.callStack.length>1}Reset(){this._threads=[],this._threads.push(new B.Thread),this._threads[0].callstack.push(new B.Element(r.Tunnel,this._startOfRoot))}SetJsonToken(t,e){this._threads.length=0;let n=t.threads;for(let t of n){let n=t,i=new B.Thread(n,e);this._threads.push(i)}this._threadCounter=parseInt(t.threadCounter),this._startOfRoot=I.StartOf(e.rootContentContainer)}WriteJson(t){t.WriteObject(t=>{t.WritePropertyStart("threads"),t.WriteArrayStart();for(let e of this._threads)e.WriteJson(t);t.WriteArrayEnd(),t.WritePropertyEnd(),t.WritePropertyStart("threadCounter"),t.WriteInt(this._threadCounter),t.WritePropertyEnd()})}PushThread(){let t=this.currentThread.Copy();this._threadCounter++,t.threadIndex=this._threadCounter,this._threads.push(t)}ForkThread(){let t=this.currentThread.Copy();return this._threadCounter++,t.threadIndex=this._threadCounter,t}PopThread(){if(!this.canPopThread)throw new Error("Can't pop thread");this._threads.splice(this._threads.indexOf(this.currentThread),1)}get canPopThread(){return this._threads.length>1&&!this.elementIsEvaluateFromGame}get elementIsEvaluateFromGame(){return this.currentElement.type==r.FunctionEvaluationFromGame}Push(t,e=0,n=0){let i=new B.Element(t,this.currentElement.currentPointer,!1);i.evaluationStackHeightWhenPushed=e,i.functionStartInOutputStream=n,this.callStack.push(i)}CanPop(t=null){return!!this.canPop&&(null==t||this.currentElement.type==t)}Pop(t=null){if(!this.CanPop(t))throw new Error("Mismatched push/pop in Callstack");this.callStack.pop()}GetTemporaryVariableWithName(t,e=-1){-1==e&&(e=this.currentElementIndex+1);let n=y(this.callStack[e-1].temporaryVariables,t,null);return n.exists?n.result:null}SetTemporaryVariable(t,e,n,i=-1){-1==i&&(i=this.currentElementIndex+1);let r=this.callStack[i-1];if(!n&&!r.temporaryVariables.get(t))throw new v("Could not find temporary variable to set: "+t);let o=y(r.temporaryVariables,t,null);o.exists&&T.RetainListOriginsForAssignment(o.result,e),r.temporaryVariables.set(t,e)}ContextForVariableNamed(t){return this.currentElement.temporaryVariables.get(t)?this.currentElementIndex+1:0}ThreadWithIndex(t){let e=this._threads.filter(e=>{if(e.threadIndex==t)return e});return e.length>0?e[0]:null}get callStack(){return this.currentThread.callstack}get callStackTrace(){let t=new p;for(let e=0;e<this._threads.length;e++){let n=this._threads[e],i=e==this._threads.length-1;t.AppendFormat("=== THREAD {0}/{1} {2}===\n",e+1,this._threads.length,i?"(current) ":"");for(let e=0;e<n.callstack.length;e++){n.callstack[e].type==r.Function?t.Append("  [FUNCTION] "):t.Append("  [TUNNEL] ");let i=n.callstack[e].currentPointer;if(!i.isNull){if(t.Append("<SOMEWHERE IN "),null===i.container)return f("pointer.container");t.Append(i.container.path.toString()),t.AppendLine(">")}}}return t.toString()}}!function(t){class n{constructor(t,e,n=!1){this.evaluationStackHeightWhenPushed=0,this.functionStartInOutputStream=0,this.currentPointer=e.copy(),this.inExpressionEvaluation=n,this.temporaryVariables=new Map,this.type=t}Copy(){let t=new n(this.type,this.currentPointer,this.inExpressionEvaluation);return t.temporaryVariables=new Map(this.temporaryVariables),t.evaluationStackHeightWhenPushed=this.evaluationStackHeightWhenPushed,t.functionStartInOutputStream=this.functionStartInOutputStream,t}}t.Element=n;class i{constructor(){if(this.threadIndex=0,this.previousPointer=I.Null,this.callstack=[],arguments[0]&&arguments[1]){let t=arguments[0],i=arguments[1];this.threadIndex=parseInt(t.threadIndex);let r=t.callstack;for(let t of r){let r,o=t,s=parseInt(o.type),a=I.Null,l=o.cPath;if(void 0!==l){r=l.toString();let t=i.ContentAtPath(new e(r));if(a.container=t.container,a.index=parseInt(o.idx),null==t.obj)throw new Error("When loading state, internal story location couldn't be found: "+r+". Has the story changed since this save data was created?");if(t.approximate){if(null===a.container)return f("pointer.container");i.Warning("When loading state, exact internal story location couldn't be found: '"+r+"', so it was approximated to '"+a.container.path.toString()+"' to recover. Has the story changed since this save data was created?")}}let u=!!o.exp,h=new n(s,a,u),c=o.temp;void 0!==c?h.temporaryVariables=U.JObjectToDictionaryRuntimeObjs(c):h.temporaryVariables.clear(),this.callstack.push(h)}let o=t.previousContentObject;if(void 0!==o){let t=new e(o.toString());this.previousPointer=i.PointerAtPath(t)}}}Copy(){let t=new i;t.threadIndex=this.threadIndex;for(let e of this.callstack)t.callstack.push(e.Copy());return t.previousPointer=this.previousPointer.copy(),t}WriteJson(t){t.WriteObjectStart(),t.WritePropertyStart("callstack"),t.WriteArrayStart();for(let e of this.callstack){if(t.WriteObjectStart(),!e.currentPointer.isNull){if(null===e.currentPointer.container)return f("el.currentPointer.container");t.WriteProperty("cPath",e.currentPointer.container.path.componentsString),t.WriteIntProperty("idx",e.currentPointer.index)}t.WriteProperty("exp",e.inExpressionEvaluation),t.WriteIntProperty("type",e.type),e.temporaryVariables.size>0&&(t.WritePropertyStart("temp"),U.WriteDictionaryRuntimeObjs(t,e.temporaryVariables),t.WritePropertyEnd()),t.WriteObjectEnd()}if(t.WriteArrayEnd(),t.WritePropertyEnd(),t.WriteIntProperty("threadIndex",this.threadIndex),!this.previousPointer.isNull){let e=this.previousPointer.Resolve();if(null===e)return f("this.previousPointer.Resolve()");t.WriteProperty("previousContentObject",e.path.toString())}t.WriteObjectEnd()}}t.Thread=i}(B||(B={}));class z{constructor(t,e){this.variableChangedEventCallbacks=[],this.patch=null,this._batchObservingVariableChanges=!1,this._defaultGlobalVariables=new Map,this._changedVariablesForBatchObs=new Set,this._globalVariables=new Map,this._callStack=t,this._listDefsOrigin=e;try{return new Proxy(this,{get:(t,e)=>e in t?t[e]:t.$(e),set:(t,e,n)=>(e in t?t[e]=n:t.$(e,n),!0)})}catch(t){}}variableChangedEvent(t,e){for(let n of this.variableChangedEventCallbacks)n(t,e)}get batchObservingVariableChanges(){return this._batchObservingVariableChanges}set batchObservingVariableChanges(t){if(this._batchObservingVariableChanges=t,t)this._changedVariablesForBatchObs=new Set;else if(null!=this._changedVariablesForBatchObs){for(let t of this._changedVariablesForBatchObs){let e=this._globalVariables.get(t);e?this.variableChangedEvent(t,e):f("currentValue")}this._changedVariablesForBatchObs=null}}get callStack(){return this._callStack}set callStack(t){this._callStack=t}$(t,e){if(void 0===e){let e=null;return null!==this.patch&&(e=this.patch.TryGetGlobal(t,null),e.exists)?e.result.valueObject:(e=this._globalVariables.get(t),void 0===e&&(e=this._defaultGlobalVariables.get(t)),void 0!==e?e.valueObject:null)}{if(void 0===this._defaultGlobalVariables.get(t))throw new v("Cannot assign to a variable ("+t+") that hasn't been declared in the story");let n=_.Create(e);if(null==n)throw new v(null==e?"Cannot pass null to VariableState":"Invalid value passed to VariableState: "+e.toString());this.SetGlobal(t,n)}}ApplyPatch(){if(null===this.patch)return f("this.patch");for(let[t,e]of this.patch.globals)this._globalVariables.set(t,e);if(null!==this._changedVariablesForBatchObs)for(let t of this.patch.changedVariables)this._changedVariablesForBatchObs.add(t);this.patch=null}SetJsonToken(t){this._globalVariables.clear();for(let[e,n]of this._defaultGlobalVariables){let i=t[e];if(void 0!==i){let t=U.JTokenToRuntimeObject(i);if(null===t)return f("tokenInkObject");this._globalVariables.set(e,t)}else this._globalVariables.set(e,n)}}WriteJson(t){t.WriteObjectStart();for(let[e,n]of this._globalVariables){let i=e,r=n;if(z.dontSaveDefaultValues&&this._defaultGlobalVariables.has(i)){let t=this._defaultGlobalVariables.get(i);if(this.RuntimeObjectsEqual(r,t))continue}t.WritePropertyStart(i),U.WriteRuntimeObject(t,r),t.WritePropertyEnd()}t.WriteObjectEnd()}RuntimeObjectsEqual(t,e){if(null===t)return f("obj1");if(null===e)return f("obj2");if(t.constructor!==e.constructor)return!1;let n=o(t,S);if(null!==n)return n.value===s(e,S).value;let i=o(t,w);if(null!==i)return i.value===s(e,w).value;let r=o(t,_),a=o(e,_);if(null!==r&&null!==a)return u(r.valueObject)&&u(a.valueObject)?r.valueObject.Equals(a.valueObject):r.valueObject===a.valueObject;throw new Error("FastRoughDefinitelyEquals: Unsupported runtime object type: "+t.constructor.name)}GetVariableWithName(t,e=-1){let n=this.GetRawVariableWithName(t,e),i=o(n,N);return null!==i&&(n=this.ValueAtVariablePointer(i)),n}TryGetDefaultVariableValue(t){let e=y(this._defaultGlobalVariables,t,null);return e.exists?e.result:null}GlobalVariableExistsWithName(t){return this._globalVariables.has(t)||null!==this._defaultGlobalVariables&&this._defaultGlobalVariables.has(t)}GetRawVariableWithName(t,e){let n=null;if(0==e||-1==e){let e=null;if(null!==this.patch&&(e=this.patch.TryGetGlobal(t,null),e.exists))return e.result;if(e=y(this._globalVariables,t,null),e.exists)return e.result;if(null!==this._defaultGlobalVariables&&(e=y(this._defaultGlobalVariables,t,null),e.exists))return e.result;if(null===this._listDefsOrigin)return f("VariablesState._listDefsOrigin");let n=this._listDefsOrigin.FindSingleItemListWithName(t);if(n)return n}return n=this._callStack.GetTemporaryVariableWithName(t,e),n}ValueAtVariablePointer(t){return this.GetVariableWithName(t.variableName,t.contextIndex)}Assign(t,e){let n=t.variableName;if(null===n)return f("name");let i=-1,r=!1;if(r=t.isNewDeclaration?t.isGlobal:this.GlobalVariableExistsWithName(n),t.isNewDeclaration){let t=o(e,N);null!==t&&(e=this.ResolveVariablePointer(t))}else{let t=null;do{t=o(this.GetRawVariableWithName(n,i),N),null!=t&&(n=t.variableName,i=t.contextIndex,r=0==i)}while(null!=t)}r?this.SetGlobal(n,e):this._callStack.SetTemporaryVariable(n,e,t.isNewDeclaration,i)}SnapshotDefaultGlobals(){this._defaultGlobalVariables=new Map(this._globalVariables)}RetainListOriginsForAssignment(t,e){let n=s(t,T),i=s(e,T);n.value&&i.value&&0==i.value.Count&&i.value.SetInitialOriginNames(n.value.originNames)}SetGlobal(t,e){let n=null;if(null===this.patch&&(n=y(this._globalVariables,t,null)),null!==this.patch&&(n=this.patch.TryGetGlobal(t,null),n.exists||(n=y(this._globalVariables,t,null))),T.RetainListOriginsForAssignment(n.result,e),null===t)return f("variableName");if(null!==this.patch?this.patch.SetGlobal(t,e):this._globalVariables.set(t,e),null!==this.variableChangedEvent&&null!==n&&e!==n.result)if(this.batchObservingVariableChanges){if(null===this._changedVariablesForBatchObs)return f("this._changedVariablesForBatchObs");null!==this.patch?this.patch.AddChangedVariable(t):null!==this._changedVariablesForBatchObs&&this._changedVariablesForBatchObs.add(t)}else this.variableChangedEvent(t,e)}ResolveVariablePointer(t){let e=t.contextIndex;-1==e&&(e=this.GetContextIndexOfVariableNamed(t.variableName));let n=o(this.GetRawVariableWithName(t.variableName,e),N);return null!=n?n:new N(t.variableName,e)}GetContextIndexOfVariableNamed(t){return this.GlobalVariableExistsWithName(t)?0:this._callStack.currentElementIndex}ObserveVariableChange(t){this.variableChangedEventCallbacks.push(t)}}z.dontSaveDefaultValues=!0;class q{constructor(t){this.seed=t%2147483647,this.seed<=0&&(this.seed+=2147483646)}next(){return this.seed=16807*this.seed%2147483647}nextFloat(){return(this.next()-1)/2147483646}}class H{constructor(){if(this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map,1===arguments.length&&null!==arguments[0]){let t=arguments[0];this._globals=new Map(t._globals),this._changedVariables=new Set(t._changedVariables),this._visitCounts=new Map(t._visitCounts),this._turnIndices=new Map(t._turnIndices)}else this._globals=new Map,this._changedVariables=new Set,this._visitCounts=new Map,this._turnIndices=new Map}get globals(){return this._globals}get changedVariables(){return this._changedVariables}get visitCounts(){return this._visitCounts}get turnIndices(){return this._turnIndices}TryGetGlobal(t,e){return null!==t&&this._globals.has(t)?{result:this._globals.get(t),exists:!0}:{result:e,exists:!1}}SetGlobal(t,e){this._globals.set(t,e)}AddChangedVariable(t){return this._changedVariables.add(t)}TryGetVisitCount(t,e){return this._visitCounts.has(t)?{result:this._visitCounts.get(t),exists:!0}:{result:e,exists:!1}}SetVisitCount(t,e){this._visitCounts.set(t,e)}SetTurnIndex(t,e){this._turnIndices.set(t,e)}TryGetTurnIndex(t,e){return this._turnIndices.has(t)?{result:this._turnIndices.get(t),exists:!0}:{result:e,exists:!1}}}class Y{static TextToDictionary(t){return new Y.Reader(t).ToDictionary()}static TextToArray(t){return new Y.Reader(t).ToArray()}}!function(t){t.Reader=class{constructor(t){this._rootObject=JSON.parse(t)}ToDictionary(){return this._rootObject}ToArray(){return this._rootObject}};class e{constructor(){this._currentPropertyName=null,this._currentString=null,this._stateStack=[],this._collectionStack=[],this._propertyNameStack=[],this._jsonObject=null}WriteObject(t){this.WriteObjectStart(),t(this),this.WriteObjectEnd()}WriteObjectStart(){this.StartNewObject(!0);let e={};if(this.state===t.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);let t=this._propertyNameStack.pop();this.currentCollection[t]=e,this._collectionStack.push(e)}else this.state===t.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Object))}WriteObjectEnd(){this.Assert(this.state===t.Writer.State.Object),this._collectionStack.pop(),this._stateStack.pop()}WriteProperty(t,e){if(this.WritePropertyStart(t),arguments[1]instanceof Function)(0,arguments[1])(this);else{let t=arguments[1];this.Write(t)}this.WritePropertyEnd()}WriteIntProperty(t,e){this.WritePropertyStart(t),this.WriteInt(e),this.WritePropertyEnd()}WriteFloatProperty(t,e){this.WritePropertyStart(t),this.WriteFloat(e),this.WritePropertyEnd()}WritePropertyStart(e){this.Assert(this.state===t.Writer.State.Object),this._propertyNameStack.push(e),this.IncrementChildCount(),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property))}WritePropertyEnd(){this.Assert(this.state===t.Writer.State.Property),this.Assert(1===this.childCount),this._stateStack.pop()}WritePropertyNameStart(){this.Assert(this.state===t.Writer.State.Object),this.IncrementChildCount(),this._currentPropertyName="",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Property)),this._stateStack.push(new t.Writer.StateElement(t.Writer.State.PropertyName))}WritePropertyNameEnd(){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._propertyNameStack.push(this._currentPropertyName),this._currentPropertyName=null,this._stateStack.pop()}WritePropertyNameInner(e){this.Assert(this.state===t.Writer.State.PropertyName),this.Assert(null!==this._currentPropertyName),this._currentPropertyName+=e}WriteArrayStart(){this.StartNewObject(!0);let e=[];if(this.state===t.Writer.State.Property){this.Assert(null!==this.currentCollection),this.Assert(null!==this.currentPropertyName);let t=this._propertyNameStack.pop();this.currentCollection[t]=e,this._collectionStack.push(e)}else this.state===t.Writer.State.Array?(this.Assert(null!==this.currentCollection),this.currentCollection.push(e),this._collectionStack.push(e)):(this.Assert(this.state===t.Writer.State.None),this._jsonObject=e,this._collectionStack.push(e));this._stateStack.push(new t.Writer.StateElement(t.Writer.State.Array))}WriteArrayEnd(){this.Assert(this.state===t.Writer.State.Array),this._collectionStack.pop(),this._stateStack.pop()}Write(t,e=!0){null!==t?(this.StartNewObject(!1),this._addToCurrentObject(t)):console.error("Warning: trying to write a null string")}WriteInt(t){null!==t&&(this.StartNewObject(!1),this._addToCurrentObject(Math.floor(t)))}WriteFloat(t){null!==t&&(this.StartNewObject(!1),t==Number.POSITIVE_INFINITY?this._addToCurrentObject(34e37):t==Number.NEGATIVE_INFINITY?this._addToCurrentObject(-34e37):isNaN(t)?this._addToCurrentObject(0):this._addToCurrentObject(t))}WriteNull(){this.StartNewObject(!1),this._addToCurrentObject(null)}WriteStringStart(){this.StartNewObject(!1),this._currentString="",this._stateStack.push(new t.Writer.StateElement(t.Writer.State.String))}WriteStringEnd(){this.Assert(this.state==t.Writer.State.String),this._stateStack.pop(),this._addToCurrentObject(this._currentString),this._currentString=null}WriteStringInner(e,n=!0){this.Assert(this.state===t.Writer.State.String),null!==e?this._currentString+=e:console.error("Warning: trying to write a null string")}ToString(){return null===this._jsonObject?"":JSON.stringify(this._jsonObject)}StartNewObject(e){e?this.Assert(this.state===t.Writer.State.None||this.state===t.Writer.State.Property||this.state===t.Writer.State.Array):this.Assert(this.state===t.Writer.State.Property||this.state===t.Writer.State.Array),this.state===t.Writer.State.Property&&this.Assert(0===this.childCount),this.state!==t.Writer.State.Array&&this.state!==t.Writer.State.Property||this.IncrementChildCount()}get state(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].type:t.Writer.State.None}get childCount(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].childCount:0}get currentCollection(){return this._collectionStack.length>0?this._collectionStack[this._collectionStack.length-1]:null}get currentPropertyName(){return this._propertyNameStack.length>0?this._propertyNameStack[this._propertyNameStack.length-1]:null}IncrementChildCount(){this.Assert(this._stateStack.length>0);let t=this._stateStack.pop();t.childCount++,this._stateStack.push(t)}Assert(t){if(!t)throw Error("Assert failed while writing JSON")}_addToCurrentObject(e){this.Assert(null!==this.currentCollection),this.state===t.Writer.State.Array?(this.Assert(Array.isArray(this.currentCollection)),this.currentCollection.push(e)):this.state===t.Writer.State.Property&&(this.Assert(!Array.isArray(this.currentCollection)),this.Assert(null!==this.currentPropertyName),this.currentCollection[this.currentPropertyName]=e,this._propertyNameStack.pop())}}t.Writer=e,function(e){let n;!function(t){t[t.None=0]="None",t[t.Object=1]="Object",t[t.Array=2]="Array",t[t.Property=3]="Property",t[t.PropertyName=4]="PropertyName",t[t.String=5]="String"}(n=e.State||(e.State={})),e.StateElement=class{constructor(e){this.type=t.Writer.State.None,this.childCount=0,this.type=e}}}(e=t.Writer||(t.Writer={}))}(Y||(Y={}));class X{constructor(t){this.kInkSaveStateVersion=8,this.kMinCompatibleLoadVersion=8,this._currentErrors=null,this._currentWarnings=null,this.divertedPointer=I.Null,this._currentTurnIndex=0,this.storySeed=0,this.previousRandom=0,this.didSafeExit=!1,this._currentText=null,this._currentTags=null,this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0,this._patch=null,this.story=t,this._outputStream=[],this.OutputStreamDirty(),this._evaluationStack=[],this.callStack=new B(t),this._variablesState=new z(this.callStack,t.listDefinitions),this._visitCounts=new Map,this._turnIndices=new Map,this.currentTurnIndex=-1;let e=(new Date).getTime();this.storySeed=new q(e).next()%100,this.previousRandom=0,this._currentChoices=[],this.GoToStart()}ToJson(t=!1){let e=new Y.Writer;return this.WriteJson(e),e.ToString()}toJson(t=!1){return this.ToJson(t)}LoadJson(t){let e=Y.TextToDictionary(t);this.LoadJsonObj(e)}VisitCountAtPathString(t){let n;if(null!==this._patch){let i=this.story.ContentAtPath(new e(t)).container;if(null===i)throw new Error("Content at path not found: "+t);if(n=this._patch.TryGetVisitCount(i,0),n.exists)return n.result}return n=y(this._visitCounts,t,null),n.exists?n.result:0}VisitCountForContainer(t){if(null===t)return f("container");if(!t.visitsShouldBeCounted)return this.story.Error("Read count for target ("+t.name+" - on "+t.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),0;if(null!==this._patch){let e=this._patch.TryGetVisitCount(t,0);if(e.exists)return e.result}let e=t.path.toString(),n=y(this._visitCounts,e,null);return n.exists?n.result:0}IncrementVisitCountForContainer(t){if(null!==this._patch){let e=this.VisitCountForContainer(t);return e++,void this._patch.SetVisitCount(t,e)}let e=t.path.toString(),n=y(this._visitCounts,e,null);n.exists?this._visitCounts.set(e,n.result+1):this._visitCounts.set(e,1)}RecordTurnIndexVisitToContainer(t){if(null!==this._patch)return void this._patch.SetTurnIndex(t,this.currentTurnIndex);let e=t.path.toString();this._turnIndices.set(e,this.currentTurnIndex)}TurnsSinceForContainer(t){if(t.turnIndexShouldBeCounted||this.story.Error("TURNS_SINCE() for target ("+t.name+" - on "+t.debugMetadata+") unknown. The story may need to be compiled with countAllVisits flag (-c)."),null!==this._patch){let e=this._patch.TryGetTurnIndex(t,0);if(e.exists)return this.currentTurnIndex-e.result}let e=t.path.toString(),n=y(this._turnIndices,e,0);return n.exists?this.currentTurnIndex-n.result:-1}get callstackDepth(){return this.callStack.depth}get outputStream(){return this._outputStream}get currentChoices(){return this.canContinue?[]:this._currentChoices}get generatedChoices(){return this._currentChoices}get currentErrors(){return this._currentErrors}get currentWarnings(){return this._currentWarnings}get variablesState(){return this._variablesState}set variablesState(t){this._variablesState=t}get evaluationStack(){return this._evaluationStack}get visitCounts(){return this._visitCounts}get turnIndices(){return this._turnIndices}get currentTurnIndex(){return this._currentTurnIndex}set currentTurnIndex(t){this._currentTurnIndex=t}get currentPathString(){let t=this.currentPointer;return t.isNull?null:null===t.path?f("pointer.path"):t.path.toString()}get currentPointer(){return this.callStack.currentElement.currentPointer.copy()}set currentPointer(t){this.callStack.currentElement.currentPointer=t.copy()}get previousPointer(){return this.callStack.currentThread.previousPointer.copy()}set previousPointer(t){this.callStack.currentThread.previousPointer=t.copy()}get canContinue(){return!this.currentPointer.isNull&&!this.hasError}get hasError(){return null!=this.currentErrors&&this.currentErrors.length>0}get hasWarning(){return null!=this.currentWarnings&&this.currentWarnings.length>0}get currentText(){if(this._outputStreamTextDirty){let t=new p;for(let e of this._outputStream){let n=o(e,x);null!==n&&t.Append(n.value)}this._currentText=this.CleanOutputWhitespace(t.toString()),this._outputStreamTextDirty=!1}return this._currentText}CleanOutputWhitespace(t){let e=new p,n=-1,i=0;for(let r=0;r<t.length;r++){let o=t.charAt(r),s=" "==o||"\t"==o;s&&-1==n&&(n=r),s||("\n"!=o&&n>0&&n!=i&&e.Append(" "),n=-1),"\n"==o&&(i=r+1),s||e.Append(o)}return e.toString()}get currentTags(){if(this._outputStreamTagsDirty){this._currentTags=[];for(let t of this._outputStream){let e=o(t,j);null!==e&&this._currentTags.push(e.text)}this._outputStreamTagsDirty=!1}return this._currentTags}get inExpressionEvaluation(){return this.callStack.currentElement.inExpressionEvaluation}set inExpressionEvaluation(t){this.callStack.currentElement.inExpressionEvaluation=t}GoToStart(){this.callStack.currentElement.currentPointer=I.StartOf(this.story.mainContentContainer)}CopyAndStartPatching(){let t=new X(this.story);return t._patch=new H(this._patch),t.outputStream.push.apply(t.outputStream,this._outputStream),t.OutputStreamDirty(),t._currentChoices.push.apply(t._currentChoices,this._currentChoices),this.hasError&&(t._currentErrors=[],t._currentErrors.push.apply(t._currentErrors,this.currentErrors||[])),this.hasWarning&&(t._currentWarnings=[],t._currentWarnings.push.apply(t._currentWarnings,this.currentWarnings||[])),t.callStack=new B(this.callStack),t.variablesState=this.variablesState,t.variablesState.callStack=t.callStack,t.variablesState.patch=t._patch,t.evaluationStack.push.apply(t.evaluationStack,this.evaluationStack),this.divertedPointer.isNull||(t.divertedPointer=this.divertedPointer.copy()),t.previousPointer=this.previousPointer.copy(),t._visitCounts=this._visitCounts,t._turnIndices=this._turnIndices,t.currentTurnIndex=this.currentTurnIndex,t.storySeed=this.storySeed,t.previousRandom=this.previousRandom,t.didSafeExit=this.didSafeExit,t}RestoreAfterPatch(){this.variablesState.callStack=this.callStack,this.variablesState.patch=this._patch}ApplyAnyPatch(){if(null!==this._patch){this.variablesState.ApplyPatch();for(let[t,e]of this._patch.visitCounts)this.ApplyCountChanges(t,e,!0);for(let[t,e]of this._patch.turnIndices)this.ApplyCountChanges(t,e,!1);this._patch=null}}ApplyCountChanges(t,e,n){(n?this._visitCounts:this._turnIndices).set(t.path.toString(),e)}WriteJson(t){t.WriteObjectStart();let e=!1;for(let n of this._currentChoices){if(null===n.threadAtGeneration)return f("c.threadAtGeneration");n.originalThreadIndex=n.threadAtGeneration.threadIndex,null===this.callStack.ThreadWithIndex(n.originalThreadIndex)&&(e||(e=!0,t.WritePropertyStart("choiceThreads"),t.WriteObjectStart()),t.WritePropertyStart(n.originalThreadIndex),n.threadAtGeneration.WriteJson(t),t.WritePropertyEnd())}if(e&&(t.WriteObjectEnd(),t.WritePropertyEnd()),t.WriteProperty("callstackThreads",t=>this.callStack.WriteJson(t)),t.WriteProperty("variablesState",t=>this.variablesState.WriteJson(t)),t.WriteProperty("evalStack",t=>U.WriteListRuntimeObjs(t,this.evaluationStack)),t.WriteProperty("outputStream",t=>U.WriteListRuntimeObjs(t,this._outputStream)),t.WriteProperty("currentChoices",t=>{t.WriteArrayStart();for(let e of this._currentChoices)U.WriteChoice(t,e);t.WriteArrayEnd()}),!this.divertedPointer.isNull){if(null===this.divertedPointer.path)return f("divertedPointer");t.WriteProperty("currentDivertTarget",this.divertedPointer.path.componentsString)}t.WriteProperty("visitCounts",t=>U.WriteIntDictionary(t,this._visitCounts)),t.WriteProperty("turnIndices",t=>U.WriteIntDictionary(t,this._turnIndices)),t.WriteIntProperty("turnIdx",this.currentTurnIndex),t.WriteIntProperty("storySeed",this.storySeed),t.WriteIntProperty("previousRandom",this.previousRandom),t.WriteIntProperty("inkSaveVersion",this.kInkSaveStateVersion),t.WriteIntProperty("inkFormatVersion",J.inkVersionCurrent),t.WriteObjectEnd()}LoadJsonObj(t){let n=t,i=n.inkSaveVersion;if(null==i)throw new v("ink save format incorrect, can't load.");if(parseInt(i)<this.kMinCompatibleLoadVersion)throw new v("Ink save format isn't compatible with the current version (saw '"+i+"', but minimum is "+this.kMinCompatibleLoadVersion+"), so can't load.");this.callStack.SetJsonToken(n.callstackThreads,this.story),this.variablesState.SetJsonToken(n.variablesState),this._evaluationStack=U.JArrayToRuntimeObjList(n.evalStack),this._outputStream=U.JArrayToRuntimeObjList(n.outputStream),this.OutputStreamDirty(),this._currentChoices=U.JArrayToRuntimeObjList(n.currentChoices);let r=n.currentDivertTarget;if(null!=r){let t=new e(r.toString());this.divertedPointer=this.story.PointerAtPath(t)}this._visitCounts=U.JObjectToIntDictionary(n.visitCounts),this._turnIndices=U.JObjectToIntDictionary(n.turnIndices),this.currentTurnIndex=parseInt(n.turnIdx),this.storySeed=parseInt(n.storySeed),this.previousRandom=parseInt(n.previousRandom);let o=n.choiceThreads;for(let t of this._currentChoices){let e=this.callStack.ThreadWithIndex(t.originalThreadIndex);if(null!=e)t.threadAtGeneration=e.Copy();else{let e=o[t.originalThreadIndex.toString()];t.threadAtGeneration=new B.Thread(e,this.story)}}}ResetErrors(){this._currentErrors=null,this._currentWarnings=null}ResetOutput(t=null){this._outputStream.length=0,null!==t&&this._outputStream.push.apply(this._outputStream,t),this.OutputStreamDirty()}PushToOutputStream(t){let e=o(t,x);if(null!==e){let t=this.TrySplittingHeadTailWhitespace(e);if(null!==t){for(let e of t)this.PushToOutputStreamIndividual(e);return void this.OutputStreamDirty()}}this.PushToOutputStreamIndividual(t),this.OutputStreamDirty()}PopFromOutputStream(t){this.outputStream.splice(this.outputStream.length-t,t),this.OutputStreamDirty()}TrySplittingHeadTailWhitespace(t){let e=t.value;if(null===e)return f("single.value");let n=-1,i=-1;for(let t=0;t<e.length;++t){let r=e[t];if("\n"!=r){if(" "==r||"\t"==r)continue;break}-1==n&&(n=t),i=t}let r=-1,o=-1;for(let t=0;t<e.length;++t){let n=e[t];if("\n"!=n){if(" "==n||"\t"==n)continue;break}-1==r&&(r=t),o=t}if(-1==n&&-1==r)return null;let s=[],a=0,l=e.length;if(-1!=n){if(n>0){let t=new x(e.substring(0,n));s.push(t)}s.push(new x("\n")),a=i+1}if(-1!=r&&(l=o),l>a){let t=e.substring(a,l-a);s.push(new x(t))}if(-1!=r&&o>i&&(s.push(new x("\n")),r<e.length-1)){let t=e.length-r-1,n=new x(e.substring(r+1,t));s.push(n)}return s}PushToOutputStreamIndividual(t){let e=o(t,P),n=o(t,x),i=!0;if(e)this.TrimNewlinesFromOutputStream(),i=!0;else if(n){let t=-1,e=this.callStack.currentElement;e.type==r.Function&&(t=e.functionStartInOutputStream);let o=-1;for(let e=this._outputStream.length-1;e>=0;e--){let n=this._outputStream[e],i=n instanceof O?n:null;if(null!=(n instanceof P?n:null)){o=e;break}if(null!=i&&i.commandType==O.CommandType.BeginString){e>=t&&(t=-1);break}}let s=-1;if(s=-1!=o&&-1!=t?Math.min(t,o):-1!=o?o:t,-1!=s){if(n.isNewline)i=!1;else if(n.isNonWhitespace&&(o>-1&&this.RemoveExistingGlue(),t>-1)){let t=this.callStack.elements;for(let e=t.length-1;e>=0;e--){let n=t[e];if(n.type!=r.Function)break;n.functionStartInOutputStream=-1}}}else n.isNewline&&(!this.outputStreamEndsInNewline&&this.outputStreamContainsContent||(i=!1))}if(i){if(null===t)return f("obj");this._outputStream.push(t),this.OutputStreamDirty()}}TrimNewlinesFromOutputStream(){let t=-1,e=this._outputStream.length-1;for(;e>=0;){let n=this._outputStream[e],i=o(n,O),r=o(n,x);if(null!=i||null!=r&&r.isNonWhitespace)break;null!=r&&r.isNewline&&(t=e),e--}if(t>=0)for(e=t;e<this._outputStream.length;)o(this._outputStream[e],x)?this._outputStream.splice(e,1):e++;this.OutputStreamDirty()}RemoveExistingGlue(){for(let t=this._outputStream.length-1;t>=0;t--){let e=this._outputStream[t];if(e instanceof P)this._outputStream.splice(t,1);else if(e instanceof O)break}this.OutputStreamDirty()}get outputStreamEndsInNewline(){if(this._outputStream.length>0)for(let t=this._outputStream.length-1;t>=0&&!(this._outputStream[t]instanceof O);t--){let e=this._outputStream[t];if(e instanceof x){if(e.isNewline)return!0;if(e.isNonWhitespace)break}}return!1}get outputStreamContainsContent(){for(let t=0;t<this._outputStream.length;t++)if(this._outputStream[t]instanceof x)return!0;return!1}get inStringEvaluation(){for(let t=this._outputStream.length-1;t>=0;t--){let e=o(this._outputStream[t],O);if(e instanceof O&&e.commandType==O.CommandType.BeginString)return!0}return!1}PushEvaluationStack(t){let e=o(t,T);if(e){let t=e.value;if(null===t)return f("rawList");if(null!=t.originNames){t.origins||(t.origins=[]),t.origins.length=0;for(let e of t.originNames){if(null===this.story.listDefinitions)return f("StoryState.story.listDefinitions");let n=this.story.listDefinitions.TryListGetDefinition(e,null);if(null===n.result)return f("StoryState def.result");t.origins.indexOf(n.result)<0&&t.origins.push(n.result)}}}if(null===t)return f("obj");this.evaluationStack.push(t)}PopEvaluationStack(t){if(void 0===t)return l(this.evaluationStack.pop());if(t>this.evaluationStack.length)throw new Error("trying to pop too many objects");return l(this.evaluationStack.splice(this.evaluationStack.length-t,t))}PeekEvaluationStack(){return this.evaluationStack[this.evaluationStack.length-1]}ForceEnd(){this.callStack.Reset(),this._currentChoices.length=0,this.currentPointer=I.Null,this.previousPointer=I.Null,this.didSafeExit=!0}TrimWhitespaceFromFunctionEnd(){n.Assert(this.callStack.currentElement.type==r.Function);let t=this.callStack.currentElement.functionStartInOutputStream;-1==t&&(t=0);for(let e=this._outputStream.length-1;e>=t;e--){let t=this._outputStream[e],n=o(t,x),i=o(t,O);if(null!=n){if(i)break;if(!n.isNewline&&!n.isInlineWhitespace)break;this._outputStream.splice(e,1),this.OutputStreamDirty()}}}PopCallStack(t=null){this.callStack.currentElement.type==r.Function&&this.TrimWhitespaceFromFunctionEnd(),this.callStack.Pop(t)}SetChosenPath(t,e){this._currentChoices.length=0;let n=this.story.PointerAtPath(t);n.isNull||-1!=n.index||(n.index=0),this.currentPointer=n,e&&this.currentTurnIndex++}StartFunctionEvaluationFromGame(t,e){this.callStack.Push(r.FunctionEvaluationFromGame,this.evaluationStack.length),this.callStack.currentElement.currentPointer=I.StartOf(t),this.PassArgumentsToEvaluationStack(e)}PassArgumentsToEvaluationStack(t){if(null!=t)for(let e=0;e<t.length;e++){if("number"!=typeof t[e]&&"string"!=typeof t[e])throw new Error("ink arguments when calling EvaluateFunction / ChoosePathStringWithParameters  must be int, float or string");this.PushEvaluationStack(_.Create(t[e]))}}TryExitFunctionEvaluationFromGame(){return this.callStack.currentElement.type==r.FunctionEvaluationFromGame&&(this.currentPointer=I.Null,this.didSafeExit=!0,!0)}CompleteFunctionEvaluationFromGame(){if(this.callStack.currentElement.type!=r.FunctionEvaluationFromGame)throw new v("Expected external function evaluation to be complete. Stack trace: "+this.callStack.callStackTrace);let t=this.callStack.currentElement.evaluationStackHeightWhenPushed,e=null;for(;this.evaluationStack.length>t;){let t=this.PopEvaluationStack();null===e&&(e=t)}if(this.PopCallStack(r.FunctionEvaluationFromGame),e){if(e instanceof R)return null;let t=s(e,_);return t.valueType==i.DivertTarget?t.valueObject.toString():t.valueObject}return null}AddError(t,e){e?(null==this._currentWarnings&&(this._currentWarnings=[]),this._currentWarnings.push(t)):(null==this._currentErrors&&(this._currentErrors=[]),this._currentErrors.push(t))}OutputStreamDirty(){this._outputStreamTextDirty=!0,this._outputStreamTagsDirty=!0}}class K{constructor(){this.startTime=void 0}get ElapsedMilliseconds(){return void 0===this.startTime?0:(new Date).getTime()-this.startTime}Start(){this.startTime=(new Date).getTime()}Stop(){this.startTime=void 0}}Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});class J extends d{constructor(){let t;super(),this.inkVersionMinimumCompatible=18,this._prevContainers=[],this.allowExternalFunctionFallbacks=!1,this._listDefinitions=null,this._variableObservers=null,this._hasValidatedExternals=!1,this._temporaryEvaluationContainer=null,this._asyncContinueActive=!1,this._stateSnapshotAtLastNewline=null,this._recursiveContinueCount=0,this._asyncSaving=!1,this._profiler=null;let e=null,n=null;if(arguments[0]instanceof E)t=arguments[0],void 0!==arguments[1]&&(e=arguments[1]),this._mainContentContainer=t;else if("string"==typeof arguments[0]){let t=arguments[0];n=Y.TextToDictionary(t)}else n=arguments[0];if(null!=e&&(this._listDefinitions=new D(e)),this._externals=new Map,null!==n){let t=n,e=t.inkVersion;if(null==e)throw new Error("ink version number not found. Are you sure it's a valid .ink.json file?");let i=parseInt(e);if(i>J.inkVersionCurrent)throw new Error("Version of ink used to build story was newer than the current version of the engine");if(i<this.inkVersionMinimumCompatible)throw new Error("Version of ink used to build story is too old to be loaded by this version of the engine");i!=J.inkVersionCurrent&&console.warn("WARNING: Version of ink used to build story doesn't match current version of engine. Non-critical, but recommend synchronising.");let r,o=t.root;if(null==o)throw new Error("Root node for ink not found. Are you sure it's a valid .ink.json file?");(r=t.listDefs)&&(this._listDefinitions=U.JTokenToListDefinitions(r)),this._mainContentContainer=s(U.JTokenToRuntimeObject(o),E),this.ResetState()}}get currentChoices(){let t=[];if(null===this._state)return f("this._state");for(let e of this._state.currentChoices)e.isInvisibleDefault||(e.index=t.length,t.push(e));return t}get currentText(){return this.IfAsyncWeCant("call currentText since it's a work in progress"),this.state.currentText}get currentTags(){return this.IfAsyncWeCant("call currentTags since it's a work in progress"),this.state.currentTags}get currentErrors(){return this.state.currentErrors}get currentWarnings(){return this.state.currentWarnings}get hasError(){return this.state.hasError}get hasWarning(){return this.state.hasWarning}get variablesState(){return this.state.variablesState}get listDefinitions(){return this._listDefinitions}get state(){return this._state}StartProfiling(){}EndProfiling(){}ToJson(t){let e=!1;if(t||(e=!0,t=new Y.Writer),t.WriteObjectStart(),t.WriteIntProperty("inkVersion",J.inkVersionCurrent),t.WriteProperty("root",t=>U.WriteRuntimeContainer(t,this._mainContentContainer)),null!=this._listDefinitions){t.WritePropertyStart("listDefs"),t.WriteObjectStart();for(let e of this._listDefinitions.lists){t.WritePropertyStart(e.name),t.WriteObjectStart();for(let[n,i]of e.items){let e=g.fromSerializedKey(n),r=i;t.WriteIntProperty(e.itemName,r)}t.WriteObjectEnd(),t.WritePropertyEnd()}t.WriteObjectEnd(),t.WritePropertyEnd()}if(t.WriteObjectEnd(),e)return t.ToString()}ResetState(){this.IfAsyncWeCant("ResetState"),this._state=new X(this),this._state.variablesState.ObserveVariableChange(this.VariableStateDidChangeEvent.bind(this)),this.ResetGlobals()}ResetErrors(){if(null===this._state)return f("this._state");this._state.ResetErrors()}ResetCallstack(){if(this.IfAsyncWeCant("ResetCallstack"),null===this._state)return f("this._state");this._state.ForceEnd()}ResetGlobals(){if(this._mainContentContainer.namedContent.get("global decl")){let t=this.state.currentPointer.copy();this.ChoosePath(new e("global decl"),!1),this.ContinueInternal(),this.state.currentPointer=t}this.state.variablesState.SnapshotDefaultGlobals()}Continue(){return this.ContinueAsync(0),this.currentText}get canContinue(){return this.state.canContinue}get asyncContinueComplete(){return!this._asyncContinueActive}ContinueAsync(t){this._hasValidatedExternals||this.ValidateExternalBindings(),this.ContinueInternal(t)}ContinueInternal(t=0){null!=this._profiler&&this._profiler.PreContinue();let e=t>0;if(this._recursiveContinueCount++,!this._asyncContinueActive){if(this._asyncContinueActive=e,!this.canContinue)throw new v("Can't continue - should check canContinue before calling Continue");this._state.didSafeExit=!1,this._state.ResetOutput(),1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!0)}let n=new K;n.Start();let i=!1;do{try{i=this.ContinueSingleStep()}catch(t){if(!(t instanceof v))throw t;this.AddError(t.message,void 0,t.useEndLineNumber);break}if(i)break;if(this._asyncContinueActive&&n.ElapsedMilliseconds>t)break}while(this.canContinue);n.Stop(),!i&&this.canContinue||(null!==this._stateSnapshotAtLastNewline&&this.RestoreStateSnapshot(),this.canContinue||(this.state.callStack.canPopThread&&this.AddError("Thread available to pop, threads should always be flat by the end of evaluation?"),0!=this.state.generatedChoices.length||this.state.didSafeExit||null!=this._temporaryEvaluationContainer||(this.state.callStack.CanPop(r.Tunnel)?this.AddError("unexpectedly reached end of content. Do you need a '->->' to return from a tunnel?"):this.state.callStack.CanPop(r.Function)?this.AddError("unexpectedly reached end of content. Do you need a '~ return'?"):this.state.callStack.canPop?this.AddError("unexpectedly reached end of content for unknown reason. Please debug compiler!"):this.AddError("ran out of content. Do you need a '-> DONE' or '-> END'?"))),this.state.didSafeExit=!1,1==this._recursiveContinueCount&&(this._state.variablesState.batchObservingVariableChanges=!1),this._asyncContinueActive=!1),this._recursiveContinueCount--,null!=this._profiler&&this._profiler.PostContinue()}ContinueSingleStep(){if(null!=this._profiler&&this._profiler.PreStep(),this.Step(),null!=this._profiler&&this._profiler.PostStep(),this.canContinue||this.state.callStack.elementIsEvaluateFromGame||this.TryFollowDefaultInvisibleChoice(),null!=this._profiler&&this._profiler.PreSnapshot(),!this.state.inStringEvaluation){if(null!==this._stateSnapshotAtLastNewline){if(null===this._stateSnapshotAtLastNewline.currentTags)return f("this._stateAtLastNewline.currentTags");if(null===this.state.currentTags)return f("this.state.currentTags");let t=this.CalculateNewlineOutputStateChange(this._stateSnapshotAtLastNewline.currentText,this.state.currentText,this._stateSnapshotAtLastNewline.currentTags.length,this.state.currentTags.length);if(t==J.OutputStateChange.ExtendedBeyondNewline)return this.RestoreStateSnapshot(),!0;t==J.OutputStateChange.NewlineRemoved&&this.DiscardSnapshot()}this.state.outputStreamEndsInNewline&&(this.canContinue?null==this._stateSnapshotAtLastNewline&&this.StateSnapshot():this.DiscardSnapshot())}return null!=this._profiler&&this._profiler.PostSnapshot(),!1}CalculateNewlineOutputStateChange(t,e,n,i){if(null===t)return f("prevText");if(null===e)return f("currText");let r=e.length>=t.length&&"\n"==e.charAt(t.length-1);if(n==i&&t.length==e.length&&r)return J.OutputStateChange.NoChange;if(!r)return J.OutputStateChange.NewlineRemoved;if(i>n)return J.OutputStateChange.ExtendedBeyondNewline;for(let n=t.length;n<e.length;n++){let t=e.charAt(n);if(" "!=t&&"\t"!=t)return J.OutputStateChange.ExtendedBeyondNewline}return J.OutputStateChange.NoChange}ContinueMaximally(){this.IfAsyncWeCant("ContinueMaximally");let t=new p;for(;this.canContinue;)t.Append(this.Continue());return t.toString()}ContentAtPath(t){return this.mainContentContainer.ContentAtPath(t)}KnotContainerWithName(t){let e=this.mainContentContainer.namedContent.get(t);return e instanceof E?e:null}PointerAtPath(t){if(0==t.length)return I.Null;let e=new I,n=t.length,i=null;return null===t.lastComponent?f("path.lastComponent"):(t.lastComponent.isIndex?(n=t.length-1,i=this.mainContentContainer.ContentAtPath(t,void 0,n),e.container=i.container,e.index=t.lastComponent.index):(i=this.mainContentContainer.ContentAtPath(t),e.container=i.container,e.index=-1),null==i.obj||i.obj==this.mainContentContainer&&n>0?this.Error("Failed to find content at path '"+t+"', and no approximation of it was possible."):i.approximate&&this.Warning("Failed to find content at path '"+t+"', so it was approximated to: '"+i.obj.path+"'."),e)}StateSnapshot(){this._stateSnapshotAtLastNewline=this._state,this._state=this._state.CopyAndStartPatching()}RestoreStateSnapshot(){null===this._stateSnapshotAtLastNewline&&f("_stateSnapshotAtLastNewline"),this._stateSnapshotAtLastNewline.RestoreAfterPatch(),this._state=this._stateSnapshotAtLastNewline,this._stateSnapshotAtLastNewline=null,this._asyncSaving||this._state.ApplyAnyPatch()}DiscardSnapshot(){this._asyncSaving||this._state.ApplyAnyPatch(),this._stateSnapshotAtLastNewline=null}CopyStateForBackgroundThreadSave(){if(this.IfAsyncWeCant("start saving on a background thread"),this._asyncSaving)throw new Error("Story is already in background saving mode, can't call CopyStateForBackgroundThreadSave again!");let t=this._state;return this._state=this._state.CopyAndStartPatching(),this._asyncSaving=!0,t}BackgroundSaveComplete(){null===this._stateSnapshotAtLastNewline&&this._state.ApplyAnyPatch(),this._asyncSaving=!1}Step(){let t=!0,e=this.state.currentPointer.copy();if(e.isNull)return;let n=o(e.Resolve(),E);for(;n&&(this.VisitContainer(n,!0),0!=n.content.length);)e=I.StartOf(n),n=o(e.Resolve(),E);this.state.currentPointer=e.copy(),null!=this._profiler&&this._profiler.Step(this.state.callStack);let i=e.Resolve(),r=this.PerformLogicAndFlowControl(i);if(this.state.currentPointer.isNull)return;r&&(t=!1);let s=o(i,F);if(s){let e=this.ProcessChoice(s);e&&this.state.generatedChoices.push(e),i=null,t=!1}if(i instanceof E&&(t=!1),t){let t=o(i,N);if(t&&-1==t.contextIndex){let e=this.state.callStack.ContextForVariableNamed(t.variableName);i=new N(t.variableName,e)}this.state.inExpressionEvaluation?this.state.PushEvaluationStack(i):this.state.PushToOutputStream(i)}this.NextContent();let a=o(i,O);a&&a.commandType==O.CommandType.StartThread&&this.state.callStack.PushThread()}VisitContainer(t,e){t.countingAtStartOnly&&!e||(t.visitsShouldBeCounted&&this.state.IncrementVisitCountForContainer(t),t.turnIndexShouldBeCounted&&this.state.RecordTurnIndexVisitToContainer(t))}VisitChangedContainersDueToDivert(){let t=this.state.previousPointer.copy(),e=this.state.currentPointer.copy();if(e.isNull||-1==e.index)return;if(this._prevContainers.length=0,!t.isNull){let e=o(t.Resolve(),E)||o(t.container,E);for(;e;)this._prevContainers.push(e),e=o(e.parent,E)}let n=e.Resolve();if(null==n)return;let i=o(n.parent,E);for(;i&&(this._prevContainers.indexOf(i)<0||i.countingAtStartOnly);){let t=i.content.length>0&&n==i.content[0];this.VisitContainer(i,t),n=i,i=o(i.parent,E)}}ProcessChoice(t){let e=!0;if(t.hasCondition){let t=this.state.PopEvaluationStack();this.IsTruthy(t)||(e=!1)}let n="",i="";if(t.hasChoiceOnlyContent&&(i=s(this.state.PopEvaluationStack(),x).value||""),t.hasStartContent&&(n=s(this.state.PopEvaluationStack(),x).value||""),t.onceOnly&&this.state.VisitCountForContainer(t.choiceTarget)>0&&(e=!1),!e)return null;let r=new G;return r.targetPath=t.pathOnChoice,r.sourcePath=t.path.toString(),r.isInvisibleDefault=t.isInvisibleDefault,r.threadAtGeneration=this.state.callStack.ForkThread(),r.text=(n+i).replace(/^[ \t]+|[ \t]+$/g,""),r}IsTruthy(t){if(t instanceof _){let e=t;if(e instanceof C){let t=e;return this.Error("Shouldn't use a divert target (to "+t.targetPath+") as a conditional value. Did you intend a function call 'likeThis()' or a read count check 'likeThis'? (no arrows)"),!1}return e.isTruthy}return!1}PerformLogicAndFlowControl(t){if(null==t)return!1;if(t instanceof A){let e=t;if(e.isConditional){let t=this.state.PopEvaluationStack();if(!this.IsTruthy(t))return!0}if(e.hasVariableTarget){let t=e.variableDivertName,n=this.state.variablesState.GetVariableWithName(t);if(null==n)this.Error("Tried to divert using a target from a variable that could not be found ("+t+")");else if(!(n instanceof C)){let e=o(n,S),i="Tried to divert to a target from a variable, but the variable ("+t+") didn't contain a divert target, it ";e instanceof S&&0==e.value?i+="was empty/null (the value 0).":i+="contained '"+n+"'.",this.Error(i)}let i=s(n,C);this.state.divertedPointer=this.PointerAtPath(i.targetPath)}else{if(e.isExternal)return this.CallExternalFunction(e.targetPathString,e.externalArgs),!0;this.state.divertedPointer=e.targetPointer.copy()}return e.pushesToStack&&this.state.callStack.Push(e.stackPushType,void 0,this.state.outputStream.length),this.state.divertedPointer.isNull&&!e.isExternal&&(e&&e.debugMetadata&&null!=e.debugMetadata.sourceName?this.Error("Divert target doesn't exist: "+e.debugMetadata.sourceName):this.Error("Divert resolution failed: "+e)),!0}if(t instanceof O){let e=t;switch(e.commandType){case O.CommandType.EvalStart:this.Assert(!1===this.state.inExpressionEvaluation,"Already in expression evaluation?"),this.state.inExpressionEvaluation=!0;break;case O.CommandType.EvalEnd:this.Assert(!0===this.state.inExpressionEvaluation,"Not in expression evaluation mode"),this.state.inExpressionEvaluation=!1;break;case O.CommandType.EvalOutput:if(this.state.evaluationStack.length>0){let t=this.state.PopEvaluationStack();if(!(t instanceof R)){let e=new x(t.toString());this.state.PushToOutputStream(e)}}break;case O.CommandType.NoOp:break;case O.CommandType.Duplicate:this.state.PushEvaluationStack(this.state.PeekEvaluationStack());break;case O.CommandType.PopEvaluatedValue:this.state.PopEvaluationStack();break;case O.CommandType.PopFunction:case O.CommandType.PopTunnel:let t=e.commandType==O.CommandType.PopFunction?r.Function:r.Tunnel,n=null;if(t==r.Tunnel){let t=this.state.PopEvaluationStack();n=o(t,C),null===n&&this.Assert(t instanceof R,"Expected void if ->-> doesn't override target")}if(this.state.TryExitFunctionEvaluationFromGame())break;if(this.state.callStack.currentElement.type==t&&this.state.callStack.canPop)this.state.PopCallStack(),n&&(this.state.divertedPointer=this.PointerAtPath(n.targetPath));else{let e=new Map;e.set(r.Function,"function return statement (~ return)"),e.set(r.Tunnel,"tunnel onwards statement (->->)");let n=e.get(this.state.callStack.currentElement.type);this.state.callStack.canPop||(n="end of flow (-> END or choice)");let i="Found "+e.get(t)+", when expected "+n;this.Error(i)}break;case O.CommandType.BeginString:this.state.PushToOutputStream(e),this.Assert(!0===this.state.inExpressionEvaluation,"Expected to be in an expression when evaluating a string"),this.state.inExpressionEvaluation=!1;break;case O.CommandType.EndString:let i=[],a=0;for(let t=this.state.outputStream.length-1;t>=0;--t){let e=this.state.outputStream[t];a++;let n=o(e,O);if(n&&n.commandType==O.CommandType.BeginString)break;e instanceof x&&i.push(e)}this.state.PopFromOutputStream(a),i=i.reverse();let l=new p;for(let t of i)l.Append(t.toString());this.state.inExpressionEvaluation=!0,this.state.PushEvaluationStack(new x(l.toString()));break;case O.CommandType.ChoiceCount:let u=this.state.generatedChoices.length;this.state.PushEvaluationStack(new S(u));break;case O.CommandType.Turns:this.state.PushEvaluationStack(new S(this.state.currentTurnIndex+1));break;case O.CommandType.TurnsSince:case O.CommandType.ReadCount:let h=this.state.PopEvaluationStack();if(!(h instanceof C)){let t="";h instanceof S&&(t=". Did you accidentally pass a read count ('knot_name') instead of a target ('-> knot_name')?"),this.Error("TURNS_SINCE / READ_COUNT expected a divert target (knot, stitch, label name), but saw "+h+t);break}let c,d=s(h,C),y=o(this.ContentAtPath(d.targetPath).correctObj,E);null!=y?c=e.commandType==O.CommandType.TurnsSince?this.state.TurnsSinceForContainer(y):this.state.VisitCountForContainer(y):(c=e.commandType==O.CommandType.TurnsSince?-1:0,this.Warning("Failed to find container for "+e.toString()+" lookup at "+d.targetPath.toString())),this.state.PushEvaluationStack(new S(c));break;case O.CommandType.Random:{let t=o(this.state.PopEvaluationStack(),S),e=o(this.state.PopEvaluationStack(),S);if(null==e||e instanceof S==0)return this.Error("Invalid value for minimum parameter of RANDOM(min, max)");if(null==t||e instanceof S==0)return this.Error("Invalid value for maximum parameter of RANDOM(min, max)");if(null===t.value)return f("maxInt.value");if(null===e.value)return f("minInt.value");let n=t.value-e.value+1;n<=0&&this.Error("RANDOM was called with minimum as "+e.value+" and maximum as "+t.value+". The maximum must be larger");let i=this.state.storySeed+this.state.previousRandom,r=new q(i).next(),s=r%n+e.value;this.state.PushEvaluationStack(new S(s)),this.state.previousRandom=r;break}case O.CommandType.SeedRandom:let b=o(this.state.PopEvaluationStack(),S);if(null==b||b instanceof S==0)return this.Error("Invalid value passed to SEED_RANDOM");if(null===b.value)return f("minInt.value");this.state.storySeed=b.value,this.state.previousRandom=0,this.state.PushEvaluationStack(new R);break;case O.CommandType.VisitIndex:let w=this.state.VisitCountForContainer(this.state.currentPointer.container)-1;this.state.PushEvaluationStack(new S(w));break;case O.CommandType.SequenceShuffleIndex:let N=this.NextSequenceShuffleIndex();this.state.PushEvaluationStack(new S(N));break;case O.CommandType.StartThread:break;case O.CommandType.Done:this.state.callStack.canPopThread?this.state.callStack.PopThread():(this.state.didSafeExit=!0,this.state.currentPointer=I.Null);break;case O.CommandType.End:this.state.ForceEnd();break;case O.CommandType.ListFromInt:let k=o(this.state.PopEvaluationStack(),S),P=s(this.state.PopEvaluationStack(),x);if(null===k)throw new v("Passed non-integer when creating a list element from a numerical value.");let A=null;if(null===this.listDefinitions)return f("this.listDefinitions");let F=this.listDefinitions.TryListGetDefinition(P.value,null);if(!F.exists)throw new v("Failed to find LIST called "+P.value);{if(null===k.value)return f("minInt.value");let t=F.result.TryGetItemWithValue(k.value,g.Null);t.exists&&(A=new T(t.result,k.value))}null==A&&(A=new T),this.state.PushEvaluationStack(A);break;case O.CommandType.ListRange:let W=o(this.state.PopEvaluationStack(),_),M=o(this.state.PopEvaluationStack(),_),L=o(this.state.PopEvaluationStack(),T);if(null===L||null===M||null===W)throw new v("Expected list, minimum and maximum for LIST_RANGE");if(null===L.value)return f("targetList.value");let j=L.value.ListWithSubRange(M.valueObject,W.valueObject);this.state.PushEvaluationStack(new T(j));break;case O.CommandType.ListRandom:{let t=this.state.PopEvaluationStack();if(null===t)throw new v("Expected list for LIST_RANDOM");let e=t.value,n=null;if(null===e)throw f("list");if(0==e.Count)n=new m;else{let t=this.state.storySeed+this.state.previousRandom,i=new q(t).next(),r=i%e.Count,o=e.entries();for(let t=0;t<=r-1;t++)o.next();let s=o.next().value,a={Key:g.fromSerializedKey(s[0]),Value:s[1]};if(null===a.Key.originName)return f("randomItem.Key.originName");n=new m(a.Key.originName,this),n.Add(a.Key,a.Value),this.state.previousRandom=i}this.state.PushEvaluationStack(new T(n));break}default:this.Error("unhandled ControlCommand: "+e)}return!0}if(t instanceof M){let e=t,n=this.state.PopEvaluationStack();return this.state.variablesState.Assign(e,n),!0}if(t instanceof W){let e=t,n=null;if(null!=e.pathForCount){let t=e.containerForCount,i=this.state.VisitCountForContainer(t);n=new S(i)}else n=this.state.variablesState.GetVariableWithName(e.name),null==n&&(this.Warning("Variable not found: '"+e.name+"'. Using default value of 0 (false). This can happen with temporary variables if the declaration hasn't yet been hit. Globals are always given a default value on load if a value doesn't exist in the save state."),n=new S(0));return this.state.PushEvaluationStack(n),!0}if(t instanceof L){let e=t,n=this.state.PopEvaluationStack(e.numberOfParameters),i=e.Call(n);return this.state.PushEvaluationStack(i),!0}return!1}ChoosePathString(t,n=!0,i=[]){if(this.IfAsyncWeCant("call ChoosePathString right now"),n)this.ResetCallstack();else if(this.state.callStack.currentElement.type==r.Function){let e="",n=this.state.callStack.currentElement.currentPointer.container;throw null!=n&&(e="("+n.path.toString()+") "),new Error("Story was running a function "+e+"when you called ChoosePathString("+t+") - this is almost certainly not not what you want! Full stack trace: \n"+this.state.callStack.callStackTrace)}this.state.PassArgumentsToEvaluationStack(i),this.ChoosePath(new e(t))}IfAsyncWeCant(t){if(this._asyncContinueActive)throw new Error("Can't "+t+". Story is in the middle of a ContinueAsync(). Make more ContinueAsync() calls or a single Continue() call beforehand.")}ChoosePath(t,e=!0){this.state.SetChosenPath(t,e),this.VisitChangedContainersDueToDivert()}ChooseChoiceIndex(t){t=t;let e=this.currentChoices;this.Assert(t>=0&&t<e.length,"choice out of range");let n=e[t];return null===n.threadAtGeneration?f("choiceToChoose.threadAtGeneration"):null===n.targetPath?f("choiceToChoose.targetPath"):(this.state.callStack.currentThread=n.threadAtGeneration,void this.ChoosePath(n.targetPath))}HasFunction(t){try{return null!=this.KnotContainerWithName(t)}catch(t){return!1}}EvaluateFunction(t,e=[],n=!1){if(this.IfAsyncWeCant("evaluate a function"),null==t)throw new Error("Function is null");if(""==t||""==t.trim())throw new Error("Function is empty or white space.");let i=this.KnotContainerWithName(t);if(null==i)throw new Error("Function doesn't exist: '"+t+"'");let r=[];r.push.apply(r,this.state.outputStream),this._state.ResetOutput(),this.state.StartFunctionEvaluationFromGame(i,e);let o=new p;for(;this.canContinue;)o.Append(this.Continue());let s=o.toString();this._state.ResetOutput(r);let a=this.state.CompleteFunctionEvaluationFromGame();return n?{returned:a,output:s}:a}EvaluateExpression(t){let e=this.state.callStack.elements.length;this.state.callStack.Push(r.Tunnel),this._temporaryEvaluationContainer=t,this.state.GoToStart();let n=this.state.evaluationStack.length;return this.Continue(),this._temporaryEvaluationContainer=null,this.state.callStack.elements.length>e&&this.state.PopCallStack(),this.state.evaluationStack.length>n?this.state.PopEvaluationStack():null}CallExternalFunction(t,e){if(null===t)return f("funcName");let n=this._externals.get(t),i=null;if(void 0===n){if(this.allowExternalFunctionFallbacks)return i=this.KnotContainerWithName(t),this.Assert(null!==i,"Trying to call EXTERNAL function '"+t+"' which has not been bound, and fallback ink function could not be found."),this.state.callStack.Push(r.Function,void 0,this.state.outputStream.length),void(this.state.divertedPointer=I.StartOf(i));this.Assert(!1,"Trying to call EXTERNAL function '"+t+"' which has not been bound (and ink fallbacks disabled).")}let o=[];for(let t=0;t<e;++t){let t=s(this.state.PopEvaluationStack(),_).valueObject;o.push(t)}o.reverse();let a=n(o),l=null;null!=a?(l=_.Create(a),this.Assert(null!==l,"Could not create ink value from returned object of type "+typeof a)):l=new R,this.state.PushEvaluationStack(l)}BindExternalFunctionGeneral(t,e){this.IfAsyncWeCant("bind an external function"),this.Assert(!this._externals.has(t),"Function '"+t+"' has already been bound."),this._externals.set(t,e)}TryCoerce(t){return t}BindExternalFunction(t,e){this.Assert(null!=e,"Can't bind a null function"),this.BindExternalFunctionGeneral(t,t=>{this.Assert(t.length>=e.length,"External function expected "+e.length+" arguments");let n=[];for(let e=0,i=t.length;e<i;e++)n[e]=this.TryCoerce(t[e]);return e.apply(null,n)})}UnbindExternalFunction(t){this.IfAsyncWeCant("unbind an external a function"),this.Assert(this._externals.has(t),"Function '"+t+"' has not been bound."),this._externals.delete(t)}ValidateExternalBindings(){let t=null,e=null,n=arguments[1]||new Set;if(arguments[0]instanceof E&&(t=arguments[0]),arguments[0]instanceof d&&(e=arguments[0]),null===t&&null===e)if(this.ValidateExternalBindings(this._mainContentContainer,n),this._hasValidatedExternals=!0,0==n.size)this._hasValidatedExternals=!0;else{let t="Error: Missing function binding for external";t+=n.size>1?"s":"",t+=": '",t+=Array.from(n).join("', '"),t+="' ",t+=this.allowExternalFunctionFallbacks?", and no fallback ink function found.":" (ink fallbacks disabled)",this.Error(t)}else if(null!=t){for(let e of t.content){let t=e;null!=t&&t.hasValidName||this.ValidateExternalBindings(e,n)}for(let[,e]of t.namedContent)this.ValidateExternalBindings(o(e,d),n)}else if(null!=e){let t=o(e,A);if(t&&t.isExternal){let e=t.targetPathString;if(null===e)return f("name");this._externals.has(e)||this.allowExternalFunctionFallbacks&&this.mainContentContainer.namedContent.has(e)||n.add(e)}}}ObserveVariable(t,e){if(this.IfAsyncWeCant("observe a new variable"),null===this._variableObservers&&(this._variableObservers=new Map),!this.state.variablesState.GlobalVariableExistsWithName(t))throw new v("Cannot observe variable '"+t+"' because it wasn't declared in the ink story.");this._variableObservers.has(t)?this._variableObservers.get(t).push(e):this._variableObservers.set(t,[e])}ObserveVariables(t,e){for(let n=0,i=t.length;n<i;n++)this.ObserveVariable(t[n],e[n])}RemoveVariableObserver(t,e){if(this.IfAsyncWeCant("remove a variable observer"),null!==this._variableObservers)if(void 0!==e){if(this._variableObservers.has(e)){let n=this._variableObservers.get(e);null!==t?n.splice(n.indexOf(t),1):this._variableObservers.delete(e)}}else if(null!==t){let e=this._variableObservers.keys();for(let n of e){let e=this._variableObservers.get(n);e.splice(e.indexOf(t),1)}}}VariableStateDidChangeEvent(t,e){if(null===this._variableObservers)return;let n=this._variableObservers.get(t);if(void 0!==n){if(!(e instanceof _))throw new Error("Tried to get the value of a variable that isn't a standard type");let i=s(e,_);for(let e of n)e(t,i.valueObject)}}get globalTags(){return this.TagsAtStartOfFlowContainerWithPathString("")}TagsForContentAtPath(t){return this.TagsAtStartOfFlowContainerWithPathString(t)}TagsAtStartOfFlowContainerWithPathString(t){let n=new e(t),i=this.ContentAtPath(n).container;if(null===i)return f("flowContainer");for(;;){let t=i.content[0];if(!(t instanceof E))break;i=t}let r=null;for(let t of i.content){let e=o(t,j);if(!e)break;null==r&&(r=[]),r.push(e.text)}return r}BuildStringOfHierarchy(){let t=new p;return this.mainContentContainer.BuildStringOfHierarchy(t,0,this.state.currentPointer.Resolve()),t.toString()}BuildStringOfContainer(t){let e=new p;return t.BuildStringOfHierarchy(e,0,this.state.currentPointer.Resolve()),e.toString()}NextContent(){if(this.state.previousPointer=this.state.currentPointer.copy(),(this.state.divertedPointer.isNull||(this.state.currentPointer=this.state.divertedPointer.copy(),this.state.divertedPointer=I.Null,this.VisitChangedContainersDueToDivert(),this.state.currentPointer.isNull))&&!this.IncrementContentPointer()){let t=!1;this.state.callStack.CanPop(r.Function)?(this.state.PopCallStack(r.Function),this.state.inExpressionEvaluation&&this.state.PushEvaluationStack(new R),t=!0):this.state.callStack.canPopThread?(this.state.callStack.PopThread(),t=!0):this.state.TryExitFunctionEvaluationFromGame(),t&&!this.state.currentPointer.isNull&&this.NextContent()}}IncrementContentPointer(){let t=!0,e=this.state.callStack.currentElement.currentPointer.copy();if(e.index++,null===e.container)return f("pointer.container");for(;e.index>=e.container.content.length;){t=!1;let n=o(e.container.parent,E);if(n instanceof E==0)break;let i=n.content.indexOf(e.container);if(-1==i)break;if(e=new I(n,i),e.index++,t=!0,null===e.container)return f("pointer.container")}return t||(e=I.Null),this.state.callStack.currentElement.currentPointer=e.copy(),t}TryFollowDefaultInvisibleChoice(){let t=this._state.currentChoices,e=t.filter(t=>t.isInvisibleDefault);if(0==e.length||t.length>e.length)return!1;let n=e[0];return null===n.targetPath?f("choice.targetPath"):null===n.threadAtGeneration?f("choice.threadAtGeneration"):(this.state.callStack.currentThread=n.threadAtGeneration,this.ChoosePath(n.targetPath,!1),!0)}NextSequenceShuffleIndex(){let t=o(this.state.PopEvaluationStack(),S);if(!(t instanceof S))return this.Error("expected number of elements in sequence for shuffle index"),0;let e=this.state.currentPointer.container;if(null===e)return f("seqContainer");if(null===t.value)return f("numElementsIntVal.value");let n=t.value,i=s(this.state.PopEvaluationStack(),S).value;if(null===i)return f("seqCount");let r=i/n,a=i%n,l=e.path.toString(),u=0;for(let t=0,e=l.length;t<e;t++)u+=l.charCodeAt(t)||0;let h=u+r+this.state.storySeed,c=new q(Math.floor(h)),d=[];for(let t=0;t<n;++t)d.push(t);for(let t=0;t<=a;++t){let e=c.next()%d.length,n=d[e];if(d.splice(e,1),t==a)return n}throw new Error("Should never reach here")}Error(t,e=!1){let n=new v(t);throw n.useEndLineNumber=e,n}Warning(t){this.AddError(t,!0)}AddError(t,e=!1,n=!1){let i=this.currentDebugMetadata,r=e?"WARNING":"ERROR";if(null!=i){let e=n?i.endLineNumber:i.startLineNumber;t="RUNTIME "+r+": '"+i.fileName+"' line "+e+": "+t}else t=this.state.currentPointer.isNull?"RUNTIME "+r+": "+t:"RUNTIME "+r+": ("+this.state.currentPointer+"): "+t;this.state.AddError(t,e),e||this.state.ForceEnd()}Assert(t,e=null){if(0==t)throw null==e&&(e="Story assert"),new Error(e+" "+this.currentDebugMetadata)}get currentDebugMetadata(){let t,e=this.state.currentPointer;if(!e.isNull&&null!==e.Resolve()&&(t=e.Resolve().debugMetadata,null!==t))return t;for(let n=this.state.callStack.elements.length-1;n>=0;--n)if(e=this.state.callStack.elements[n].currentPointer,!e.isNull&&null!==e.Resolve()&&(t=e.Resolve().debugMetadata,null!==t))return t;for(let e=this.state.outputStream.length-1;e>=0;--e)if(t=this.state.outputStream[e].debugMetadata,null!==t)return t;return null}get mainContentContainer(){return this._temporaryEvaluationContainer?this._temporaryEvaluationContainer:this._mainContentContainer}}J.inkVersionCurrent=19,function(t){let e;!function(t){t[t.NoChange=0]="NoChange",t[t.ExtendedBeyondNewline=1]="ExtendedBeyondNewline",t[t.NewlineRemoved=2]="NewlineRemoved"}(e=t.OutputStateChange||(t.OutputStateChange={}))}(J||(J={})),t.InkList=m,t.Story=J,Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return s}));var i=n(47),r=n(28);function o(t){let e=r.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class s extends i.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],n=this.computeSize();this._offset=n.map((t,n)=>Math.floor((t-e[n])/2))}clear(){t.stdout.write(`[0;48;5;${o(this._options.bg)}m[2J`)}draw(e,n){let[i,r,s,a,l]=e,u=this._offset[0]+i,h=this._offset[1]+r,c=this.computeSize();if(u<0||u>=c[0])return;if(h<0||h>=c[1])return;if(u===this._cursor[0]&&h===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(u,h)),this._cursor[0]=u,this._cursor[1]=h),n&&(s||(s=" ")),!s)return;let f=function(t,e){return`[0;38;5;${o(t)};48;5;${o(e)}m`}(a,l);if(f!==this._lastColor&&(t.stdout.write(f),this._lastColor=f),"\t"!=s){let e=[].concat(s);t.stdout.write(e[0])}this._cursor[0]++,this._cursor[0]>=c[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,n(314))},function(t,e,n){t.exports=!n(9)&&!n(3)((function(){return 7!=Object.defineProperty(n(64)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){var i=n(2),r=n(8),o=n(33),s=n(65),a=n(10).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=o?{}:i.Symbol||{});"_"==t.charAt(0)||t in e||a(e,t,{value:s.f(t)})}},function(t,e,n){var i=n(14),r=n(16),o=n(53)(!1),s=n(66)("IE_PROTO");t.exports=function(t,e){var n,a=r(t),l=0,u=[];for(n in a)n!=s&&i(a,n)&&u.push(n);for(;e.length>l;)i(a,n=e[l++])&&(~o(u,n)||u.push(n));return u}},function(t,e,n){var i=n(10),r=n(4),o=n(34);t.exports=n(9)?Object.defineProperties:function(t,e){r(t);for(var n,s=o(e),a=s.length,l=0;a>l;)i.f(t,n=s[l++],e[n]);return t}},function(t,e,n){var i=n(16),r=n(37).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return s&&"[object Window]"==o.call(t)?function(t){try{return r(t)}catch(t){return s.slice()}}(t):r(i(t))}},function(t,e,n){"use strict";var i=n(9),r=n(34),o=n(54),s=n(49),a=n(11),l=n(48),u=Object.assign;t.exports=!u||n(3)((function(){var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach((function(t){e[t]=t})),7!=u({},t)[n]||Object.keys(u({},e)).join("")!=i}))?function(t,e){for(var n=a(t),u=arguments.length,h=1,c=o.f,f=s.f;u>h;)for(var d,p=l(arguments[h++]),g=c?r(p).concat(c(p)):r(p),m=g.length,v=0;m>v;)d=g[v++],i&&!f.call(p,d)||(n[d]=p[d]);return n}:u},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,n){"use strict";var i=n(19),r=n(5),o=n(102),s=[].slice,a={},l=function(t,e,n){if(!(e in a)){for(var i=[],r=0;r<e;r++)i[r]="a["+r+"]";a[e]=Function("F,a","return new F("+i.join(",")+")")}return a[e](t,n)};t.exports=Function.bind||function(t){var e=i(this),n=s.call(arguments,1),a=function(){var i=n.concat(s.call(arguments));return this instanceof a?l(e,i.length,i):o(e,i,t)};return r(e.prototype)&&(a.prototype=e.prototype),a}},function(t,e){t.exports=function(t,e,n){var i=void 0===n;switch(e.length){case 0:return i?t():t.call(n);case 1:return i?t(e[0]):t.call(n,e[0]);case 2:return i?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return i?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return i?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},function(t,e,n){var i=n(2).parseInt,r=n(42).trim,o=n(70),s=/^[-+]?0[xX]/;t.exports=8!==i(o+"08")||22!==i(o+"0x16")?function(t,e){var n=r(String(t),3);return i(n,e>>>0||(s.test(n)?16:10))}:i},function(t,e,n){var i=n(2).parseFloat,r=n(42).trim;t.exports=1/i(n(70)+"-0")!=-1/0?function(t){var e=r(String(t),3),n=i(e);return 0===n&&"-"==e.charAt(0)?-0:n}:i},function(t,e,n){var i=n(25);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=i(t))throw TypeError(e);return+t}},function(t,e,n){var i=n(5),r=Math.floor;t.exports=function(t){return!i(t)&&isFinite(t)&&r(t)===t}},function(t,e){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,e,n){"use strict";var i=n(36),r=n(31),o=n(41),s={};n(15)(s,n(6)("iterator"),(function(){return this})),t.exports=function(t,e,n){t.prototype=i(s,{next:r(1,n)}),o(t,e+" Iterator")}},function(t,e,n){var i=n(4);t.exports=function(t,e,n,r){try{return r?e(i(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&i(o.call(t)),e}}},function(t,e,n){var i=n(222);t.exports=function(t,e){return new(i(t))(e)}},function(t,e,n){var i=n(19),r=n(11),o=n(48),s=n(7);t.exports=function(t,e,n,a,l){i(e);var u=r(t),h=o(u),c=s(u.length),f=l?c-1:0,d=l?-1:1;if(n<2)for(;;){if(f in h){a=h[f],f+=d;break}if(f+=d,l?f<0:c<=f)throw TypeError("Reduce of empty array with no initial value")}for(;l?f>=0:c>f;f+=d)f in h&&(a=e(a,h[f],f,u));return a}},function(t,e,n){"use strict";var i=n(11),r=n(35),o=n(7);t.exports=[].copyWithin||function(t,e){var n=i(this),s=o(n.length),a=r(t,s),l=r(e,s),u=arguments.length>2?arguments[2]:void 0,h=Math.min((void 0===u?s:r(u,s))-l,s-a),c=1;for(l<a&&a<l+h&&(c=-1,l+=h-1,a+=h-1);h-- >0;)l in n?n[a]=n[l]:delete n[a],a+=c,l+=c;return n}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,n){"use strict";var i=n(85);n(0)({target:"RegExp",proto:!0,forced:i!==/./.exec},{exec:i})},function(t,e,n){n(9)&&"g"!=/./g.flags&&n(10).f(RegExp.prototype,"flags",{configurable:!0,get:n(57)})},function(t,e,n){"use strict";var i,r,o,s,a=n(33),l=n(2),u=n(18),h=n(50),c=n(0),f=n(5),d=n(19),p=n(45),g=n(60),m=n(51),v=n(87).set,y=n(242)(),b=n(117),_=n(243),S=n(61),w=n(118),x=l.TypeError,C=l.process,N=C&&C.versions,T=N&&N.v8||"",k=l.Promise,E="process"==h(C),P=function(){},O=r=b.f,I=!!function(){try{var t=k.resolve(1),e=(t.constructor={})[n(6)("species")]=function(t){t(P,P)};return(E||"function"==typeof PromiseRejectionEvent)&&t.then(P)instanceof e&&0!==T.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(t){}}(),A=function(t){var e;return!(!f(t)||"function"!=typeof(e=t.then))&&e},F=function(t,e){if(!t._n){t._n=!0;var n=t._c;y((function(){for(var i=t._v,r=1==t._s,o=0,s=function(e){var n,o,s,a=r?e.ok:e.fail,l=e.resolve,u=e.reject,h=e.domain;try{a?(r||(2==t._h&&R(t),t._h=1),!0===a?n=i:(h&&h.enter(),n=a(i),h&&(h.exit(),s=!0)),n===e.promise?u(x("Promise-chain cycle")):(o=A(n))?o.call(n,l,u):l(n)):u(i)}catch(t){h&&!s&&h.exit(),u(t)}};n.length>o;)s(n[o++]);t._c=[],t._n=!1,e&&!t._h&&W(t)}))}},W=function(t){v.call(l,(function(){var e,n,i,r=t._v,o=M(t);if(o&&(e=_((function(){E?C.emit("unhandledRejection",r,t):(n=l.onunhandledrejection)?n({promise:t,reason:r}):(i=l.console)&&i.error&&i.error("Unhandled promise rejection",r)})),t._h=E||M(t)?2:1),t._a=void 0,o&&e.e)throw e.v}))},M=function(t){return 1!==t._h&&0===(t._a||t._c).length},R=function(t){v.call(l,(function(){var e;E?C.emit("rejectionHandled",t):(e=l.onrejectionhandled)&&e({promise:t,reason:t._v})}))},L=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),F(e,!0))},j=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw x("Promise can't be resolved itself");(e=A(t))?y((function(){var i={_w:n,_d:!1};try{e.call(t,u(j,i,1),u(L,i,1))}catch(t){L.call(i,t)}})):(n._v=t,n._s=1,F(n,!1))}catch(t){L.call({_w:n,_d:!1},t)}}};I||(k=function(t){p(this,k,"Promise","_h"),d(t),i.call(this);try{t(u(j,this,1),u(L,this,1))}catch(t){L.call(this,t)}},(i=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(46)(k.prototype,{then:function(t,e){var n=O(m(this,k));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=E?C.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&F(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new i;this.promise=t,this.resolve=u(j,t,1),this.reject=u(L,t,1)},b.f=O=function(t){return t===k||t===s?new o(t):r(t)}),c(c.G+c.W+c.F*!I,{Promise:k}),n(41)(k,"Promise"),n(44)("Promise"),s=n(8).Promise,c(c.S+c.F*!I,"Promise",{reject:function(t){var e=O(this);return(0,e.reject)(t),e.promise}}),c(c.S+c.F*(a||!I),"Promise",{resolve:function(t){return w(a&&this===s?k:this,t)}}),c(c.S+c.F*!(I&&n(56)((function(t){k.all(t).catch(P)}))),"Promise",{all:function(t){var e=this,n=O(e),i=n.resolve,r=n.reject,o=_((function(){var n=[],o=0,s=1;g(t,!1,(function(t){var a=o++,l=!1;n.push(void 0),s++,e.resolve(t).then((function(t){l||(l=!0,n[a]=t,--s||i(n))}),r)})),--s||i(n)}));return o.e&&r(o.v),n.promise},race:function(t){var e=this,n=O(e),i=n.reject,r=_((function(){g(t,!1,(function(t){e.resolve(t).then(n.resolve,i)}))}));return r.e&&i(r.v),n.promise}})},function(t,e,n){"use strict";var i=n(19);function r(t){var e,n;this.promise=new t((function(t,i){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=i})),this.resolve=i(e),this.reject=i(n)}t.exports.f=function(t){return new r(t)}},function(t,e,n){var i=n(4),r=n(5),o=n(117);t.exports=function(t,e){if(i(t),r(e)&&e.constructor===t)return e;var n=o.f(t);return(0,n.resolve)(e),n.promise}},function(t,e,n){"use strict";var i=n(10).f,r=n(36),o=n(46),s=n(18),a=n(45),l=n(60),u=n(76),h=n(113),c=n(44),f=n(9),d=n(30).fastKey,p=n(40),g=f?"_s":"size",m=function(t,e){var n,i=d(e);if("F"!==i)return t._i[i];for(n=t._f;n;n=n.n)if(n.k==e)return n};t.exports={getConstructor:function(t,e,n,u){var h=t((function(t,i){a(t,h,e,"_i"),t._t=e,t._i=r(null),t._f=void 0,t._l=void 0,t[g]=0,null!=i&&l(i,n,t[u],t)}));return o(h.prototype,{clear:function(){for(var t=p(this,e),n=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete n[i.i];t._f=t._l=void 0,t[g]=0},delete:function(t){var n=p(this,e),i=m(n,t);if(i){var r=i.n,o=i.p;delete n._i[i.i],i.r=!0,o&&(o.n=r),r&&(r.p=o),n._f==i&&(n._f=r),n._l==i&&(n._l=o),n[g]--}return!!i},forEach:function(t){p(this,e);for(var n,i=s(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(i(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!m(p(this,e),t)}}),f&&i(h.prototype,"size",{get:function(){return p(this,e)[g]}}),h},def:function(t,e,n){var i,r,o=m(t,e);return o?o.v=n:(t._l=o={i:r=d(e,!0),k:e,v:n,p:i=t._l,n:void 0,r:!1},t._f||(t._f=o),i&&(i.n=o),t[g]++,"F"!==r&&(t._i[r]=o)),t},getEntry:m,setStrong:function(t,e,n){u(t,e,(function(t,n){this._t=p(t,e),this._k=n,this._l=void 0}),(function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?h(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,h(1))}),n?"entries":"values",!n,!0),c(e)}}},function(t,e,n){"use strict";var i=n(46),r=n(30).getWeak,o=n(4),s=n(5),a=n(45),l=n(60),u=n(23),h=n(14),c=n(40),f=u(5),d=u(6),p=0,g=function(t){return t._l||(t._l=new m)},m=function(){this.a=[]},v=function(t,e){return f(t.a,(function(t){return t[0]===e}))};m.prototype={get:function(t){var e=v(this,t);if(e)return e[1]},has:function(t){return!!v(this,t)},set:function(t,e){var n=v(this,t);n?n[1]=e:this.a.push([t,e])},delete:function(t){var e=d(this.a,(function(e){return e[0]===t}));return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,n,o){var u=t((function(t,i){a(t,u,e,"_i"),t._t=e,t._i=p++,t._l=void 0,null!=i&&l(i,n,t[o],t)}));return i(u.prototype,{delete:function(t){if(!s(t))return!1;var n=r(t);return!0===n?g(c(this,e)).delete(t):n&&h(n,this._i)&&delete n[this._i]},has:function(t){if(!s(t))return!1;var n=r(t);return!0===n?g(c(this,e)).has(t):n&&h(n,this._i)}}),u},def:function(t,e,n){var i=r(o(e),!0);return!0===i?g(t).set(e,n):i[t._i]=n,t},ufstore:g}},function(t,e,n){var i=n(20),r=n(7);t.exports=function(t){if(void 0===t)return 0;var e=i(t),n=r(e);if(e!==n)throw RangeError("Wrong length!");return n}},function(t,e,n){var i=n(37),r=n(54),o=n(4),s=n(2).Reflect;t.exports=s&&s.ownKeys||function(t){var e=i.f(o(t)),n=r.f;return n?e.concat(n(t)):e}},function(t,e,n){var i=n(7),r=n(72),o=n(26);t.exports=function(t,e,n,s){var a=String(o(t)),l=a.length,u=void 0===n?" ":String(n),h=i(e);if(h<=l||""==u)return a;var c=h-l,f=r.call(u,Math.ceil(c/u.length));return f.length>c&&(f=f.slice(0,c)),s?f+a:a+f}},function(t,e,n){var i=n(9),r=n(34),o=n(16),s=n(49).f;t.exports=function(t){return function(e){for(var n,a=o(e),l=r(a),u=l.length,h=0,c=[];u>h;)n=l[h++],i&&!s.call(a,n)||c.push(t?[n,a[n]]:a[n]);return c}}},function(t,e){var n=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){n(128),t.exports=n(319)},function(t,e,n){"use strict";n(129);var i,r=(i=n(301))&&i.__esModule?i:{default:i};r.default._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),r.default._babelPolyfill=!0},function(t,e,n){"use strict";n(130),n(273),n(275),n(278),n(280),n(282),n(284),n(286),n(288),n(290),n(292),n(294),n(296),n(300)},function(t,e,n){n(131),n(134),n(135),n(136),n(137),n(138),n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(212),n(213),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(84),n(236),n(114),n(237),n(115),n(238),n(239),n(240),n(241),n(116),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),t.exports=n(8)},function(t,e,n){"use strict";var i=n(2),r=n(14),o=n(9),s=n(0),a=n(12),l=n(30).KEY,u=n(3),h=n(52),c=n(41),f=n(32),d=n(6),p=n(65),g=n(95),m=n(133),v=n(55),y=n(4),b=n(5),_=n(11),S=n(16),w=n(29),x=n(31),C=n(36),N=n(98),T=n(21),k=n(54),E=n(10),P=n(34),O=T.f,I=E.f,A=N.f,F=i.Symbol,W=i.JSON,M=W&&W.stringify,R=d("_hidden"),L=d("toPrimitive"),j={}.propertyIsEnumerable,G=h("symbol-registry"),V=h("symbols"),D=h("op-symbols"),U=Object.prototype,B="function"==typeof F&&!!k.f,z=i.QObject,q=!z||!z.prototype||!z.prototype.findChild,H=o&&u((function(){return 7!=C(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a}))?function(t,e,n){var i=O(U,e);i&&delete U[e],I(t,e,n),i&&t!==U&&I(U,e,i)}:I,Y=function(t){var e=V[t]=C(F.prototype);return e._k=t,e},X=B&&"symbol"==typeof F.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof F},K=function(t,e,n){return t===U&&K(D,e,n),y(t),e=w(e,!0),y(n),r(V,e)?(n.enumerable?(r(t,R)&&t[R][e]&&(t[R][e]=!1),n=C(n,{enumerable:x(0,!1)})):(r(t,R)||I(t,R,x(1,{})),t[R][e]=!0),H(t,e,n)):I(t,e,n)},J=function(t,e){y(t);for(var n,i=m(e=S(e)),r=0,o=i.length;o>r;)K(t,n=i[r++],e[n]);return t},$=function(t){var e=j.call(this,t=w(t,!0));return!(this===U&&r(V,t)&&!r(D,t))&&(!(e||!r(this,t)||!r(V,t)||r(this,R)&&this[R][t])||e)},Q=function(t,e){if(t=S(t),e=w(e,!0),t!==U||!r(V,e)||r(D,e)){var n=O(t,e);return!n||!r(V,e)||r(t,R)&&t[R][e]||(n.enumerable=!0),n}},Z=function(t){for(var e,n=A(S(t)),i=[],o=0;n.length>o;)r(V,e=n[o++])||e==R||e==l||i.push(e);return i},tt=function(t){for(var e,n=t===U,i=A(n?D:S(t)),o=[],s=0;i.length>s;)!r(V,e=i[s++])||n&&!r(U,e)||o.push(V[e]);return o};B||(a((F=function(){if(this instanceof F)throw TypeError("Symbol is not a constructor!");var t=f(arguments.length>0?arguments[0]:void 0),e=function(n){this===U&&e.call(D,n),r(this,R)&&r(this[R],t)&&(this[R][t]=!1),H(this,t,x(1,n))};return o&&q&&H(U,t,{configurable:!0,set:e}),Y(t)}).prototype,"toString",(function(){return this._k})),T.f=Q,E.f=K,n(37).f=N.f=Z,n(49).f=$,k.f=tt,o&&!n(33)&&a(U,"propertyIsEnumerable",$,!0),p.f=function(t){return Y(d(t))}),s(s.G+s.W+s.F*!B,{Symbol:F});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),nt=0;et.length>nt;)d(et[nt++]);for(var it=P(d.store),rt=0;it.length>rt;)g(it[rt++]);s(s.S+s.F*!B,"Symbol",{for:function(t){return r(G,t+="")?G[t]:G[t]=F(t)},keyFor:function(t){if(!X(t))throw TypeError(t+" is not a symbol!");for(var e in G)if(G[e]===t)return e},useSetter:function(){q=!0},useSimple:function(){q=!1}}),s(s.S+s.F*!B,"Object",{create:function(t,e){return void 0===e?C(t):J(C(t),e)},defineProperty:K,defineProperties:J,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt});var ot=u((function(){k.f(1)}));s(s.S+s.F*ot,"Object",{getOwnPropertySymbols:function(t){return k.f(_(t))}}),W&&s(s.S+s.F*(!B||u((function(){var t=F();return"[null]"!=M([t])||"{}"!=M({a:t})||"{}"!=M(Object(t))}))),"JSON",{stringify:function(t){for(var e,n,i=[t],r=1;arguments.length>r;)i.push(arguments[r++]);if(n=e=i[1],(b(e)||void 0!==t)&&!X(t))return v(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!X(e))return e}),i[1]=e,M.apply(W,i)}}),F.prototype[L]||n(15)(F.prototype,L,F.prototype.valueOf),c(F,"Symbol"),c(Math,"Math",!0),c(i.JSON,"JSON",!0)},function(t,e,n){t.exports=n(52)("native-function-to-string",Function.toString)},function(t,e,n){var i=n(34),r=n(54),o=n(49);t.exports=function(t){var e=i(t),n=r.f;if(n)for(var s,a=n(t),l=o.f,u=0;a.length>u;)l.call(t,s=a[u++])&&e.push(s);return e}},function(t,e,n){var i=n(0);i(i.S,"Object",{create:n(36)})},function(t,e,n){var i=n(0);i(i.S+i.F*!n(9),"Object",{defineProperty:n(10).f})},function(t,e,n){var i=n(0);i(i.S+i.F*!n(9),"Object",{defineProperties:n(97)})},function(t,e,n){var i=n(16),r=n(21).f;n(22)("getOwnPropertyDescriptor",(function(){return function(t,e){return r(i(t),e)}}))},function(t,e,n){var i=n(11),r=n(38);n(22)("getPrototypeOf",(function(){return function(t){return r(i(t))}}))},function(t,e,n){var i=n(11),r=n(34);n(22)("keys",(function(){return function(t){return r(i(t))}}))},function(t,e,n){n(22)("getOwnPropertyNames",(function(){return n(98).f}))},function(t,e,n){var i=n(5),r=n(30).onFreeze;n(22)("freeze",(function(t){return function(e){return t&&i(e)?t(r(e)):e}}))},function(t,e,n){var i=n(5),r=n(30).onFreeze;n(22)("seal",(function(t){return function(e){return t&&i(e)?t(r(e)):e}}))},function(t,e,n){var i=n(5),r=n(30).onFreeze;n(22)("preventExtensions",(function(t){return function(e){return t&&i(e)?t(r(e)):e}}))},function(t,e,n){var i=n(5);n(22)("isFrozen",(function(t){return function(e){return!i(e)||!!t&&t(e)}}))},function(t,e,n){var i=n(5);n(22)("isSealed",(function(t){return function(e){return!i(e)||!!t&&t(e)}}))},function(t,e,n){var i=n(5);n(22)("isExtensible",(function(t){return function(e){return!!i(e)&&(!t||t(e))}}))},function(t,e,n){var i=n(0);i(i.S+i.F,"Object",{assign:n(99)})},function(t,e,n){var i=n(0);i(i.S,"Object",{is:n(100)})},function(t,e,n){var i=n(0);i(i.S,"Object",{setPrototypeOf:n(69).set})},function(t,e,n){"use strict";var i=n(50),r={};r[n(6)("toStringTag")]="z",r+""!="[object z]"&&n(12)(Object.prototype,"toString",(function(){return"[object "+i(this)+"]"}),!0)},function(t,e,n){var i=n(0);i(i.P,"Function",{bind:n(101)})},function(t,e,n){var i=n(10).f,r=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in r||n(9)&&i(r,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},function(t,e,n){"use strict";var i=n(5),r=n(38),o=n(6)("hasInstance"),s=Function.prototype;o in s||n(10).f(s,o,{value:function(t){if("function"!=typeof this||!i(t))return!1;if(!i(this.prototype))return t instanceof this;for(;t=r(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,n){var i=n(0),r=n(103);i(i.G+i.F*(parseInt!=r),{parseInt:r})},function(t,e,n){var i=n(0),r=n(104);i(i.G+i.F*(parseFloat!=r),{parseFloat:r})},function(t,e,n){"use strict";var i=n(2),r=n(14),o=n(25),s=n(71),a=n(29),l=n(3),u=n(37).f,h=n(21).f,c=n(10).f,f=n(42).trim,d=i.Number,p=d,g=d.prototype,m="Number"==o(n(36)(g)),v="trim"in String.prototype,y=function(t){var e=a(t,!1);if("string"==typeof e&&e.length>2){var n,i,r,o=(e=v?e.trim():f(e,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=e.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(e.charCodeAt(1)){case 66:case 98:i=2,r=49;break;case 79:case 111:i=8,r=55;break;default:return+e}for(var s,l=e.slice(2),u=0,h=l.length;u<h;u++)if((s=l.charCodeAt(u))<48||s>r)return NaN;return parseInt(l,i)}}return+e};if(!d(" 0o1")||!d("0b1")||d("+0x1")){d=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof d&&(m?l((function(){g.valueOf.call(n)})):"Number"!=o(n))?s(new p(y(e)),n,d):y(e)};for(var b,_=n(9)?u(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;_.length>S;S++)r(p,b=_[S])&&!r(d,b)&&c(d,b,h(p,b));d.prototype=g,g.constructor=d,n(12)(i,"Number",d)}},function(t,e,n){"use strict";var i=n(0),r=n(20),o=n(105),s=n(72),a=1..toFixed,l=Math.floor,u=[0,0,0,0,0,0],h="Number.toFixed: incorrect invocation!",c=function(t,e){for(var n=-1,i=e;++n<6;)i+=t*u[n],u[n]=i%1e7,i=l(i/1e7)},f=function(t){for(var e=6,n=0;--e>=0;)n+=u[e],u[e]=l(n/t),n=n%t*1e7},d=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==u[t]){var n=String(u[t]);e=""===e?n:e+s.call("0",7-n.length)+n}return e},p=function(t,e,n){return 0===e?n:e%2==1?p(t,e-1,n*t):p(t*t,e/2,n)};i(i.P+i.F*(!!a&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(3)((function(){a.call({})}))),"Number",{toFixed:function(t){var e,n,i,a,l=o(this,h),u=r(t),g="",m="0";if(u<0||u>20)throw RangeError(h);if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(g="-",l=-l),l>1e-21)if(n=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(l*p(2,69,1))-69)<0?l*p(2,-e,1):l/p(2,e,1),n*=4503599627370496,(e=52-e)>0){for(c(0,n),i=u;i>=7;)c(1e7,0),i-=7;for(c(p(10,i,1),0),i=e-1;i>=23;)f(1<<23),i-=23;f(1<<i),c(1,1),f(2),m=d()}else c(0,n),c(1<<-e,0),m=d()+s.call("0",u);return m=u>0?g+((a=m.length)<=u?"0."+s.call("0",u-a)+m:m.slice(0,a-u)+"."+m.slice(a-u)):g+m}})},function(t,e,n){"use strict";var i=n(0),r=n(3),o=n(105),s=1..toPrecision;i(i.P+i.F*(r((function(){return"1"!==s.call(1,void 0)}))||!r((function(){s.call({})}))),"Number",{toPrecision:function(t){var e=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?s.call(e):s.call(e,t)}})},function(t,e,n){var i=n(0);i(i.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,e,n){var i=n(0),r=n(2).isFinite;i(i.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},function(t,e,n){var i=n(0);i(i.S,"Number",{isInteger:n(106)})},function(t,e,n){var i=n(0);i(i.S,"Number",{isNaN:function(t){return t!=t}})},function(t,e,n){var i=n(0),r=n(106),o=Math.abs;i(i.S,"Number",{isSafeInteger:function(t){return r(t)&&o(t)<=9007199254740991}})},function(t,e,n){var i=n(0);i(i.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,e,n){var i=n(0);i(i.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,e,n){var i=n(0),r=n(104);i(i.S+i.F*(Number.parseFloat!=r),"Number",{parseFloat:r})},function(t,e,n){var i=n(0),r=n(103);i(i.S+i.F*(Number.parseInt!=r),"Number",{parseInt:r})},function(t,e,n){var i=n(0),r=n(107),o=Math.sqrt,s=Math.acosh;i(i.S+i.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))&&s(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:r(t-1+o(t-1)*o(t+1))}})},function(t,e,n){var i=n(0),r=Math.asinh;i(i.S+i.F*!(r&&1/r(0)>0),"Math",{asinh:function t(e){return isFinite(e=+e)&&0!=e?e<0?-t(-e):Math.log(e+Math.sqrt(e*e+1)):e}})},function(t,e,n){var i=n(0),r=Math.atanh;i(i.S+i.F*!(r&&1/r(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,e,n){var i=n(0),r=n(73);i(i.S,"Math",{cbrt:function(t){return r(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,e,n){var i=n(0);i(i.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,e,n){var i=n(0),r=Math.exp;i(i.S,"Math",{cosh:function(t){return(r(t=+t)+r(-t))/2}})},function(t,e,n){var i=n(0),r=n(74);i(i.S+i.F*(r!=Math.expm1),"Math",{expm1:r})},function(t,e,n){var i=n(0);i(i.S,"Math",{fround:n(176)})},function(t,e,n){var i=n(73),r=Math.pow,o=r(2,-52),s=r(2,-23),a=r(2,127)*(2-s),l=r(2,-126);t.exports=Math.fround||function(t){var e,n,r=Math.abs(t),u=i(t);return r<l?u*(r/l/s+1/o-1/o)*l*s:(n=(e=(1+s/o)*r)-(e-r))>a||n!=n?u*(1/0):u*n}},function(t,e,n){var i=n(0),r=Math.abs;i(i.S,"Math",{hypot:function(t,e){for(var n,i,o=0,s=0,a=arguments.length,l=0;s<a;)l<(n=r(arguments[s++]))?(o=o*(i=l/n)*i+1,l=n):o+=n>0?(i=n/l)*i:n;return l===1/0?1/0:l*Math.sqrt(o)}})},function(t,e,n){var i=n(0),r=Math.imul;i(i.S+i.F*n(3)((function(){return-5!=r(4294967295,5)||2!=r.length})),"Math",{imul:function(t,e){var n=+t,i=+e,r=65535&n,o=65535&i;return 0|r*o+((65535&n>>>16)*o+r*(65535&i>>>16)<<16>>>0)}})},function(t,e,n){var i=n(0);i(i.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,e,n){var i=n(0);i(i.S,"Math",{log1p:n(107)})},function(t,e,n){var i=n(0);i(i.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,e,n){var i=n(0);i(i.S,"Math",{sign:n(73)})},function(t,e,n){var i=n(0),r=n(74),o=Math.exp;i(i.S+i.F*n(3)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(r(t)-r(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,e,n){var i=n(0),r=n(74),o=Math.exp;i(i.S,"Math",{tanh:function(t){var e=r(t=+t),n=r(-t);return e==1/0?1:n==1/0?-1:(e-n)/(o(t)+o(-t))}})},function(t,e,n){var i=n(0);i(i.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,e,n){var i=n(0),r=n(35),o=String.fromCharCode,s=String.fromCodePoint;i(i.S+i.F*(!!s&&1!=s.length),"String",{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,s=0;i>s;){if(e=+arguments[s++],r(e,1114111)!==e)throw RangeError(e+" is not a valid code point");n.push(e<65536?o(e):o(55296+((e-=65536)>>10),e%1024+56320))}return n.join("")}})},function(t,e,n){var i=n(0),r=n(16),o=n(7);i(i.S,"String",{raw:function(t){for(var e=r(t.raw),n=o(e.length),i=arguments.length,s=[],a=0;n>a;)s.push(String(e[a++])),a<i&&s.push(String(arguments[a]));return s.join("")}})},function(t,e,n){"use strict";n(42)("trim",(function(t){return function(){return t(this,3)}}))},function(t,e,n){"use strict";var i=n(75)(!0);n(76)(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=i(e,n),this._i+=t.length,{value:t,done:!1})}))},function(t,e,n){"use strict";var i=n(0),r=n(75)(!1);i(i.P,"String",{codePointAt:function(t){return r(this,t)}})},function(t,e,n){"use strict";var i=n(0),r=n(7),o=n(77),s="".endsWith;i(i.P+i.F*n(79)("endsWith"),"String",{endsWith:function(t){var e=o(this,t,"endsWith"),n=arguments.length>1?arguments[1]:void 0,i=r(e.length),a=void 0===n?i:Math.min(r(n),i),l=String(t);return s?s.call(e,l,a):e.slice(a-l.length,a)===l}})},function(t,e,n){"use strict";var i=n(0),r=n(77);i(i.P+i.F*n(79)("includes"),"String",{includes:function(t){return!!~r(this,t,"includes").indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var i=n(0);i(i.P,"String",{repeat:n(72)})},function(t,e,n){"use strict";var i=n(0),r=n(7),o=n(77),s="".startsWith;i(i.P+i.F*n(79)("startsWith"),"String",{startsWith:function(t){var e=o(this,t,"startsWith"),n=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),i=String(t);return s?s.call(e,i,n):e.slice(n,n+i.length)===i}})},function(t,e,n){"use strict";n(13)("anchor",(function(t){return function(e){return t(this,"a","name",e)}}))},function(t,e,n){"use strict";n(13)("big",(function(t){return function(){return t(this,"big","","")}}))},function(t,e,n){"use strict";n(13)("blink",(function(t){return function(){return t(this,"blink","","")}}))},function(t,e,n){"use strict";n(13)("bold",(function(t){return function(){return t(this,"b","","")}}))},function(t,e,n){"use strict";n(13)("fixed",(function(t){return function(){return t(this,"tt","","")}}))},function(t,e,n){"use strict";n(13)("fontcolor",(function(t){return function(e){return t(this,"font","color",e)}}))},function(t,e,n){"use strict";n(13)("fontsize",(function(t){return function(e){return t(this,"font","size",e)}}))},function(t,e,n){"use strict";n(13)("italics",(function(t){return function(){return t(this,"i","","")}}))},function(t,e,n){"use strict";n(13)("link",(function(t){return function(e){return t(this,"a","href",e)}}))},function(t,e,n){"use strict";n(13)("small",(function(t){return function(){return t(this,"small","","")}}))},function(t,e,n){"use strict";n(13)("strike",(function(t){return function(){return t(this,"strike","","")}}))},function(t,e,n){"use strict";n(13)("sub",(function(t){return function(){return t(this,"sub","","")}}))},function(t,e,n){"use strict";n(13)("sup",(function(t){return function(){return t(this,"sup","","")}}))},function(t,e,n){var i=n(0);i(i.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,e,n){"use strict";var i=n(0),r=n(11),o=n(29);i(i.P+i.F*n(3)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(t){var e=r(this),n=o(e);return"number"!=typeof n||isFinite(n)?e.toISOString():null}})},function(t,e,n){var i=n(0),r=n(211);i(i.P+i.F*(Date.prototype.toISOString!==r),"Date",{toISOString:r})},function(t,e,n){"use strict";var i=n(3),r=Date.prototype.getTime,o=Date.prototype.toISOString,s=function(t){return t>9?t:"0"+t};t.exports=i((function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-50000000000001))}))||!i((function(){o.call(new Date(NaN))}))?function(){if(!isFinite(r.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),n=t.getUTCMilliseconds(),i=e<0?"-":e>9999?"+":"";return i+("00000"+Math.abs(e)).slice(i?-6:-4)+"-"+s(t.getUTCMonth()+1)+"-"+s(t.getUTCDate())+"T"+s(t.getUTCHours())+":"+s(t.getUTCMinutes())+":"+s(t.getUTCSeconds())+"."+(n>99?n:"0"+s(n))+"Z"}:o},function(t,e,n){var i=Date.prototype,r=i.toString,o=i.getTime;new Date(NaN)+""!="Invalid Date"&&n(12)(i,"toString",(function(){var t=o.call(this);return t==t?r.call(this):"Invalid Date"}))},function(t,e,n){var i=n(6)("toPrimitive"),r=Date.prototype;i in r||n(15)(r,i,n(214))},function(t,e,n){"use strict";var i=n(4),r=n(29);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return r(i(this),"number"!=t)}},function(t,e,n){var i=n(0);i(i.S,"Array",{isArray:n(55)})},function(t,e,n){"use strict";var i=n(18),r=n(0),o=n(11),s=n(109),a=n(80),l=n(7),u=n(81),h=n(82);r(r.S+r.F*!n(56)((function(t){Array.from(t)})),"Array",{from:function(t){var e,n,r,c,f=o(t),d="function"==typeof this?this:Array,p=arguments.length,g=p>1?arguments[1]:void 0,m=void 0!==g,v=0,y=h(f);if(m&&(g=i(g,p>2?arguments[2]:void 0,2)),null==y||d==Array&&a(y))for(n=new d(e=l(f.length));e>v;v++)u(n,v,m?g(f[v],v):f[v]);else for(c=y.call(f),n=new d;!(r=c.next()).done;v++)u(n,v,m?s(c,g,[r.value,v],!0):r.value);return n.length=v,n}})},function(t,e,n){"use strict";var i=n(0),r=n(81);i(i.S+i.F*n(3)((function(){function t(){}return!(Array.of.call(t)instanceof t)})),"Array",{of:function(){for(var t=0,e=arguments.length,n=new("function"==typeof this?this:Array)(e);e>t;)r(n,t,arguments[t++]);return n.length=e,n}})},function(t,e,n){"use strict";var i=n(0),r=n(16),o=[].join;i(i.P+i.F*(n(48)!=Object||!n(17)(o)),"Array",{join:function(t){return o.call(r(this),void 0===t?",":t)}})},function(t,e,n){"use strict";var i=n(0),r=n(68),o=n(25),s=n(35),a=n(7),l=[].slice;i(i.P+i.F*n(3)((function(){r&&l.call(r)})),"Array",{slice:function(t,e){var n=a(this.length),i=o(this);if(e=void 0===e?n:e,"Array"==i)return l.call(this,t,e);for(var r=s(t,n),u=s(e,n),h=a(u-r),c=new Array(h),f=0;f<h;f++)c[f]="String"==i?this.charAt(r+f):this[r+f];return c}})},function(t,e,n){"use strict";var i=n(0),r=n(19),o=n(11),s=n(3),a=[].sort,l=[1,2,3];i(i.P+i.F*(s((function(){l.sort(void 0)}))||!s((function(){l.sort(null)}))||!n(17)(a)),"Array",{sort:function(t){return void 0===t?a.call(o(this)):a.call(o(this),r(t))}})},function(t,e,n){"use strict";var i=n(0),r=n(23)(0),o=n(17)([].forEach,!0);i(i.P+i.F*!o,"Array",{forEach:function(t){return r(this,t,arguments[1])}})},function(t,e,n){var i=n(5),r=n(55),o=n(6)("species");t.exports=function(t){var e;return r(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!r(e.prototype)||(e=void 0),i(e)&&null===(e=e[o])&&(e=void 0)),void 0===e?Array:e}},function(t,e,n){"use strict";var i=n(0),r=n(23)(1);i(i.P+i.F*!n(17)([].map,!0),"Array",{map:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(23)(2);i(i.P+i.F*!n(17)([].filter,!0),"Array",{filter:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(23)(3);i(i.P+i.F*!n(17)([].some,!0),"Array",{some:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(23)(4);i(i.P+i.F*!n(17)([].every,!0),"Array",{every:function(t){return r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(111);i(i.P+i.F*!n(17)([].reduce,!0),"Array",{reduce:function(t){return r(this,t,arguments.length,arguments[1],!1)}})},function(t,e,n){"use strict";var i=n(0),r=n(111);i(i.P+i.F*!n(17)([].reduceRight,!0),"Array",{reduceRight:function(t){return r(this,t,arguments.length,arguments[1],!0)}})},function(t,e,n){"use strict";var i=n(0),r=n(53)(!1),o=[].indexOf,s=!!o&&1/[1].indexOf(1,-0)<0;i(i.P+i.F*(s||!n(17)(o)),"Array",{indexOf:function(t){return s?o.apply(this,arguments)||0:r(this,t,arguments[1])}})},function(t,e,n){"use strict";var i=n(0),r=n(16),o=n(20),s=n(7),a=[].lastIndexOf,l=!!a&&1/[1].lastIndexOf(1,-0)<0;i(i.P+i.F*(l||!n(17)(a)),"Array",{lastIndexOf:function(t){if(l)return a.apply(this,arguments)||0;var e=r(this),n=s(e.length),i=n-1;for(arguments.length>1&&(i=Math.min(i,o(arguments[1]))),i<0&&(i=n+i);i>=0;i--)if(i in e&&e[i]===t)return i||0;return-1}})},function(t,e,n){var i=n(0);i(i.P,"Array",{copyWithin:n(112)}),n(39)("copyWithin")},function(t,e,n){var i=n(0);i(i.P,"Array",{fill:n(83)}),n(39)("fill")},function(t,e,n){"use strict";var i=n(0),r=n(23)(5),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),i(i.P+i.F*o,"Array",{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(39)("find")},function(t,e,n){"use strict";var i=n(0),r=n(23)(6),o="findIndex",s=!0;o in[]&&Array(1)[o]((function(){s=!1})),i(i.P+i.F*s,"Array",{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(39)(o)},function(t,e,n){n(44)("Array")},function(t,e,n){var i=n(2),r=n(71),o=n(10).f,s=n(37).f,a=n(78),l=n(57),u=i.RegExp,h=u,c=u.prototype,f=/a/g,d=/a/g,p=new u(f)!==f;if(n(9)&&(!p||n(3)((function(){return d[n(6)("match")]=!1,u(f)!=f||u(d)==d||"/a/i"!=u(f,"i")})))){u=function(t,e){var n=this instanceof u,i=a(t),o=void 0===e;return!n&&i&&t.constructor===u&&o?t:r(p?new h(i&&!o?t.source:t,e):h((i=t instanceof u)?t.source:t,i&&o?l.call(t):e),n?this:c,u)};for(var g=function(t){t in u||o(u,t,{configurable:!0,get:function(){return h[t]},set:function(e){h[t]=e}})},m=s(h),v=0;m.length>v;)g(m[v++]);c.constructor=u,u.prototype=c,n(12)(i,"RegExp",u)}n(44)("RegExp")},function(t,e,n){"use strict";n(115);var i=n(4),r=n(57),o=n(9),s=/./.toString,a=function(t){n(12)(RegExp.prototype,"toString",t,!0)};n(3)((function(){return"/a/b"!=s.call({source:"a",flags:"b"})}))?a((function(){var t=i(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?r.call(t):void 0)})):"toString"!=s.name&&a((function(){return s.call(this)}))},function(t,e,n){"use strict";var i=n(4),r=n(7),o=n(86),s=n(58);n(59)("match",1,(function(t,e,n,a){return[function(n){var i=t(this),r=null==n?void 0:n[e];return void 0!==r?r.call(n,i):new RegExp(n)[e](String(i))},function(t){var e=a(n,t,this);if(e.done)return e.value;var l=i(t),u=String(this);if(!l.global)return s(l,u);var h=l.unicode;l.lastIndex=0;for(var c,f=[],d=0;null!==(c=s(l,u));){var p=String(c[0]);f[d]=p,""===p&&(l.lastIndex=o(u,r(l.lastIndex),h)),d++}return 0===d?null:f}]}))},function(t,e,n){"use strict";var i=n(4),r=n(11),o=n(7),s=n(20),a=n(86),l=n(58),u=Math.max,h=Math.min,c=Math.floor,f=/\$([$&`']|\d\d?|<[^>]*>)/g,d=/\$([$&`']|\d\d?)/g;n(59)("replace",2,(function(t,e,n,p){return[function(i,r){var o=t(this),s=null==i?void 0:i[e];return void 0!==s?s.call(i,o,r):n.call(String(o),i,r)},function(t,e){var r=p(n,t,this,e);if(r.done)return r.value;var c=i(t),f=String(this),d="function"==typeof e;d||(e=String(e));var m=c.global;if(m){var v=c.unicode;c.lastIndex=0}for(var y=[];;){var b=l(c,f);if(null===b)break;if(y.push(b),!m)break;""===String(b[0])&&(c.lastIndex=a(f,o(c.lastIndex),v))}for(var _,S="",w=0,x=0;x<y.length;x++){b=y[x];for(var C=String(b[0]),N=u(h(s(b.index),f.length),0),T=[],k=1;k<b.length;k++)T.push(void 0===(_=b[k])?_:String(_));var E=b.groups;if(d){var P=[C].concat(T,N,f);void 0!==E&&P.push(E);var O=String(e.apply(void 0,P))}else O=g(C,f,N,T,E,e);N>=w&&(S+=f.slice(w,N)+O,w=N+C.length)}return S+f.slice(w)}];function g(t,e,i,o,s,a){var l=i+t.length,u=o.length,h=d;return void 0!==s&&(s=r(s),h=f),n.call(a,h,(function(n,r){var a;switch(r.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,i);case"'":return e.slice(l);case"<":a=s[r.slice(1,-1)];break;default:var h=+r;if(0===h)return n;if(h>u){var f=c(h/10);return 0===f?n:f<=u?void 0===o[f-1]?r.charAt(1):o[f-1]+r.charAt(1):n}a=o[h-1]}return void 0===a?"":a}))}}))},function(t,e,n){"use strict";var i=n(4),r=n(100),o=n(58);n(59)("search",1,(function(t,e,n,s){return[function(n){var i=t(this),r=null==n?void 0:n[e];return void 0!==r?r.call(n,i):new RegExp(n)[e](String(i))},function(t){var e=s(n,t,this);if(e.done)return e.value;var a=i(t),l=String(this),u=a.lastIndex;r(u,0)||(a.lastIndex=0);var h=o(a,l);return r(a.lastIndex,u)||(a.lastIndex=u),null===h?-1:h.index}]}))},function(t,e,n){"use strict";var i=n(78),r=n(4),o=n(51),s=n(86),a=n(7),l=n(58),u=n(85),h=n(3),c=Math.min,f=[].push,d="length",p=!h((function(){RegExp(4294967295,"y")}));n(59)("split",2,(function(t,e,n,h){var g;return g="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1)[d]||2!="ab".split(/(?:ab)*/)[d]||4!=".".split(/(.?)(.?)/)[d]||".".split(/()()/)[d]>1||"".split(/.?/)[d]?function(t,e){var r=String(this);if(void 0===t&&0===e)return[];if(!i(t))return n.call(r,t,e);for(var o,s,a,l=[],h=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),c=0,p=void 0===e?4294967295:e>>>0,g=new RegExp(t.source,h+"g");(o=u.call(g,r))&&!((s=g.lastIndex)>c&&(l.push(r.slice(c,o.index)),o[d]>1&&o.index<r[d]&&f.apply(l,o.slice(1)),a=o[0][d],c=s,l[d]>=p));)g.lastIndex===o.index&&g.lastIndex++;return c===r[d]?!a&&g.test("")||l.push(""):l.push(r.slice(c)),l[d]>p?l.slice(0,p):l}:"0".split(void 0,0)[d]?function(t,e){return void 0===t&&0===e?[]:n.call(this,t,e)}:n,[function(n,i){var r=t(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,r,i):g.call(String(r),n,i)},function(t,e){var i=h(g,t,this,e,g!==n);if(i.done)return i.value;var u=r(t),f=String(this),d=o(u,RegExp),m=u.unicode,v=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(p?"y":"g"),y=new d(p?u:"^(?:"+u.source+")",v),b=void 0===e?4294967295:e>>>0;if(0===b)return[];if(0===f.length)return null===l(y,f)?[f]:[];for(var _=0,S=0,w=[];S<f.length;){y.lastIndex=p?S:0;var x,C=l(y,p?f:f.slice(S));if(null===C||(x=c(a(y.lastIndex+(p?0:S)),f.length))===_)S=s(f,S,m);else{if(w.push(f.slice(_,S)),w.length===b)return w;for(var N=1;N<=C.length-1;N++)if(w.push(C[N]),w.length===b)return w;S=_=x}}return w.push(f.slice(_)),w}]}))},function(t,e,n){var i=n(2),r=n(87).set,o=i.MutationObserver||i.WebKitMutationObserver,s=i.process,a=i.Promise,l="process"==n(25)(s);t.exports=function(){var t,e,n,u=function(){var i,r;for(l&&(i=s.domain)&&i.exit();t;){r=t.fn,t=t.next;try{r()}catch(i){throw t?n():e=void 0,i}}e=void 0,i&&i.enter()};if(l)n=function(){s.nextTick(u)};else if(!o||i.navigator&&i.navigator.standalone)if(a&&a.resolve){var h=a.resolve(void 0);n=function(){h.then(u)}}else n=function(){r.call(i,u)};else{var c=!0,f=document.createTextNode("");new o(u).observe(f,{characterData:!0}),n=function(){f.data=c=!c}}return function(i){var r={fn:i,next:void 0};e&&(e.next=r),t||(t=r,n()),e=r}}},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,n){"use strict";var i=n(119),r=n(40);t.exports=n(62)("Map",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var e=i.getEntry(r(this,"Map"),t);return e&&e.v},set:function(t,e){return i.def(r(this,"Map"),0===t?0:t,e)}},i,!0)},function(t,e,n){"use strict";var i=n(119),r=n(40);t.exports=n(62)("Set",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return i.def(r(this,"Set"),t=0===t?0:t,t)}},i)},function(t,e,n){"use strict";var i,r=n(2),o=n(23)(0),s=n(12),a=n(30),l=n(99),u=n(120),h=n(5),c=n(40),f=n(40),d=!r.ActiveXObject&&"ActiveXObject"in r,p=a.getWeak,g=Object.isExtensible,m=u.ufstore,v=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},y={get:function(t){if(h(t)){var e=p(t);return!0===e?m(c(this,"WeakMap")).get(t):e?e[this._i]:void 0}},set:function(t,e){return u.def(c(this,"WeakMap"),t,e)}},b=t.exports=n(62)("WeakMap",v,y,u,!0,!0);f&&d&&(l((i=u.getConstructor(v,"WeakMap")).prototype,y),a.NEED=!0,o(["delete","has","get","set"],(function(t){var e=b.prototype,n=e[t];s(e,t,(function(e,r){if(h(e)&&!g(e)){this._f||(this._f=new i);var o=this._f[t](e,r);return"set"==t?this:o}return n.call(this,e,r)}))})))},function(t,e,n){"use strict";var i=n(120),r=n(40);n(62)("WeakSet",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return i.def(r(this,"WeakSet"),t,!0)}},i,!1,!0)},function(t,e,n){"use strict";var i=n(0),r=n(63),o=n(88),s=n(4),a=n(35),l=n(7),u=n(5),h=n(2).ArrayBuffer,c=n(51),f=o.ArrayBuffer,d=o.DataView,p=r.ABV&&h.isView,g=f.prototype.slice,m=r.VIEW;i(i.G+i.W+i.F*(h!==f),{ArrayBuffer:f}),i(i.S+i.F*!r.CONSTR,"ArrayBuffer",{isView:function(t){return p&&p(t)||u(t)&&m in t}}),i(i.P+i.U+i.F*n(3)((function(){return!new f(2).slice(1,void 0).byteLength})),"ArrayBuffer",{slice:function(t,e){if(void 0!==g&&void 0===e)return g.call(s(this),t);for(var n=s(this).byteLength,i=a(t,n),r=a(void 0===e?n:e,n),o=new(c(this,f))(l(r-i)),u=new d(this),h=new d(o),p=0;i<r;)h.setUint8(p++,u.getUint8(i++));return o}}),n(44)("ArrayBuffer")},function(t,e,n){var i=n(0);i(i.G+i.W+i.F*!n(63).ABV,{DataView:n(88).DataView})},function(t,e,n){n(27)("Int8",1,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){n(27)("Uint8",1,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){n(27)("Uint8",1,(function(t){return function(e,n,i){return t(this,e,n,i)}}),!0)},function(t,e,n){n(27)("Int16",2,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){n(27)("Uint16",2,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){n(27)("Int32",4,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){n(27)("Uint32",4,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){n(27)("Float32",4,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){n(27)("Float64",8,(function(t){return function(e,n,i){return t(this,e,n,i)}}))},function(t,e,n){var i=n(0),r=n(19),o=n(4),s=(n(2).Reflect||{}).apply,a=Function.apply;i(i.S+i.F*!n(3)((function(){s((function(){}))})),"Reflect",{apply:function(t,e,n){var i=r(t),l=o(n);return s?s(i,e,l):a.call(i,e,l)}})},function(t,e,n){var i=n(0),r=n(36),o=n(19),s=n(4),a=n(5),l=n(3),u=n(101),h=(n(2).Reflect||{}).construct,c=l((function(){function t(){}return!(h((function(){}),[],t)instanceof t)})),f=!l((function(){h((function(){}))}));i(i.S+i.F*(c||f),"Reflect",{construct:function(t,e){o(t),s(e);var n=arguments.length<3?t:o(arguments[2]);if(f&&!c)return h(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var i=[null];return i.push.apply(i,e),new(u.apply(t,i))}var l=n.prototype,d=r(a(l)?l:Object.prototype),p=Function.apply.call(t,d,e);return a(p)?p:d}})},function(t,e,n){var i=n(10),r=n(0),o=n(4),s=n(29);r(r.S+r.F*n(3)((function(){Reflect.defineProperty(i.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(t,e,n){o(t),e=s(e,!0),o(n);try{return i.f(t,e,n),!0}catch(t){return!1}}})},function(t,e,n){var i=n(0),r=n(21).f,o=n(4);i(i.S,"Reflect",{deleteProperty:function(t,e){var n=r(o(t),e);return!(n&&!n.configurable)&&delete t[e]}})},function(t,e,n){"use strict";var i=n(0),r=n(4),o=function(t){this._t=r(t),this._i=0;var e,n=this._k=[];for(e in t)n.push(e)};n(108)(o,"Object",(function(){var t,e=this._k;do{if(this._i>=e.length)return{value:void 0,done:!0}}while(!((t=e[this._i++])in this._t));return{value:t,done:!1}})),i(i.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,e,n){var i=n(21),r=n(38),o=n(14),s=n(0),a=n(5),l=n(4);s(s.S,"Reflect",{get:function t(e,n){var s,u,h=arguments.length<3?e:arguments[2];return l(e)===h?e[n]:(s=i.f(e,n))?o(s,"value")?s.value:void 0!==s.get?s.get.call(h):void 0:a(u=r(e))?t(u,n,h):void 0}})},function(t,e,n){var i=n(21),r=n(0),o=n(4);r(r.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return i.f(o(t),e)}})},function(t,e,n){var i=n(0),r=n(38),o=n(4);i(i.S,"Reflect",{getPrototypeOf:function(t){return r(o(t))}})},function(t,e,n){var i=n(0);i(i.S,"Reflect",{has:function(t,e){return e in t}})},function(t,e,n){var i=n(0),r=n(4),o=Object.isExtensible;i(i.S,"Reflect",{isExtensible:function(t){return r(t),!o||o(t)}})},function(t,e,n){var i=n(0);i(i.S,"Reflect",{ownKeys:n(122)})},function(t,e,n){var i=n(0),r=n(4),o=Object.preventExtensions;i(i.S,"Reflect",{preventExtensions:function(t){r(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,e,n){var i=n(10),r=n(21),o=n(38),s=n(14),a=n(0),l=n(31),u=n(4),h=n(5);a(a.S,"Reflect",{set:function t(e,n,a){var c,f,d=arguments.length<4?e:arguments[3],p=r.f(u(e),n);if(!p){if(h(f=o(e)))return t(f,n,a,d);p=l(0)}if(s(p,"value")){if(!1===p.writable||!h(d))return!1;if(c=r.f(d,n)){if(c.get||c.set||!1===c.writable)return!1;c.value=a,i.f(d,n,c)}else i.f(d,n,l(0,a));return!0}return void 0!==p.set&&(p.set.call(d,a),!0)}})},function(t,e,n){var i=n(0),r=n(69);r&&i(i.S,"Reflect",{setPrototypeOf:function(t,e){r.check(t,e);try{return r.set(t,e),!0}catch(t){return!1}}})},function(t,e,n){n(274),t.exports=n(8).Array.includes},function(t,e,n){"use strict";var i=n(0),r=n(53)(!0);i(i.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(39)("includes")},function(t,e,n){n(276),t.exports=n(8).Array.flatMap},function(t,e,n){"use strict";var i=n(0),r=n(277),o=n(11),s=n(7),a=n(19),l=n(110);i(i.P,"Array",{flatMap:function(t){var e,n,i=o(this);return a(t),e=s(i.length),n=l(i,0),r(n,i,i,e,0,1,t,arguments[1]),n}}),n(39)("flatMap")},function(t,e,n){"use strict";var i=n(55),r=n(5),o=n(7),s=n(18),a=n(6)("isConcatSpreadable");t.exports=function t(e,n,l,u,h,c,f,d){for(var p,g,m=h,v=0,y=!!f&&s(f,d,3);v<u;){if(v in l){if(p=y?y(l[v],v,n):l[v],g=!1,r(p)&&(g=void 0!==(g=p[a])?!!g:i(p)),g&&c>0)m=t(e,n,p,o(p.length),m,c-1)-1;else{if(m>=9007199254740991)throw TypeError();e[m]=p}m++}v++}return m}},function(t,e,n){n(279),t.exports=n(8).String.padStart},function(t,e,n){"use strict";var i=n(0),r=n(123),o=n(61),s=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);i(i.P+i.F*s,"String",{padStart:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,e,n){n(281),t.exports=n(8).String.padEnd},function(t,e,n){"use strict";var i=n(0),r=n(123),o=n(61),s=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);i(i.P+i.F*s,"String",{padEnd:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,e,n){n(283),t.exports=n(8).String.trimLeft},function(t,e,n){"use strict";n(42)("trimLeft",(function(t){return function(){return t(this,1)}}),"trimStart")},function(t,e,n){n(285),t.exports=n(8).String.trimRight},function(t,e,n){"use strict";n(42)("trimRight",(function(t){return function(){return t(this,2)}}),"trimEnd")},function(t,e,n){n(287),t.exports=n(65).f("asyncIterator")},function(t,e,n){n(95)("asyncIterator")},function(t,e,n){n(289),t.exports=n(8).Object.getOwnPropertyDescriptors},function(t,e,n){var i=n(0),r=n(122),o=n(16),s=n(21),a=n(81);i(i.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,n,i=o(t),l=s.f,u=r(i),h={},c=0;u.length>c;)void 0!==(n=l(i,e=u[c++]))&&a(h,e,n);return h}})},function(t,e,n){n(291),t.exports=n(8).Object.values},function(t,e,n){var i=n(0),r=n(124)(!1);i(i.S,"Object",{values:function(t){return r(t)}})},function(t,e,n){n(293),t.exports=n(8).Object.entries},function(t,e,n){var i=n(0),r=n(124)(!0);i(i.S,"Object",{entries:function(t){return r(t)}})},function(t,e,n){"use strict";n(116),n(295),t.exports=n(8).Promise.finally},function(t,e,n){"use strict";var i=n(0),r=n(8),o=n(2),s=n(51),a=n(118);i(i.P+i.R,"Promise",{finally:function(t){var e=s(this,r.Promise||o.Promise),n="function"==typeof t;return this.then(n?function(n){return a(e,t()).then((function(){return n}))}:t,n?function(n){return a(e,t()).then((function(){throw n}))}:t)}})},function(t,e,n){n(297),n(298),n(299),t.exports=n(8)},function(t,e,n){var i=n(2),r=n(0),o=n(61),s=[].slice,a=/MSIE .\./.test(o),l=function(t){return function(e,n){var i=arguments.length>2,r=!!i&&s.call(arguments,2);return t(i?function(){("function"==typeof e?e:Function(e)).apply(this,r)}:e,n)}};r(r.G+r.B+r.F*a,{setTimeout:l(i.setTimeout),setInterval:l(i.setInterval)})},function(t,e,n){var i=n(0),r=n(87);i(i.G+i.B,{setImmediate:r.set,clearImmediate:r.clear})},function(t,e,n){for(var i=n(84),r=n(34),o=n(12),s=n(2),a=n(15),l=n(43),u=n(6),h=u("iterator"),c=u("toStringTag"),f=l.Array,d={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(d),g=0;g<p.length;g++){var m,v=p[g],y=d[v],b=s[v],_=b&&b.prototype;if(_&&(_[h]||a(_,h,f),_[c]||a(_,c,v),l[v]=f,y))for(m in i)_[m]||o(_,m,i[m],!0)}},function(t,e,n){var i=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function a(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(t){a=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var r=e&&e.prototype instanceof c?e:c,o=Object.create(r.prototype),s=new x(i||[]);return o._invoke=function(t,e,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return N()}for(n.method=r,n.arg=o;;){var s=n.delegate;if(s){var a=_(s,n);if(a){if(a===h)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,s),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var h={};function c(){}function f(){}function d(){}var p={};p[r]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==e&&n.call(m,r)&&(p=m);var v=d.prototype=c.prototype=Object.create(p);function y(t){["next","throw","return"].forEach((function(e){a(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var i;this._invoke=function(r,o){function s(){return new e((function(i,s){!function i(r,o,s,a){var l=u(t[r],t,o);if("throw"!==l.type){var h=l.arg,c=h.value;return c&&"object"==typeof c&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,s,a)}),(function(t){i("throw",t,s,a)})):e.resolve(c).then((function(t){h.value=t,s(h)}),(function(t){return i("throw",t,s,a)}))}a(l.arg)}(r,o,i,s)}))}return i=i?i.then(s,s):s()}}function _(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var i=u(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,h;var r=i.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function C(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:N}}function N(){return{value:void 0,done:!0}}return f.prototype=v.constructor=d,d.constructor=f,f.displayName=a(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,a(t,s,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(b.prototype),b.prototype[o]=function(){return this},t.AsyncIterator=b,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var s=new b(l(e,n,i,r),o);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},y(v),a(v,s,"Generator"),v[r]=function(){return this},v.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=C,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return s.type="throw",s.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),w(n),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;w(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}},function(t,e,n){n(302),t.exports=n(125).global},function(t,e,n){var i=n(303);i(i.G,{global:n(89)})},function(t,e,n){var i=n(89),r=n(125),o=n(304),s=n(306),a=n(313),l=function(t,e,n){var u,h,c,f=t&l.F,d=t&l.G,p=t&l.S,g=t&l.P,m=t&l.B,v=t&l.W,y=d?r:r[e]||(r[e]={}),b=y.prototype,_=d?i:p?i[e]:(i[e]||{}).prototype;for(u in d&&(n=e),n)(h=!f&&_&&void 0!==_[u])&&a(y,u)||(c=h?_[u]:n[u],y[u]=d&&"function"!=typeof _[u]?n[u]:m&&h?o(c,i):v&&_[u]==c?function(t){var e=function(e,n,i){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,i)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):g&&"function"==typeof c?o(Function.call,c):c,g&&((y.virtual||(y.virtual={}))[u]=c,t&l.R&&b&&!b[u]&&s(b,u,c)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e,n){var i=n(305);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var i=n(307),r=n(312);t.exports=n(91)?function(t,e,n){return i.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var i=n(308),r=n(309),o=n(311),s=Object.defineProperty;e.f=n(91)?Object.defineProperty:function(t,e,n){if(i(t),e=o(e,!0),i(n),r)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var i=n(90);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){t.exports=!n(91)&&!n(126)((function(){return 7!=Object.defineProperty(n(310)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){var i=n(90),r=n(89).document,o=i(r)&&i(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,n){var i=n(90);t.exports=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var l,u=[],h=!1,c=-1;function f(){h&&l&&(h=!1,l.length?u=l.concat(u):c=-1,u.length&&d())}function d(){if(!h){var t=a(f);h=!0;for(var e=u.length;e;){for(l=u,u=[];++c<e;)l&&l[c].run();c=-1,e=u.length}l=null,h=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||h||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t){t.exports=JSON.parse('{"inkVersion":19,"root":[[{"->":"title"},["done",{"#n":"g-0"}],null],"done",{"title":["^Usagi Kaiju (The Giant Rabbit Monster)","\\n","^By @redmountainman1","\\n","^Made for Text Only Jam 2 [8 Bits to Infinity]","\\n","^:br","\\n",{"->":"level1"},null],"level1":["^You small bunny.","\\n","^:music","\\n","^You are so cute!","\\n","^:br","\\n","^You will grow up strong for sure.","\\n","^With the right nourishment.","\\n","^:br","\\n","^They took you from the only home you knew.","\\n","^The place where you lived free.","\\n","^The grass was green and the water ran freely.","\\n","^:br","\\n","^They put you in this cage full of pellets and your own poop.","\\n","^What is a rabbit to do?","\\n","^:br","\\n","^You cannot talk, but you can eat.","\\n","^Eat your way to freedom.","\\n","^:br","\\n","^Use the arrow keys to move.","\\n","^Keep eating until you have enough food to get bigger and bust out of the cage.","\\n","^Avoid nap time.","\\n","^:br","\\n",{"->":"level1ready"},null],"level1ready":[["^Ready to play?","\\n","ev","str","^Let\'s do this","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^Stop this crappy music first","/str","/ev",{"*":".^.c-1","flg":20},"ev","str","^Wait, what?","/str","/ev",{"*":".^.c-2","flg":4},{"c-0":["^ ","\\n","^:level1","\\n","done",null],"c-1":["^ ","\\n","^Tough shit, kiddo.","\\n","^:br","\\n",{"->":".^.^.^"},{"#f":5}],"c-2":["^ ",{"->":"level1"},"\\n",null]}],null],"level2":["^You feel bigger, stronger.","\\n","^The cage door flies open as you roundhouse kick it.","\\n","^:br","\\n","^Finally, that cage was suffocating.","\\n","^Full of your own poop, pellets and a tiny water bottle.","\\n","^:br","\\n","^Just who do these people think you are?","\\n","^:br","\\n","^As you hop free from the cage, you hear a sound.","\\n","^The toddler.","\\n","^:br","\\n","^The little brat is around here somewhere.","\\n","^Always shaking your cage.","\\n","^Shoving carrots in your face.","\\n","^:br","\\n","^Screaming, taunting.","\\n","^It\'s too much for a bunny to handle.","\\n","^Little rabbits are not good pets for kids.","\\n","^:br","\\n","^But you aren\'t a small bunny anymore, are you?","\\n","^You\'re a site to behold.","\\n","^:br","\\n","^You must get bigger, and teach that toddler a lesson.","\\n","^:level2","\\n","done",null],"level3":["^You feel kicking in your belly as you devour the toddler in one big gulp.","\\n","^:br","\\n","^You can nap now.","\\n","^Your revenge is complete.","\\n","^:br","\\n","^But what\'s this? Your owners just came inside.","\\n","^:br","\\n","^They are looking at the mess.","\\n","^They are looking at you, the giant rabbit.","\\n","^:br","\\n","^They come for you with baseball bats.","\\n","^Better get bigger.","\\n","^:level3","\\n","done",null],"level4":["^You munch on your owners like frail leaves of romaine.","\\n","^I am impressed.","\\n","^:br","\\n","^You got your revenge.","\\n","^But what\'s next?","\\n","^:br","\\n","^The playground?","\\n","^The library?","\\n","^Town hall?","\\n","^:br","\\n","^No. Not this time.","\\n","^:br","\\n","^The world fades away, and you are back where you started.","\\n","^A small bunny.","\\n","^:br","\\n","^The cage\'s metal bars rattle as the toddler strikes.","\\n","^Over and over again he hits it.","\\n","^The sound terrifies you.","\\n","^:br","\\n","^The little water they left you with spills out of its bowl.","\\n","^:br","\\n","^There is no escape from these hells, but a small rabbit can dream.","\\n","^:br","\\n","^GAME OVER","\\n",{"->":"title"},null],"gameover":[["^You\'ve binkied out, and lay down for a long nap.","\\n","^You\'ll be as good as new in a few hours.","\\n","^:br","\\n","^ZzzzZZzzZZzz","\\n","^:br","\\n","^Ready to play again?","\\n","ev","str","^Let\'s do this","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^Stop this god forsaken music first","/str","/ev",{"*":".^.c-1","flg":20},{"c-0":["^ ","\\n","^:continue","\\n","done",null],"c-1":["^ ","\\n","^Tough shit, kiddo.","\\n","^:continue","\\n","done",{"#f":5}]}],null],"global decl":["ev",0,{"VAR=":"points"},1,{"VAR=":"size"},10,{"VAR=":"time"},10,{"VAR=":"size_cost"},10,{"VAR=":"time_cost"},"/ev","end",null]}],"listDefs":{}}')},function(t,e,n){(function(i){var r,o,s;!function(i){"use strict";function a(t,e){this.options={},t=t||this.options;var n={frequency:350,peak:1};for(var i in this.inputNode=this.filterNode=c.context.createBiquadFilter(),this.filterNode.type=e,this.outputNode=h.context.createGain(),this.filterNode.connect(this.outputNode),n)this[i]=t[i],this[i]=void 0===this[i]||null===this[i]?n[i]:this[i]}function l(){var t,e,n=c.context.sampleRate*this.time,i=h.context.createBuffer(2,n,c.context.sampleRate),r=i.getChannelData(0),o=i.getChannelData(1);for(e=0;n>e;e++)t=this.reverse?n-e:e,r[e]=(2*Math.random()-1)*Math.pow(1-t/n,this.decay),o[e]=(2*Math.random()-1)*Math.pow(1-t/n,this.decay);this.reverbNode.buffer&&(this.inputNode.disconnect(this.reverbNode),this.reverbNode.disconnect(this.wetGainNode),this.reverbNode=h.context.createConvolver(),this.inputNode.connect(this.reverbNode),this.reverbNode.connect(this.wetGainNode)),this.reverbNode.buffer=i}function u(t){for(var e=c.context.sampleRate,n=new Float32Array(e),i=Math.PI/180,r=0;e>r;r++){var o=2*r/e-1;n[r]=(3+t)*o*20*i/(Math.PI+t*Math.abs(o))}return n}var h={},c=h,f=t.exports,d=n(318);f?t.exports=h:d?(o=[],void 0===(s="function"==typeof(r=h)?r.apply(e,o):r)||(t.exports=s)):i.Pizzicato=i.Pz=h;var p=i.AudioContext||i.webkitAudioContext;if(p){h.context=new p;var g=h.context.createGain();g.connect(h.context.destination),h.Util={isString:function(t){return"[object String]"===toString.call(t)},isObject:function(t){return"[object Object]"===toString.call(t)},isFunction:function(t){return"[object Function]"===toString.call(t)},isNumber:function(t){return"[object Number]"===toString.call(t)&&t===+t},isArray:function(t){return"[object Array]"===toString.call(t)},isInRange:function(t,e,n){return!!(c.Util.isNumber(t)&&c.Util.isNumber(e)&&c.Util.isNumber(n))&&(t>=e&&n>=t)},isBool:function(t){return"boolean"==typeof t},isOscillator:function(t){return t&&"[object OscillatorNode]"===t.toString()},isAudioBufferSourceNode:function(t){return t&&"[object AudioBufferSourceNode]"===t.toString()},isSound:function(t){return t instanceof c.Sound},isEffect:function(t){for(var e in h.Effects)if(t instanceof h.Effects[e])return!0;return!1},normalize:function(t,e,n){return c.Util.isNumber(t)&&c.Util.isNumber(e)&&c.Util.isNumber(n)?(n-e)*t/1+e:void 0},getDryLevel:function(t){return!c.Util.isNumber(t)||t>1||0>t?0:.5>=t?1:1-2*(t-.5)},getWetLevel:function(t){return!c.Util.isNumber(t)||t>1||0>t?0:t>=.5?1:1-2*(.5-t)}};var m=h.context.createGain(),v=Object.getPrototypeOf(Object.getPrototypeOf(m)),y=v.connect;v.connect=function(t){var e=c.Util.isEffect(t)?t.inputNode:t;return y.call(this,e),t},Object.defineProperty(h,"volume",{enumerable:!0,get:function(){return g.gain.value},set:function(t){c.Util.isInRange(t,0,1)&&g&&(g.gain.value=t)}}),Object.defineProperty(h,"masterGainNode",{enumerable:!1,get:function(){return g},set:function(t){console.error("Can't set the master gain node")}}),h.Events={on:function(t,e,n){t&&e&&(this._events=this._events||{},(this._events[t]||(this._events[t]=[])).push({callback:e,context:n||this,handler:this}))},trigger:function(t){var e,n,i,r;if(t&&(this._events=this._events||{},e=this._events[t]||(this._events[t]=[]))){for(n=Math.max(0,arguments.length-1),i=[],r=0;n>r;r++)i[r]=arguments[r+1];for(r=0;r<e.length;r++)e[r].callback.apply(e[r].context,i)}},off:function(t){t?this._events[t]=void 0:this._events={}}},h.Sound=function(t,e){function n(t,e){t=t||{},this.getRawSourceNode=function(){var e=this.sourceNode?this.sourceNode.frequency.value:t.frequency,n=h.context.createOscillator();return n.type=t.type||"sine",n.frequency.value=e||440,n},this.sourceNode=this.getRawSourceNode(),this.sourceNode.gainSuccessor=c.context.createGain(),this.sourceNode.connect(this.sourceNode.gainSuccessor),s.isFunction(e)&&e()}function i(t,e){t=s.isArray(t)?t:[t];var n=new XMLHttpRequest;n.open("GET",t[0],!0),n.responseType="arraybuffer",n.onload=function(n){h.context.decodeAudioData(n.target.response,function(t){o.getRawSourceNode=function(){var e=h.context.createBufferSource();return e.loop=this.loop,e.buffer=t,e},s.isFunction(e)&&e()}.bind(o),function(n){return console.error("Error decoding audio file "+t[0]),t.length>1?(t.shift(),void i(t,e)):(n=n||new Error("Error decoding audio file "+t[0]),void(s.isFunction(e)&&e(n)))}.bind(o))},n.onreadystatechange=function(e){4===n.readyState&&200!==n.status&&console.error("Error while fetching "+t[0]+". "+n.statusText)},n.send()}function r(t,e){var n=s.isFunction(t)?t:t.audioFunction,i=s.isObject(t)&&t.bufferSize?t.bufferSize:null;if(!i)try{h.context.createScriptProcessor()}catch(t){i=2048}this.getRawSourceNode=function(){var t=h.context.createScriptProcessor(i,1,1);return t.onaudioprocess=n,t}}var o=this,s=h.Util,a=function(t){if(t&&!s.isFunction(t)&&!s.isString(t)&&!s.isObject(t))return"Description type not supported. Initialize a sound using an object, a function or a string.";if(s.isObject(t)){if(!s.isString(t.source)||-1===["wave","file","input","script","sound"].indexOf(t.source))return"Specified source not supported. Sources can be wave, file, input or script";if(!("file"!==t.source||t.options&&t.options.path))return"A path is needed for sounds with a file source";if(!("script"!==t.source||t.options&&t.options.audioFunction))return"An audio function is needed for sounds with a script source"}}(t),l=s.isObject(t)&&s.isObject(t.options);if(a)throw console.error(a),new Error("Error initializing Pizzicato Sound: "+a);this.detached=l&&t.options.detached,this.masterVolume=h.context.createGain(),this.fadeNode=h.context.createGain(),this.fadeNode.gain.value=0,this.detached||this.masterVolume.connect(h.masterGainNode),this.lastTimePlayed=0,this.effects=[],this.effectConnectors=[],this.playing=this.paused=!1,this.loop=l&&t.options.loop,this.attack=l&&s.isNumber(t.options.attack)?t.options.attack:.04,this.volume=l&&s.isNumber(t.options.volume)?t.options.volume:1,l&&s.isNumber(t.options.release)?this.release=t.options.release:l&&s.isNumber(t.options.sustain)?(console.warn("'sustain' is deprecated. Use 'release' instead."),this.release=t.options.sustain):this.release=.04,t?s.isString(t)?i.bind(this)(t,e):s.isFunction(t)?r.bind(this)(t,e):"file"===t.source?i.bind(this)(t.options.path,e):"wave"===t.source?n.bind(this)(t.options,e):"input"===t.source?function(t,e){if(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia||navigator.mediaDevices.getUserMedia){var n=function(t){o.getRawSourceNode=function(){return h.context.createMediaStreamSource(t)},s.isFunction(e)&&e()}.bind(o),i=function(t){s.isFunction(e)&&e(t)};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(n).catch(i):navigator.getUserMedia({audio:!0},n,i)}else console.error("Your browser does not support getUserMedia")}.bind(this)(t,e):"script"===t.source?r.bind(this)(t.options,e):"sound"===t.source&&function(t,e){this.getRawSourceNode=t.sound.getRawSourceNode,t.sound.sourceNode&&c.Util.isOscillator(t.sound.sourceNode)&&(this.sourceNode=this.getRawSourceNode(),this.frequency=t.sound.frequency)}.bind(this)(t.options,e):n.bind(this)({},e)},h.Sound.prototype=Object.create(h.Events,{play:{enumerable:!0,value:function(t,e){this.playing||(c.Util.isNumber(e)||(e=this.offsetTime||0),c.Util.isNumber(t)||(t=0),this.playing=!0,this.paused=!1,this.sourceNode=this.getSourceNode(),this.applyAttack(),c.Util.isFunction(this.sourceNode.start)&&(this.lastTimePlayed=h.context.currentTime-e,this.sourceNode.start(c.context.currentTime+t,e)),this.trigger("play"))}},stop:{enumerable:!0,value:function(){(this.paused||this.playing)&&(this.paused=this.playing=!1,this.stopWithRelease(),this.offsetTime=0,this.trigger("stop"))}},pause:{enumerable:!0,value:function(){if(!this.paused&&this.playing){this.paused=!0,this.playing=!1,this.stopWithRelease();var t=c.context.currentTime-this.lastTimePlayed;this.sourceNode.buffer?this.offsetTime=t%(this.sourceNode.buffer.length/c.context.sampleRate):this.offsetTime=t,this.trigger("pause")}}},clone:{enumerable:!0,value:function(){for(var t=new h.Sound({source:"sound",options:{loop:this.loop,attack:this.attack,release:this.release,volume:this.volume,sound:this}}),e=0;e<this.effects.length;e++)t.addEffect(this.effects[e]);return t}},onEnded:{enumerable:!0,value:function(t){return function(){this.sourceNode&&this.sourceNode!==t||(this.playing&&this.stop(),this.paused||this.trigger("end"))}}},addEffect:{enumerable:!0,value:function(t){if(!c.Util.isEffect(t))return console.error("The object provided is not a Pizzicato effect."),this;this.effects.push(t);var e=this.effectConnectors.length>0?this.effectConnectors[this.effectConnectors.length-1]:this.fadeNode;e.disconnect(),e.connect(t);var n=c.context.createGain();return this.effectConnectors.push(n),t.connect(n),n.connect(this.masterVolume),this}},removeEffect:{enumerable:!0,value:function(t){var e=this.effects.indexOf(t);if(-1===e)return console.warn("Cannot remove effect that is not applied to this sound."),this;var n=this.playing;n&&this.pause();var i=0===e?this.fadeNode:this.effectConnectors[e-1];i.disconnect();var r,o=this.effectConnectors[e];return o.disconnect(),t.disconnect(o),this.effectConnectors.splice(e,1),this.effects.splice(e,1),r=e>this.effects.length-1||0===this.effects.length?this.masterVolume:this.effects[e],i.connect(r),n&&this.play(),this}},connect:{enumerable:!0,value:function(t){return this.masterVolume.connect(t),this}},disconnect:{enumerable:!0,value:function(t){return this.masterVolume.disconnect(t),this}},connectEffects:{enumerable:!0,value:function(){for(var t=[],e=0;e<this.effects.length;e++){var n=e===this.effects.length-1?this.masterVolume:this.effects[e+1].inputNode;t[e]=c.context.createGain(),this.effects[e].outputNode.disconnect(this.effectConnectors[e]),this.effects[e].outputNode.connect(n)}}},volume:{enumerable:!0,get:function(){return this.masterVolume?this.masterVolume.gain.value:void 0},set:function(t){c.Util.isInRange(t,0,1)&&this.masterVolume&&(this.masterVolume.gain.value=t)}},frequency:{enumerable:!0,get:function(){return this.sourceNode&&c.Util.isOscillator(this.sourceNode)?this.sourceNode.frequency.value:null},set:function(t){this.sourceNode&&c.Util.isOscillator(this.sourceNode)&&(this.sourceNode.frequency.value=t)}},sustain:{enumerable:!0,get:function(){return console.warn("'sustain' is deprecated. Use 'release' instead."),this.release},set:function(t){console.warn("'sustain' is deprecated. Use 'release' instead."),c.Util.isInRange(t,0,10)&&(this.release=t)}},getSourceNode:{enumerable:!0,value:function(){if(this.sourceNode){var t=this.sourceNode;t.gainSuccessor.gain.setValueAtTime(t.gainSuccessor.gain.value,c.context.currentTime),t.gainSuccessor.gain.linearRampToValueAtTime(1e-4,c.context.currentTime+.2),setTimeout((function(){t.disconnect(),t.gainSuccessor.disconnect()}),200)}var e=this.getRawSourceNode();return e.gainSuccessor=c.context.createGain(),e.connect(e.gainSuccessor),e.gainSuccessor.connect(this.fadeNode),this.fadeNode.connect(this.getInputNode()),c.Util.isAudioBufferSourceNode(e)&&(e.onended=this.onEnded(e).bind(this)),e}},getInputNode:{enumerable:!0,value:function(){return this.effects.length>0?this.effects[0].inputNode:this.masterVolume}},applyAttack:{enumerable:!1,value:function(){if(this.fadeNode.gain.value,this.fadeNode.gain.cancelScheduledValues(c.context.currentTime),this.attack){var t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,e=this.attack;t||(e=(1-this.fadeNode.gain.value)*this.attack),this.fadeNode.gain.setTargetAtTime(1,c.context.currentTime,2*e)}else this.fadeNode.gain.setTargetAtTime(1,c.context.currentTime,.001)}},stopWithRelease:{enumerable:!1,value:function(t){var e=this.sourceNode,n=function(){return c.Util.isFunction(e.stop)?e.stop(0):e.disconnect()};if(this.fadeNode.gain.value,this.fadeNode.gain.cancelScheduledValues(c.context.currentTime),!this.release)return this.fadeNode.gain.setTargetAtTime(0,c.context.currentTime,.001),void n();var i=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,r=this.release;i||(r=this.fadeNode.gain.value*this.release),this.fadeNode.gain.setTargetAtTime(1e-5,c.context.currentTime,r/5),window.setTimeout((function(){n()}),1e3*r)}}}),h.Group=function(t){t=t||[],this.mergeGainNode=c.context.createGain(),this.masterVolume=c.context.createGain(),this.sounds=[],this.effects=[],this.effectConnectors=[],this.mergeGainNode.connect(this.masterVolume),this.masterVolume.connect(c.masterGainNode);for(var e=0;e<t.length;e++)this.addSound(t[e])},h.Group.prototype=Object.create(c.Events,{connect:{enumerable:!0,value:function(t){return this.masterVolume.connect(t),this}},disconnect:{enumerable:!0,value:function(t){return this.masterVolume.disconnect(t),this}},addSound:{enumerable:!0,value:function(t){return c.Util.isSound(t)?this.sounds.indexOf(t)>-1?void console.warn("The Pizzicato.Sound object was already added to this group"):t.detached?void console.warn("Groups do not support detached sounds. You can manually create an audio graph to group detached sounds together."):(t.disconnect(c.masterGainNode),t.connect(this.mergeGainNode),void this.sounds.push(t)):void console.error("You can only add Pizzicato.Sound objects")}},removeSound:{enumerable:!0,value:function(t){var e=this.sounds.indexOf(t);return-1===e?void console.warn("Cannot remove a sound that is not part of this group."):(t.disconnect(this.mergeGainNode),t.connect(c.masterGainNode),void this.sounds.splice(e,1))}},volume:{enumerable:!0,get:function(){return this.masterVolume?this.masterVolume.gain.value:void 0},set:function(t){c.Util.isInRange(t,0,1)&&(this.masterVolume.gain.value=t)}},play:{enumerable:!0,value:function(){for(var t=0;t<this.sounds.length;t++)this.sounds[t].play();this.trigger("play")}},stop:{enumerable:!0,value:function(){for(var t=0;t<this.sounds.length;t++)this.sounds[t].stop();this.trigger("stop")}},pause:{enumerable:!0,value:function(){for(var t=0;t<this.sounds.length;t++)this.sounds[t].pause();this.trigger("pause")}},addEffect:{enumerable:!0,value:function(t){if(!c.Util.isEffect(t))return console.error("The object provided is not a Pizzicato effect."),this;this.effects.push(t);var e=this.effectConnectors.length>0?this.effectConnectors[this.effectConnectors.length-1]:this.mergeGainNode;e.disconnect(),e.connect(t);var n=c.context.createGain();return this.effectConnectors.push(n),t.connect(n),n.connect(this.masterVolume),this}},removeEffect:{enumerable:!0,value:function(t){var e=this.effects.indexOf(t);if(-1===e)return console.warn("Cannot remove effect that is not applied to this group."),this;var n=0===e?this.mergeGainNode:this.effectConnectors[e-1];n.disconnect();var i,r=this.effectConnectors[e];return r.disconnect(),t.disconnect(r),this.effectConnectors.splice(e,1),this.effects.splice(e,1),i=e>this.effects.length-1||0===this.effects.length?this.masterVolume:this.effects[e],n.connect(i),this}}}),h.Effects={};var b=Object.create(null,{connect:{enumerable:!0,value:function(t){return this.outputNode.connect(t),this}},disconnect:{enumerable:!0,value:function(t){return this.outputNode.disconnect(t),this}}});h.Effects.Delay=function(t){this.options={},t=t||this.options;var e={feedback:.5,time:.3,mix:.5};for(var n in this.inputNode=h.context.createGain(),this.outputNode=h.context.createGain(),this.dryGainNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.feedbackGainNode=h.context.createGain(),this.delayNode=h.context.createDelay(),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.delayNode.connect(this.feedbackGainNode),this.feedbackGainNode.connect(this.delayNode),this.inputNode.connect(this.delayNode),this.delayNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.Delay.prototype=Object.create(b,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(t){c.Util.isInRange(t,0,180)&&(this.options.time=t,this.delayNode.delayTime.value=t)}},feedback:{enumerable:!0,get:function(){return this.options.feedback},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.feedback=parseFloat(t,10),this.feedbackGainNode.gain.value=this.feedback)}}}),h.Effects.Compressor=function(t){this.options={},t=t||this.options;var e={threshold:-24,knee:30,attack:.003,release:.25,ratio:12};for(var n in this.inputNode=this.compressorNode=h.context.createDynamicsCompressor(),this.outputNode=h.context.createGain(),this.compressorNode.connect(this.outputNode),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.Compressor.prototype=Object.create(b,{threshold:{enumerable:!0,get:function(){return this.compressorNode.threshold.value},set:function(t){h.Util.isInRange(t,-100,0)&&(this.compressorNode.threshold.value=t)}},knee:{enumerable:!0,get:function(){return this.compressorNode.knee.value},set:function(t){h.Util.isInRange(t,0,40)&&(this.compressorNode.knee.value=t)}},attack:{enumerable:!0,get:function(){return this.compressorNode.attack.value},set:function(t){h.Util.isInRange(t,0,1)&&(this.compressorNode.attack.value=t)}},release:{enumerable:!0,get:function(){return this.compressorNode.release.value},set:function(t){h.Util.isInRange(t,0,1)&&(this.compressorNode.release.value=t)}},ratio:{enumerable:!0,get:function(){return this.compressorNode.ratio.value},set:function(t){h.Util.isInRange(t,1,20)&&(this.compressorNode.ratio.value=t)}},getCurrentGainReduction:function(){return this.compressorNode.reduction}}),h.Effects.LowPassFilter=function(t){a.call(this,t,"lowpass")},h.Effects.HighPassFilter=function(t){a.call(this,t,"highpass")};var _=Object.create(b,{frequency:{enumerable:!0,get:function(){return this.filterNode.frequency.value},set:function(t){h.Util.isInRange(t,10,22050)&&(this.filterNode.frequency.value=t)}},peak:{enumerable:!0,get:function(){return this.filterNode.Q.value},set:function(t){h.Util.isInRange(t,1e-4,1e3)&&(this.filterNode.Q.value=t)}}});h.Effects.LowPassFilter.prototype=_,h.Effects.HighPassFilter.prototype=_,h.Effects.Distortion=function(t){this.options={},t=t||this.options;var e={gain:.5};for(var n in this.waveShaperNode=h.context.createWaveShaper(),this.inputNode=this.outputNode=this.waveShaperNode,e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.Distortion.prototype=Object.create(b,{gain:{enumerable:!0,get:function(){return this.options.gain},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.gain=t,this.adjustGain())}},adjustGain:{writable:!1,configurable:!1,enumerable:!1,value:function(){for(var t,e=c.Util.isNumber(this.options.gain)?parseInt(100*this.options.gain,10):50,n=44100,i=new Float32Array(n),r=Math.PI/180,o=0;n>o;++o)t=2*o/n-1,i[o]=(3+e)*t*20*r/(Math.PI+e*Math.abs(t));this.waveShaperNode.curve=i}}}),h.Effects.Flanger=function(t){this.options={},t=t||this.options;var e={time:.45,speed:.2,depth:.1,feedback:.1,mix:.5};for(var n in this.inputNode=h.context.createGain(),this.outputNode=h.context.createGain(),this.inputFeedbackNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.dryGainNode=h.context.createGain(),this.delayNode=h.context.createDelay(),this.oscillatorNode=h.context.createOscillator(),this.gainNode=h.context.createGain(),this.feedbackNode=h.context.createGain(),this.oscillatorNode.type="sine",this.inputNode.connect(this.inputFeedbackNode),this.inputNode.connect(this.dryGainNode),this.inputFeedbackNode.connect(this.delayNode),this.inputFeedbackNode.connect(this.wetGainNode),this.delayNode.connect(this.wetGainNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.inputFeedbackNode),this.oscillatorNode.connect(this.gainNode),this.gainNode.connect(this.delayNode.delayTime),this.dryGainNode.connect(this.outputNode),this.wetGainNode.connect(this.outputNode),this.oscillatorNode.start(0),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.Flanger.prototype=Object.create(b,{time:{enumberable:!0,get:function(){return this.options.time},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.time=t,this.delayNode.delayTime.value=c.Util.normalize(t,.001,.02))}},speed:{enumberable:!0,get:function(){return this.options.speed},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.speed=t,this.oscillatorNode.frequency.value=c.Util.normalize(t,.5,5))}},depth:{enumberable:!0,get:function(){return this.options.depth},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.depth=t,this.gainNode.gain.value=c.Util.normalize(t,5e-4,.005))}},feedback:{enumberable:!0,get:function(){return this.options.feedback},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.feedback=t,this.feedbackNode.gain.value=c.Util.normalize(t,0,.8))}},mix:{enumberable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}}}),h.Effects.StereoPanner=function(t){this.options={},t=t||this.options;var e={pan:0};for(var n in this.inputNode=h.context.createGain(),this.outputNode=h.context.createGain(),h.context.createStereoPanner?(this.pannerNode=h.context.createStereoPanner(),this.inputNode.connect(this.pannerNode),this.pannerNode.connect(this.outputNode)):h.context.createPanner?(console.warn("Your browser does not support the StereoPannerNode. Will use PannerNode instead."),this.pannerNode=h.context.createPanner(),this.pannerNode.type="equalpower",this.inputNode.connect(this.pannerNode),this.pannerNode.connect(this.outputNode)):(console.warn("Your browser does not support the Panner effect."),this.inputNode.connect(this.outputNode)),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.StereoPanner.prototype=Object.create(b,{pan:{enumerable:!0,get:function(){return this.options.pan},set:function(t){c.Util.isInRange(t,-1,1)&&(this.options.pan=t,this.pannerNode)&&(this.pannerNode.toString().indexOf("StereoPannerNode")>-1?this.pannerNode.pan.value=t:this.pannerNode.setPosition(t,0,1-Math.abs(t)))}}}),h.Effects.Convolver=function(t,e){this.options={},t=t||this.options;var n=this,i=new XMLHttpRequest,r={mix:.5};for(var o in this.callback=e,this.inputNode=h.context.createGain(),this.convolverNode=h.context.createConvolver(),this.outputNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.dryGainNode=h.context.createGain(),this.inputNode.connect(this.convolverNode),this.convolverNode.connect(this.wetGainNode),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.wetGainNode.connect(this.outputNode),r)this[o]=t[o],this[o]=void 0===this[o]||null===this[o]?r[o]:this[o];return t.impulse?(i.open("GET",t.impulse,!0),i.responseType="arraybuffer",i.onload=function(t){var e=t.target.response;h.context.decodeAudioData(e,(function(t){n.convolverNode.buffer=t,n.callback&&c.Util.isFunction(n.callback)&&n.callback()}),(function(t){t=t||new Error("Error decoding impulse file"),n.callback&&c.Util.isFunction(n.callback)&&n.callback(t)}))},i.onreadystatechange=function(e){4===i.readyState&&200!==i.status&&console.error("Error while fetching "+t.impulse+". "+i.statusText)},void i.send()):void console.error("No impulse file specified.")},h.Effects.Convolver.prototype=Object.create(b,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}}}),h.Effects.PingPongDelay=function(t){this.options={},t=t||this.options;var e={feedback:.5,time:.3,mix:.5};for(var n in this.inputNode=h.context.createGain(),this.outputNode=h.context.createGain(),this.delayNodeLeft=h.context.createDelay(),this.delayNodeRight=h.context.createDelay(),this.dryGainNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.feedbackGainNode=h.context.createGain(),this.channelMerger=h.context.createChannelMerger(2),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.delayNodeLeft.connect(this.channelMerger,0,0),this.delayNodeRight.connect(this.channelMerger,0,1),this.delayNodeLeft.connect(this.delayNodeRight),this.feedbackGainNode.connect(this.delayNodeLeft),this.delayNodeRight.connect(this.feedbackGainNode),this.inputNode.connect(this.feedbackGainNode),this.channelMerger.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.PingPongDelay.prototype=Object.create(b,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(t){c.Util.isInRange(t,0,180)&&(this.options.time=t,this.delayNodeLeft.delayTime.value=t,this.delayNodeRight.delayTime.value=t)}},feedback:{enumerable:!0,get:function(){return this.options.feedback},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.feedback=parseFloat(t,10),this.feedbackGainNode.gain.value=this.feedback)}}}),h.Effects.Reverb=function(t){this.options={},t=t||this.options;var e={mix:.5,time:.01,decay:.01,reverse:!1};for(var n in this.inputNode=h.context.createGain(),this.reverbNode=h.context.createConvolver(),this.outputNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.dryGainNode=h.context.createGain(),this.inputNode.connect(this.reverbNode),this.reverbNode.connect(this.wetGainNode),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.wetGainNode.connect(this.outputNode),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n];l.bind(this)()},h.Effects.Reverb.prototype=Object.create(b,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(t){c.Util.isInRange(t,1e-4,10)&&(this.options.time=t,l.bind(this)())}},decay:{enumerable:!0,get:function(){return this.options.decay},set:function(t){c.Util.isInRange(t,1e-4,10)&&(this.options.decay=t,l.bind(this)())}},reverse:{enumerable:!0,get:function(){return this.options.reverse},set:function(t){c.Util.isBool(t)&&(this.options.reverse=t,l.bind(this)())}}}),h.Effects.Tremolo=function(t){this.options={},t=t||this.options;var e={speed:4,depth:1,mix:.8};for(var n in this.inputNode=h.context.createGain(),this.outputNode=h.context.createGain(),this.dryGainNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.tremoloGainNode=h.context.createGain(),this.tremoloGainNode.gain.value=0,this.lfoNode=h.context.createOscillator(),this.shaperNode=h.context.createWaveShaper(),this.shaperNode.curve=new Float32Array([0,1]),this.shaperNode.connect(this.tremoloGainNode.gain),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.lfoNode.connect(this.shaperNode),this.lfoNode.type="sine",this.lfoNode.start(0),this.inputNode.connect(this.tremoloGainNode),this.tremoloGainNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.Tremolo.prototype=Object.create(b,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}},speed:{enumerable:!0,get:function(){return this.options.speed},set:function(t){c.Util.isInRange(t,0,20)&&(this.options.speed=t,this.lfoNode.frequency.value=t)}},depth:{enumerable:!0,get:function(){return this.options.depth},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.depth=t,this.shaperNode.curve=new Float32Array([1-t,1]))}}}),h.Effects.DubDelay=function(t){this.options={},t=t||this.options;var e={feedback:.6,time:.7,mix:.5,cutoff:700};for(var n in this.inputNode=h.context.createGain(),this.outputNode=h.context.createGain(),this.dryGainNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.feedbackGainNode=h.context.createGain(),this.delayNode=h.context.createDelay(),this.bqFilterNode=h.context.createBiquadFilter(),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.inputNode.connect(this.wetGainNode),this.inputNode.connect(this.feedbackGainNode),this.feedbackGainNode.connect(this.bqFilterNode),this.bqFilterNode.connect(this.delayNode),this.delayNode.connect(this.feedbackGainNode),this.delayNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]},h.Effects.DubDelay.prototype=Object.create(b,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}},time:{enumerable:!0,get:function(){return this.options.time},set:function(t){c.Util.isInRange(t,0,180)&&(this.options.time=t,this.delayNode.delayTime.value=t)}},feedback:{enumerable:!0,get:function(){return this.options.feedback},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.feedback=parseFloat(t,10),this.feedbackGainNode.gain.value=this.feedback)}},cutoff:{enumerable:!0,get:function(){return this.options.cutoff},set:function(t){c.Util.isInRange(t,0,4e3)&&(this.options.cutoff=t,this.bqFilterNode.frequency.value=this.cutoff)}}}),h.Effects.RingModulator=function(t){this.options={},t=t||this.options;var e={speed:30,distortion:1,mix:.5};for(var n in this.inputNode=h.context.createGain(),this.outputNode=h.context.createGain(),this.dryGainNode=h.context.createGain(),this.wetGainNode=h.context.createGain(),this.vIn=h.context.createOscillator(),this.vIn.start(0),this.vInGain=h.context.createGain(),this.vInGain.gain.value=.5,this.vInInverter1=h.context.createGain(),this.vInInverter1.gain.value=-1,this.vInInverter2=h.context.createGain(),this.vInInverter2.gain.value=-1,this.vInDiode1=new S(h.context),this.vInDiode2=new S(h.context),this.vInInverter3=h.context.createGain(),this.vInInverter3.gain.value=-1,this.vcInverter1=h.context.createGain(),this.vcInverter1.gain.value=-1,this.vcDiode3=new S(h.context),this.vcDiode4=new S(h.context),this.outGain=h.context.createGain(),this.outGain.gain.value=3,this.compressor=h.context.createDynamicsCompressor(),this.compressor.threshold.value=-24,this.compressor.ratio.value=16,this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode),this.inputNode.connect(this.vcInverter1),this.inputNode.connect(this.vcDiode4.node),this.vcInverter1.connect(this.vcDiode3.node),this.vIn.connect(this.vInGain),this.vInGain.connect(this.vInInverter1),this.vInGain.connect(this.vcInverter1),this.vInGain.connect(this.vcDiode4.node),this.vInInverter1.connect(this.vInInverter2),this.vInInverter1.connect(this.vInDiode2.node),this.vInInverter2.connect(this.vInDiode1.node),this.vInDiode1.connect(this.vInInverter3),this.vInDiode2.connect(this.vInInverter3),this.vInInverter3.connect(this.compressor),this.vcDiode3.connect(this.compressor),this.vcDiode4.connect(this.compressor),this.compressor.connect(this.outGain),this.outGain.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),e)this[n]=t[n],this[n]=void 0===this[n]||null===this[n]?e[n]:this[n]};var S=function(t){this.context=t,this.node=this.context.createWaveShaper(),this.vb=.2,this.vl=.4,this.h=1,this.setCurve()};return S.prototype.setDistortion=function(t){return this.h=t,this.setCurve()},S.prototype.setCurve=function(){var t,e,n,i,r,o,s;for(e=1024,t=o=0,s=(r=new Float32Array(e)).length;s>=0?s>o:o>s;t=s>=0?++o:--o)n=(t-512)/512,i=(n=Math.abs(n))<=this.vb?0:this.vb<n&&n<=this.vl?this.h*(Math.pow(n-this.vb,2)/(2*this.vl-2*this.vb)):this.h*n-this.h*this.vl+this.h*(Math.pow(this.vl-this.vb,2)/(2*this.vl-2*this.vb)),r[t]=i;return this.node.curve=r},S.prototype.connect=function(t){return this.node.connect(t)},h.Effects.RingModulator.prototype=Object.create(b,{mix:{enumerable:!0,get:function(){return this.options.mix},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.mix=t,this.dryGainNode.gain.value=h.Util.getDryLevel(this.mix),this.wetGainNode.gain.value=h.Util.getWetLevel(this.mix))}},speed:{enumerable:!0,get:function(){return this.options.speed},set:function(t){c.Util.isInRange(t,0,2e3)&&(this.options.speed=t,this.vIn.frequency.value=t)}},distortion:{enumerable:!0,get:function(){return this.options.distortion},set:function(t){if(c.Util.isInRange(t,.2,50)){this.options.distortion=parseFloat(t,10);for(var e=[this.vInDiode1,this.vInDiode2,this.vcDiode3,this.vcDiode4],n=0,i=e.length;i>n;n++)e[n].setDistortion(t)}}}}),h.Effects.Quadrafuzz=function(t){this.options={},t=t||this.options;var e={lowGain:.6,midLowGain:.8,midHighGain:.5,highGain:.6};this.inputNode=c.context.createGain(),this.outputNode=c.context.createGain(),this.dryGainNode=c.context.createGain(),this.wetGainNode=c.context.createGain(),this.lowpassLeft=c.context.createBiquadFilter(),this.lowpassLeft.type="lowpass",this.lowpassLeft.frequency.value=147,this.lowpassLeft.Q.value=.7071,this.bandpass1Left=c.context.createBiquadFilter(),this.bandpass1Left.type="bandpass",this.bandpass1Left.frequency.value=587,this.bandpass1Left.Q.value=.7071,this.bandpass2Left=c.context.createBiquadFilter(),this.bandpass2Left.type="bandpass",this.bandpass2Left.frequency.value=2490,this.bandpass2Left.Q.value=.7071,this.highpassLeft=c.context.createBiquadFilter(),this.highpassLeft.type="highpass",this.highpassLeft.frequency.value=4980,this.highpassLeft.Q.value=.7071,this.overdrives=[];for(var n=0;4>n;n++)this.overdrives[n]=c.context.createWaveShaper(),this.overdrives[n].curve=u();this.inputNode.connect(this.wetGainNode),this.inputNode.connect(this.dryGainNode),this.dryGainNode.connect(this.outputNode);var i=[this.lowpassLeft,this.bandpass1Left,this.bandpass2Left,this.highpassLeft];for(n=0;n<i.length;n++)this.wetGainNode.connect(i[n]),i[n].connect(this.overdrives[n]),this.overdrives[n].connect(this.outputNode);for(var r in e)this[r]=t[r],this[r]=void 0===this[r]||null===this[r]?e[r]:this[r]},h.Effects.Quadrafuzz.prototype=Object.create(b,{lowGain:{enumerable:!0,get:function(){return this.options.lowGain},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.lowGain=t,this.overdrives[0].curve=u(c.Util.normalize(this.lowGain,0,150)))}},midLowGain:{enumerable:!0,get:function(){return this.options.midLowGain},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.midLowGain=t,this.overdrives[1].curve=u(c.Util.normalize(this.midLowGain,0,150)))}},midHighGain:{enumerable:!0,get:function(){return this.options.midHighGain},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.midHighGain=t,this.overdrives[2].curve=u(c.Util.normalize(this.midHighGain,0,150)))}},highGain:{enumerable:!0,get:function(){return this.options.highGain},set:function(t){c.Util.isInRange(t,0,1)&&(this.options.highGain=t,this.overdrives[3].curve=u(c.Util.normalize(this.highGain,0,150)))}}}),h}console.error("No AudioContext found in this environment. Please ensure your window or global object contains a working AudioContext constructor function.")}("undefined"!=typeof window?window:i)}).call(this,n(317))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"TYPE_TEXT",(function(){return _})),n.d(i,"TYPE_NEWLINE",(function(){return S})),n.d(i,"TYPE_FG",(function(){return w})),n.d(i,"TYPE_BG",(function(){return x})),n.d(i,"measure",(function(){return C})),n.d(i,"tokenize",(function(){return N}));var r=n(1),o=n(47);class s extends o.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?t.fontStyle+" ":""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let n=this._ctx.canvas,i=n.getBoundingClientRect();return t-=i.left,e-=i.top,t*=n.width/i.width,e*=n.height/i.height,t<0||e<0||t>=n.width||e>=n.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var a=n(24);class l extends s{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[n,i,r,o,s]=t,a=[(n+1)*this._spacingX,i*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._ctx.fillStyle=s,this._fill(a[0],a[1])),!r)return;this._ctx.fillStyle=o;let l=[].concat(r);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],a[0],Math.ceil(a[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let n=2*t/((this._options.width+1)*Math.sqrt(3))-1,i=e/(2+1.5*(this._options.height-1)),r=Math.min(n,i),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let a=s/100;r=Math.floor(r)+1;let l=2*r/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(l)-1}_normalizedEventToPosition(t,e){let n;this._options.transpose?(t+=e,t-=e=t-e,n=this._ctx.canvas.width):n=this._ctx.canvas.height;let i=n/this._options.height;return e=Math.floor(e/i),Object(a.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let n=this._hexSize,i=this._options.border;const r=this._ctx;r.beginPath(),this._options.transpose?(r.moveTo(t-n+i,e),r.lineTo(t-n/2+i,e+this._spacingX-i),r.lineTo(t+n/2-i,e+this._spacingX-i),r.lineTo(t+n-i,e),r.lineTo(t+n/2-i,e-this._spacingX+i),r.lineTo(t-n/2+i,e-this._spacingX+i),r.lineTo(t-n+i,e)):(r.moveTo(t,e-n+i),r.lineTo(t+this._spacingX-i,e-n/2+i),r.lineTo(t+this._spacingX-i,e+n/2-i),r.lineTo(t,e+n-i),r.lineTo(t-this._spacingX+i,e+n/2-i),r.lineTo(t-this._spacingX+i,e-n/2+i),r.lineTo(t,e-n+i)),r.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let n,i;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(n="height",i="width"):(n="width",i="height"),this._ctx.canvas[n]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[i]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}var u=(()=>{class t extends s{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(e,n){t.cache?this._drawWithCache(e):this._drawNoCache(e,n)}_drawWithCache(t){let e,[n,i,r,o,s]=t,a=""+r+o+s;if(a in this._canvasCache)e=this._canvasCache[a];else{let t=this._options.border;e=document.createElement("canvas");let n=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,n.fillStyle=s,n.fillRect(t,t,e.width-t,e.height-t),r){n.fillStyle=o,n.font=this._ctx.font,n.textAlign="center",n.textBaseline="middle";let t=[].concat(r);for(let e=0;e<t.length;e++)n.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=e}this._ctx.drawImage(e,n*this._spacingX,i*this._spacingY)}_drawNoCache(t,e){let[n,i,r,o,s]=t;if(e){let t=this._options.border;this._ctx.fillStyle=s,this._ctx.fillRect(n*this._spacingX+t,i*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!r)return;this._ctx.fillStyle=o;let a=[].concat(r);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],(n+.5)*this._spacingX,Math.ceil((i+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let n=Math.floor(t/this._options.width),i=Math.floor(e/this._options.height),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let s=o/100*i/n;return s>1&&(i=Math.floor(i/s)),Math.floor(i/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return t.cache=!1,t})();class h extends s{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[n,i,r,o,s]=t,a=this._options.tileWidth,l=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(n*a,i*l,a,l):(this._ctx.fillStyle=s,this._ctx.fillRect(n*a,i*l,a,l))),!r)return;let u=[].concat(r),h=[].concat(o),c=[].concat(s);for(let t=0;t<u.length;t++){let e=this._options.tileMap[u[t]];if(!e)throw new Error(`Char "${u[t]}" not found in tileMap`);if(this._options.tileColorize){let r=this._colorCanvas,o=r.getContext("2d");o.globalCompositeOperation="source-over",o.clearRect(0,0,a,l);let s=h[t],u=c[t];o.drawImage(this._options.tileSet,e[0],e[1],a,l,0,0,a,l),"transparent"!=s&&(o.fillStyle=s,o.globalCompositeOperation="source-atop",o.fillRect(0,0,a,l)),"transparent"!=u&&(o.fillStyle=u,o.globalCompositeOperation="destination-over",o.fillRect(0,0,a,l)),this._ctx.drawImage(r,n*a,i*l,a,l)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],a,l,n*a,i*l,a,l)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var c=n(28);class f extends o.a{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",()=>this._updateTexture(e)):this._updateTexture(e)}draw(t,e){const n=this._gl,i=this._options;let[r,o,s,a,l]=t,u=n.canvas.height-(o+1)*i.tileHeight;if(n.scissor(r*i.tileWidth,u,i.tileWidth,i.tileHeight),e&&(i.tileColorize?n.clearColor(0,0,0,0):n.clearColor(...v(l)),n.clear(n.COLOR_BUFFER_BIT)),!s)return;let h=[].concat(s),c=[].concat(l),f=[].concat(a);n.uniform2fv(this._uniforms.targetPosRel,[r,o]);for(let t=0;t<h.length;t++){let e=this._options.tileMap[h[t]];if(!e)throw new Error(`Char "${h[t]}" not found in tileMap`);n.uniform1f(this._uniforms.colorize,i.tileColorize?1:0),n.uniform2fv(this._uniforms.tilesetPosAbs,e),i.tileColorize&&(n.uniform4fv(this._uniforms.tint,v(f[t])),n.uniform4fv(this._uniforms.bg,v(c[t]))),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...v(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let n=this._gl.canvas,i=n.getBoundingClientRect();return t-=i.left,e-=i.top,t*=n.width/i.width,e*=n.height/i.height,t<0||e<0||t>=n.width||e>=n.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,n){const i=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(i)||"");const r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"");const o=t.createProgram();if(t.attachShader(o,i),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(o)||"");return o}(t,p,g);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),d.forEach(n=>this._uniforms[n]=t.getUniformLocation(e,n)),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,n=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=n[0],t.canvas.height=n[1],t.viewport(0,0,n[0],n[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,n)}_updateTexture(t){!function(t,e){let n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const d=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],p="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),g="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let m={};function v(t){if(!(t in m)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=c.fromString(t).map(t=>t/255),e.push(1);m[t]=e}return m[t]}var y=n(93);const b=/%([bc]){([^}]*)}/g,_=0,S=1,w=2,x=3;function C(t,e){let n={width:0,height:1},i=N(t,e),r=0;for(let t=0;t<i.length;t++){let e=i[t];switch(e.type){case _:r+=e.value.length;break;case S:n.height++,n.width=Math.max(n.width,r),r=0}}return n.width=Math.max(n.width,r),n}function N(t,e){let n=[],i=0;t.replace(b,(function(e,r,o,s){let a=t.substring(i,s);return a.length&&n.push({type:_,value:a}),n.push({type:"c"==r?w:x,value:o.trim()}),i=s+e.length,""}));let r=t.substring(i);return r.length&&n.push({type:_,value:r}),function(t,e){e||(e=1/0);let n=0,i=0,r=-1;for(;n<t.length;){let o=t[n];if(o.type==S&&(i=0,r=-1),o.type!=_){n++;continue}for(;0==i&&" "==o.value.charAt(0);)o.value=o.value.substring(1);let s=o.value.indexOf("\n");if(-1!=s){o.value=T(t,n,s,!0);let e=o.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();o.value=e.join("")}if(o.value.length){if(i+o.value.length>e){let s=-1;for(;;){let t=o.value.indexOf(" ",s+1);if(-1==t)break;if(i+t>e)break;s=t}if(-1!=s)o.value=T(t,n,s,!0);else if(-1!=r){let e=t[r],i=e.value.lastIndexOf(" ");e.value=T(t,r,i,!0),n=r}else o.value=T(t,n,e-i,!1)}else i+=o.value.length,-1!=o.value.indexOf(" ")&&(r=n);n++}else t.splice(n,1)}t.push({type:S});let o=null;for(let e=0;e<t.length;e++){let n=t[e];switch(n.type){case _:o=n;break;case S:if(o){let t=o.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();o.value=t.join("")}o=null}}return t.pop(),t}(n,e)}function T(t,e,n,i){let r={type:S},o={type:_,value:t[e].value.substring(n+(i?1:0))};return t.splice(e+1,0,r,o),t[e].value.substring(0,n)}const k={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},E={hex:l,rect:u,tile:h,"tile-gl":f,term:y.a},P={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};var O=(()=>{class t{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},P,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,n){let i=[this._options.bg,this._options.fg];this.draw(t,e,null,null,i[n%i.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=E[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,n;return"touches"in t?(e=t.touches[0].clientX,n=t.touches[0].clientY):(e=t.clientX,n=t.clientY),this._backend.eventToPosition(e,n)}draw(t,e,n,i,r){i||(i=this._options.fg),r||(r=this._options.bg);let o=`${t},${e}`;this._data[o]=[t,e,n,i,r],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)}drawText(t,e,n,i){let r=null,o=null,s=t,a=e,l=1;i||(i=this._options.width-t);let u=N(n,i);for(;u.length;){let e=u.shift();switch(e.type){case _:let n=!1,i=!1,u=!1,h=!1;for(let t=0;t<e.value.length;t++){let l=e.value.charCodeAt(t),c=e.value.charAt(t);if("term"===this._options.layout){let t=l>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||l>=43360&&l<=43391){this.draw(s+0,a,c,r,o),this.draw(s+1,a,"\t",r,o),s+=2;continue}}u=l>65280&&l<65377||l>65500&&l<65512||l>65518,n=32==c.charCodeAt(0)||12288==c.charCodeAt(0),!h||u||n||s++,u&&!i&&s++,this.draw(s++,a,c,r,o),i=n,h=u}break;case w:r=e.value||null;break;case x:o=e.value||null;break;case S:s=t,a++,l++}}return l}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let n=this._data[t];n[4]!=this._options.bg&&(e=!0),this._backend.draw(n,e)}}return t.Rect=u,t.Hex=l,t.Tile=h,t.TileGL=f,t.Term=y.a,t})();class I{constructor(t,e={}){this._lightPasses=t,this._options=Object.assign({topology:8},e)}_getCircle(t,e,n){let i,r,o,s=[];switch(this._options.topology){case 4:r=1,o=[0,1],i=[k[8][7],k[8][1],k[8][3],k[8][5]];break;case 6:i=k[6],r=1,o=[-1,1];break;case 8:i=k[4],r=2,o=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let a=t+o[0]*n,l=e+o[1]*n;for(let t=0;t<i.length;t++)for(let e=0;e<n*r;e++)s.push([a,l]),a+=i[t][0],l+=i[t][1];return s}}const A=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];var F={DiscreteShadowcasting:class extends I{compute(t,e,n,i){if(i(t,e,0,1),!this._lightPasses(t,e))return;let r,o,s,a,l,u=[];for(let h=1;h<=n;h++){let n=this._getCircle(t,e,h),c=360/n.length;for(let t=0;t<n.length;t++)if(s=n[t][0],a=n[t][1],r=c*(t-.5),o=r+c,l=!this._lightPasses(s,a),this._visibleCoords(Math.floor(r),Math.ceil(o),l,u)&&i(s,a,h,1),2==u.length&&0==u[0]&&360==u[1])return}}_visibleCoords(t,e,n,i){if(t<0){let r=this._visibleCoords(0,e,n,i),o=this._visibleCoords(360+t,360,n,i);return r||o}let r=0;for(;r<i.length&&i[r]<t;)r++;if(r==i.length)return n&&i.push(t,e),!0;let o=0;if(r%2){for(;r<i.length&&i[r]<e;)r++,o++;return 0!=o&&(n&&(o%2?i.splice(r-o,o,e):i.splice(r-o,o)),!0)}for(;r<i.length&&i[r]<e;)r++,o++;return(t!=i[r-o]||1!=o)&&(n&&(o%2?i.splice(r-o,o,t):i.splice(r-o,o,t,e)),!0)}},PreciseShadowcasting:class extends I{compute(t,e,n,i){if(i(t,e,0,1),!this._lightPasses(t,e))return;let r,o,s,a,l,u,h=[];for(let c=1;c<=n;c++){let n=this._getCircle(t,e,c),f=n.length;for(let t=0;t<f;t++)if(r=n[t][0],o=n[t][1],a=[t?2*t-1:2*f-1,2*f],l=[2*t+1,2*f],s=!this._lightPasses(r,o),u=this._checkVisibility(a,l,s,h),u&&i(r,o,c,u),2==h.length&&0==h[0][0]&&h[1][0]==h[1][1])return}}_checkVisibility(t,e,n,i){if(t[0]>e[0]){return(this._checkVisibility(t,[t[1],t[1]],n,i)+this._checkVisibility([0,1],e,n,i))/2}let r=0,o=!1;for(;r<i.length;){let e=i[r],n=e[0]*t[1]-t[0]*e[1];if(n>=0){0!=n||r%2||(o=!0);break}r++}let s=i.length,a=!1;for(;s--;){let t=i[s],n=e[0]*t[1]-t[0]*e[1];if(n>=0){0==n&&s%2&&(a=!0);break}}let l,u=!0;if((r==s&&(o||a)||o&&a&&r+1==s&&s%2||r>s&&r%2)&&(u=!1),!u)return 0;let h=s-r+1;if(h%2)if(r%2){let t=i[r];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),n&&i.splice(r,h,e)}else{let e=i[s];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),n&&i.splice(r,h,t)}else{if(!(r%2))return n&&i.splice(r,h,t,e),1;{let t=i[r],e=i[s];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),n&&i.splice(r,h)}}return l/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))}},RecursiveShadowcasting:class extends I{compute(t,e,n,i){i(t,e,0,1);for(let r=0;r<A.length;r++)this._renderOctant(t,e,A[r],n,i)}compute180(t,e,n,i,r){r(t,e,0,1);let o=(i-1+8)%8,s=(i-2+8)%8,a=(i+1+8)%8;this._renderOctant(t,e,A[s],n,r),this._renderOctant(t,e,A[o],n,r),this._renderOctant(t,e,A[i],n,r),this._renderOctant(t,e,A[a],n,r)}compute90(t,e,n,i,r){r(t,e,0,1);let o=(i-1+8)%8;this._renderOctant(t,e,A[i],n,r),this._renderOctant(t,e,A[o],n,r)}_renderOctant(t,e,n,i,r){this._castVisibility(t,e,1,1,0,i+1,n[0],n[1],n[2],n[3],r)}_castVisibility(t,e,n,i,r,o,s,a,l,u,h){if(!(i<r))for(let c=n;c<=o;c++){let n=-c-1,f=-c,d=!1,p=0;for(;n<=0;){n+=1;let g=t+n*s+f*a,m=e+n*l+f*u,v=(n-.5)/(f+.5),y=(n+.5)/(f-.5);if(!(y>i)){if(v<r)break;if(n*n+f*f<o*o&&h(g,m,c,1),d){if(!this._lightPasses(g,m)){p=y;continue}d=!1,i=p}else!this._lightPasses(g,m)&&c<o&&(d=!0,this._castVisibility(t,e,c+1,i,v,o,s,a,l,u,h),p=y)}}if(d)break}}}};class W{constructor(t=80,e=25){this._width=t,this._height=e}_fillMap(t){let e=[];for(let n=0;n<this._width;n++){e.push([]);for(let i=0;i<this._height;i++)e[n].push(t)}return e}}class M extends W{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class R{}class L extends R{constructor(t,e,n,i,r,o){super(),this._x1=t,this._y1=e,this._x2=n,this._y2=i,this._doors={},void 0!==r&&void 0!==o&&this.addDoor(r,o)}static createRandomAt(t,e,n,i,o){let s=o.roomWidth[0],a=o.roomWidth[1],l=r.a.getUniformInt(s,a);s=o.roomHeight[0],a=o.roomHeight[1];let u=r.a.getUniformInt(s,a);if(1==n){let n=e-Math.floor(r.a.getUniform()*u);return new this(t+1,n,t+l,n+u-1,t,e)}if(-1==n){let n=e-Math.floor(r.a.getUniform()*u);return new this(t-l,n,t-1,n+u-1,t,e)}if(1==i){let n=t-Math.floor(r.a.getUniform()*l);return new this(n,e+1,n+l-1,e+u,t,e)}if(-1==i){let n=t-Math.floor(r.a.getUniform()*l);return new this(n,e-u,n+l-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,n){let i=n.roomWidth[0],o=n.roomWidth[1],s=r.a.getUniformInt(i,o);i=n.roomHeight[0],o=n.roomHeight[1];let a=r.a.getUniformInt(i,o),l=t-Math.floor(r.a.getUniform()*s),u=e-Math.floor(r.a.getUniform()*a);return new this(l,u,l+s-1,u+a-1)}static createRandom(t,e,n){let i=n.roomWidth[0],o=n.roomWidth[1],s=r.a.getUniformInt(i,o);i=n.roomHeight[0],o=n.roomHeight[1];let a=r.a.getUniformInt(i,o),l=t-s-1,u=e-a-1,h=1+Math.floor(r.a.getUniform()*l),c=1+Math.floor(r.a.getUniform()*u);return new this(h,c,h+s-1,c+a-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let n=e.split(",");t(parseInt(n[0]),parseInt(n[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,n=this._x2+1,i=this._y1-1,r=this._y2+1;for(let o=e;o<=n;o++)for(let s=i;s<=r;s++)o!=e&&o!=n&&s!=i&&s!=r||t(o,s)||this.addDoor(o,s);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let n=this._x1-1,i=this._x2+1,r=this._y1-1,o=this._y2+1;for(let s=n;s<=i;s++)for(let a=r;a<=o;a++)if(s==n||s==i||a==r||a==o){if(!t(s,a))return!1}else if(!e(s,a))return!1;return!0}create(t){let e=this._x1-1,n=this._x2+1,i=this._y1-1,r=this._y2+1,o=0;for(let s=e;s<=n;s++)for(let a=i;a<=r;a++)o=s+","+a in this._doors?2:s==e||s==n||a==i||a==r?1:0,t(s,a,o)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class j extends R{constructor(t,e,n,i){super(),this._startX=t,this._startY=e,this._endX=n,this._endY=i,this._endsWithAWall=!0}static createRandomAt(t,e,n,i,o){let s=o.corridorLength[0],a=o.corridorLength[1],l=r.a.getUniformInt(s,a);return new this(t,e,t+n*l,e+i*l)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let n=this._startX,i=this._startY,r=this._endX-n,o=this._endY-i,s=1+Math.max(Math.abs(r),Math.abs(o));r&&(r/=Math.abs(r)),o&&(o/=Math.abs(o));let a=o,l=-r,u=!0;for(let h=0;h<s;h++){let c=n+h*r,f=i+h*o;if(e(c,f)||(u=!1),t(c+a,f+l)||(u=!1),t(c-a,f-l)||(u=!1),!u){s=h,this._endX=c-r,this._endY=f-o;break}}if(0==s)return!1;if(1==s&&t(this._endX+r,this._endY+o))return!1;let h=!t(this._endX+r+a,this._endY+o+l),c=!t(this._endX+r-a,this._endY+o-l);return this._endsWithAWall=t(this._endX+r,this._endY+o),!h&&!c||!this._endsWithAWall}create(t){let e=this._startX,n=this._startY,i=this._endX-e,r=this._endY-n,o=1+Math.max(Math.abs(i),Math.abs(r));i&&(i/=Math.abs(i)),r&&(r/=Math.abs(r));for(let s=0;s<o;s++){t(e+s*i,n+s*r,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,n=this._startY,i=this._endX-e,r=this._endY-n;i&&(i/=Math.abs(i)),r&&(r/=Math.abs(r));let o=r,s=-i;t(this._endX+i,this._endY+r),t(this._endX+o,this._endY+s),t(this._endX-o,this._endY-s)}}const G={room:L,corridor:j};function V(t,e,n){n[e[t+1]]=n[t],e[n[t]]=e[t+1],n[t]=t+1,e[t+1]=t}function D(t,e,n){n[e[t]]=n[t],e[n[t]]=e[t],n[t]=t,e[t]=t}var U={Arena:class extends W{create(t){let e=this._width-1,n=this._height-1;for(let i=0;i<=e;i++)for(let r=0;r<=n;r++){t(i,r,i&&r&&i<e&&r<n?0:1)}return this}},Uniform:class extends M{constructor(t,e,n){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,n),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this._map[e][n]);return this}_generateRooms(){let t,e=this._width-2,n=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*n)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=L.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=r.a.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=r.a.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let n=this._closestRoom(this._connected,e);if(!n)break;if(!this._connectRooms(e,n))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let n=1/0,i=e.getCenter(),r=null;for(let e=0;e<t.length;e++){let o=t[e],s=o.getCenter(),a=s[0]-i[0],l=s[1]-i[1],u=a*a+l*l;u<n&&(n=u,r=o)}return r}_connectRooms(t,e){let n,i,r,o,s,a,l,u=t.getCenter(),h=e.getCenter(),c=h[0]-u[0],f=h[1]-u[1];if(Math.abs(c)<Math.abs(f)?(r=f>0?2:0,o=(r+2)%4,s=e.getLeft(),a=e.getRight(),l=0):(r=c>0?1:3,o=(r+2)%4,s=e.getTop(),a=e.getBottom(),l=1),n=this._placeInWall(t,r),!n)return!1;if(n[l]>=s&&n[l]<=a){i=n.slice();let t=0;switch(o){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}i[(l+1)%2]=t,this._digLine([n,i])}else if(n[l]<s-1||n[l]>a+1){let t=n[l]-h[l],r=0;switch(o){case 0:case 1:r=t<0?3:1;break;case 2:case 3:r=t<0?1:3}if(o=(o+r)%4,i=this._placeInWall(e,o),!i)return!1;let s=[0,0];s[l]=n[l];let a=(l+1)%2;s[a]=i[a],this._digLine([n,s,i])}else{let t=(l+1)%2;if(i=this._placeInWall(e,o),!i)return!1;let r=Math.round((i[t]+n[t])/2),s=[0,0],a=[0,0];s[l]=n[l],s[t]=r,a[l]=i[l],a[t]=r,this._digLine([n,s,a,i])}return t.addDoor(n[0],n[1]),e.addDoor(i[0],i[1]),l=this._unconnected.indexOf(t),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(t)),l=this._unconnected.indexOf(e),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(e)),!0}_placeInWall(t,e){let n=[0,0],i=[0,0],o=0;switch(e){case 0:i=[1,0],n=[t.getLeft(),t.getTop()-1],o=t.getRight()-t.getLeft()+1;break;case 1:i=[0,1],n=[t.getRight()+1,t.getTop()],o=t.getBottom()-t.getTop()+1;break;case 2:i=[1,0],n=[t.getLeft(),t.getBottom()+1],o=t.getRight()-t.getLeft()+1;break;case 3:i=[0,1],n=[t.getLeft()-1,t.getTop()],o=t.getBottom()-t.getTop()+1}let s=[],a=-2;for(let t=0;t<o;t++){let e=n[0]+t*i[0],r=n[1]+t*i[1];s.push(null),1==this._map[e][r]?a!=t-1&&(s[t]=[e,r]):(a=t,t&&(s[t-1]=null))}for(let t=s.length-1;t>=0;t--)s[t]||s.splice(t,1);return s.length?r.a.getItem(s):null}_digLine(t){for(let e=1;e<t.length;e++){let n=t[e-1],i=t[e],r=new j(n[0],n[1],i[0],i[1]);r.create(this._digCallback),this._corridors.push(r)}}_digCallback(t,e,n){this._map[t][e]=n,0==n&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends W{constructor(t,e,n={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(n),this._dirs=k[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)this._map[e][n]=r.a.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,n){this._map[t][e]=n}create(t){let e=this._fillMap(0),n=this._options.born,i=this._options.survive;for(let t=0;t<this._height;t++){let r=1,o=0;6==this._options.topology&&(r=2,o=t%2);for(let s=o;s<this._width;s+=r){let r=this._map[s][t],o=this._getNeighbors(s,t);r&&-1!=i.indexOf(o)?e[s][t]=1:r||-1==n.indexOf(o)||(e[s][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let n=1,i=0;6==this._options.topology&&(n=2,i=e%2);for(let r=i;r<this._width;r+=n)t(r,e,this._map[r][e])}}_getNeighbors(t,e){let n=0;for(let i=0;i<this._dirs.length;i++){let r=this._dirs[i],o=t+r[0],s=e+r[1];o<0||o>=this._width||s<0||s>=this._height||(n+=1==this._map[o][s]?1:0)}return n}connect(t,e,n){e||(e=0);let i=[],o={},s=1,a=[0,0];6==this._options.topology&&(s=2,a=[0,1]);for(let t=0;t<this._height;t++)for(let n=a[t%2];n<this._width;n+=s)if(this._freeSpace(n,t,e)){let e=[n,t];o[this._pointKey(e)]=e,i.push([n,t])}let l=i[r.a.getUniformInt(0,i.length-1)],u=this._pointKey(l),h={};for(h[u]=l,delete o[u],this._findConnected(h,o,[l],!1,e);Object.keys(o).length>0;){let t=this._getFromTo(h,o),i=t[0],r=t[1],s={};s[this._pointKey(i)]=i,this._findConnected(s,o,[i],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,r,i,h,o,e,n);for(let t in s){let n=s[t];this._map[n[0]][n[1]]=e,h[t]=n,delete o[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let n,i=[0,0],o=[0,0],s=Object.keys(t),a=Object.keys(e);for(let l=0;l<5;l++){if(s.length<a.length){let n=s;o=t[n[r.a.getUniformInt(0,n.length-1)]],i=this._getClosest(o,e)}else{let n=a;i=e[n[r.a.getUniformInt(0,n.length-1)]],o=this._getClosest(i,t)}if(n=(i[0]-o[0])*(i[0]-o[0])+(i[1]-o[1])*(i[1]-o[1]),n<64)break}return[i,o]}_getClosest(t,e){let n=null,i=null;for(let r in e){let o=e[r],s=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(null==i||s<i)&&(i=s,n=o)}return n}_findConnected(t,e,n,i,r){for(;n.length>0;){let o,s=n.splice(0,1)[0];o=6==this._options.topology?[[s[0]+2,s[1]],[s[0]+1,s[1]-1],[s[0]-1,s[1]-1],[s[0]-2,s[1]],[s[0]-1,s[1]+1],[s[0]+1,s[1]+1]]:[[s[0]+1,s[1]],[s[0]-1,s[1]],[s[0],s[1]+1],[s[0],s[1]-1]];for(let s=0;s<o.length;s++){let a=this._pointKey(o[s]);null==t[a]&&this._freeSpace(o[s][0],o[s][1],r)&&(t[a]=o[s],i||delete e[a],n.push(o[s]))}}}_tunnelToConnected(t,e,n,i,r,o){let s,a;e[0]<t[0]?(s=e,a=t):(s=t,a=e);for(let t=s[0];t<=a[0];t++){this._map[t][s[1]]=r;let e=[t,s[1]],o=this._pointKey(e);n[o]=e,delete i[o]}o&&s[0]<a[0]&&o(s,[a[0],s[1]]);let l=a[0];e[1]<t[1]?(s=e,a=t):(s=t,a=e);for(let t=s[1];t<a[1];t++){this._map[l][t]=r;let e=[l,t],o=this._pointKey(e);n[o]=e,delete i[o]}o&&s[1]<a[1]&&o([a[0],s[1]],[a[0],a[1]])}_tunnelToConnected6(t,e,n,i,r,o){let s,a;e[0]<t[0]?(s=e,a=t):(s=t,a=e);let l=s[0],u=s[1];for(;l!=a[0]||u!=a[1];){let t=2;u<a[1]?(u++,t=1):u>a[1]&&(u--,t=1),l<a[0]?l+=t:l>a[0]||a[1]%2?l-=t:l+=t,this._map[l][u]=r;let e=[l,u],o=this._pointKey(e);n[o]=e,delete i[o]}o&&o(e,t)}_freeSpace(t,e,n){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==n}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends M{constructor(t,e,n={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},n),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let n,i=Date.now();do{if(n=0,Date.now()-i>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),r=parseInt(e[0]),o=parseInt(e[1]),s=this._getDiggingDirection(r,o);if(!s)continue;let a=0;do{if(a++,this._tryFeature(r,o,s[0],s[1])){this._removeSurroundingWalls(r,o),this._removeSurroundingWalls(r-s[0],o-s[1]);break}}while(a<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&n++}while(this._dug/e<this._options.dugPercentage||n);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this._map[e][n]);return this._walls={},this._map=[],this}_digCallback(t,e,n){0==n||2==n?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),n=L.createRandomCenter(t,e,this._options);this._rooms.push(n),n.create(this._digCallback)}_findWall(){let t=[],e=[];for(let n in this._walls){2==this._walls[n]?e.push(n):t.push(n)}let n=e.length?e:t;if(!n.length)return null;let i=r.a.getItem(n.sort());return delete this._walls[i],i}_tryFeature(t,e,n,i){let o=r.a.getWeightedValue(this._features),s=G[o].createRandomAt(t,e,n,i,this._options);return!!s.isValid(this._isWallCallback,this._canBeDugCallback)&&(s.create(this._digCallback),s instanceof L&&this._rooms.push(s),s instanceof j&&(s.createPriorityWalls(this._priorityWallCallback),this._corridors.push(s)),!0)}_removeSurroundingWalls(t,e){let n=k[4];for(let i=0;i<n.length;i++){let r=n[i],o=t+r[0],s=e+r[1];delete this._walls[o+","+s],o=t+2*r[0],s=e+2*r[1],delete this._walls[o+","+s]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let n=null,i=k[4];for(let r=0;r<i.length;r++){let o=i[r],s=t+o[0],a=e+o[1];if(!this._map[s][a]){if(n)return null;n=o}}return n?[-n[0],-n[1]]:null}_addDoors(){let t=this._map;function e(e,n){return 1==t[e][n]}for(let t=0;t<this._rooms.length;t++){let n=this._rooms[t];n.clearDoors(),n.addDoors(e)}}},EllerMaze:class extends W{create(t){let e,n=this._fillMap(1),i=Math.ceil((this._width-2)/2),o=[],s=[];for(let t=0;t<i;t++)o.push(t),s.push(t);for(o.push(i-1),e=1;e+3<this._height;e+=2)for(let t=0;t<i;t++){let i=2*t+1,a=e;n[i][a]=0,t!=o[t+1]&&r.a.getUniform()>9/24&&(V(t,o,s),n[i+1][a]=0),t!=o[t]&&r.a.getUniform()>9/24?D(t,o,s):n[i][a+1]=0}for(let t=0;t<i;t++){let i=2*t+1,a=e;n[i][a]=0,t!=o[t+1]&&(t==o[t]||r.a.getUniform()>9/24)&&(V(t,o,s),n[i+1][a]=0),D(t,o,s)}for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,n[e][i]);return this}},DividedMaze:class extends W{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,n=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let i=0;i<n;i++){let r=0==t||0==i||t+1==e||i+1==n;this._map[t].push(r?1:0)}}this._stack=[[1,1,e-2,n-2]],this._process();for(let i=0;i<e;i++)for(let e=0;e<n;e++)t(i,e,this._map[i][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],n=[];for(let n=t[0]+1;n<t[2];n++){let i=this._map[n][t[1]-1],r=this._map[n][t[3]+1];!i||!r||n%2||e.push(n)}for(let e=t[1]+1;e<t[3];e++){let i=this._map[t[0]-1][e],r=this._map[t[2]+1][e];!i||!r||e%2||n.push(e)}if(!e.length||!n.length)return;let i=r.a.getItem(e),o=r.a.getItem(n);this._map[i][o]=1;let s=[],a=[];s.push(a);for(let e=t[0];e<i;e++)this._map[e][o]=1,e%2&&a.push([e,o]);a=[],s.push(a);for(let e=i+1;e<=t[2];e++)this._map[e][o]=1,e%2&&a.push([e,o]);a=[],s.push(a);for(let e=t[1];e<o;e++)this._map[i][e]=1,e%2&&a.push([i,e]);a=[],s.push(a);for(let e=o+1;e<=t[3];e++)this._map[i][e]=1,e%2&&a.push([i,e]);let l=r.a.getItem(s);for(let t=0;t<s.length;t++){let e=s[t];if(e==l)continue;let n=r.a.getItem(e);this._map[n[0]][n[1]]=0}this._stack.push([t[0],t[1],i-1,o-1]),this._stack.push([i+1,t[1],t[2],o-1]),this._stack.push([t[0],o+1,i-1,t[3]]),this._stack.push([i+1,o+1,t[2],t[3]])}},IceyMaze:class extends W{constructor(t,e,n=0){super(t,e),this._regularity=n,this._map=[]}create(t){let e=this._width,n=this._height,i=this._fillMap(1);e-=e%2?1:2,n-=n%2?1:2;let o=0,s=0,a=0,l=0,u=0,h=!1,c=[[0,0],[0,0],[0,0],[0,0]];do{if(o=1+2*Math.floor(r.a.getUniform()*(e-1)/2),s=1+2*Math.floor(r.a.getUniform()*(n-1)/2),u||(i[o][s]=0),!i[o][s]){this._randomize(c);do{0==Math.floor(r.a.getUniform()*(this._regularity+1))&&this._randomize(c),h=!0;for(let t=0;t<4;t++)if(a=o+2*c[t][0],l=s+2*c[t][1],this._isFree(i,a,l,e,n)){i[a][l]=0,i[o+c[t][0]][s+c[t][1]]=0,o=a,s=l,h=!1,u++;break}}while(!h)}}while(u+1<e*n/4);for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,i[e][n]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*r.a.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,n,i,r){return!(e<1||n<1||e>=i||n>=r)&&t[e][n]}},Rogue:class extends W{constructor(t,e,n){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(n=Object.assign({cellWidth:3,cellHeight:3},n)).hasOwnProperty("roomWidth")||(n.roomWidth=this._calculateRoomSize(this._width,n.cellWidth)),n.hasOwnProperty("roomHeight")||(n.roomHeight=this._calculateRoomSize(this._height,n.cellHeight)),this._options=n}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,this.map[e][n]);return this}_calculateRoomSize(t,e){let n=Math.floor(t/e*.8),i=Math.floor(t/e*.25);return i<2&&(i=2),n<2&&(n=2),[i,n]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,n,i,o,s,a=r.a.getUniformInt(0,this._options.cellWidth-1),l=r.a.getUniformInt(0,this._options.cellHeight-1),u=!1;do{s=[0,2,4,6],s=r.a.shuffle(s);do{if(u=!1,t=s.pop(),e=a+k[8][t][0],n=l+k[8][t][1],!(e<0||e>=this._options.cellWidth||n<0||n>=this._options.cellHeight)){if(i=this.rooms[a][l],i.connections.length>0&&i.connections[0][0]==e&&i.connections[0][1]==n)break;o=this.rooms[e][n],0==o.connections.length&&(o.connections.push([a,l]),this.connectedCells.push([e,n]),a=e,l=n,u=!0)}}while(s.length>0&&0==u)}while(s.length>0)}_connectUnconnectedRooms(){let t,e,n,i=this._options.cellWidth,o=this._options.cellHeight;this.connectedCells=r.a.shuffle(this.connectedCells);for(let s=0;s<this._options.cellWidth;s++)for(let a=0;a<this._options.cellHeight;a++)if(t=this.rooms[s][a],0==t.connections.length){let l=[0,2,4,6];l=r.a.shuffle(l),n=!1;do{let t=l.pop(),r=s+k[8][t][0],u=a+k[8][t][1];if(!(r<0||r>=i||u<0||u>=o)){if(e=this.rooms[r][u],n=!0,0==e.connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==s&&e.connections[t][1]==a){n=!1;break}if(n)break}}while(l.length);n?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,n,i,o,s=this._width,a=this._height,l=this._options.cellWidth,u=this._options.cellHeight,h=Math.floor(this._width/l),c=Math.floor(this._height/u),f=this._options.roomWidth,d=this._options.roomHeight;for(let p=0;p<l;p++)for(let l=0;l<u;l++){if(n=h*p,i=c*l,0==n&&(n=1),0==i&&(i=1),t=r.a.getUniformInt(f[0],f[1]),e=r.a.getUniformInt(d[0],d[1]),l>0)for(o=this.rooms[p][l-1];i-(o.y+o.height)<3;)i++;if(p>0)for(o=this.rooms[p-1][l];n-(o.x+o.width)<3;)n++;let u=Math.round(r.a.getUniformInt(0,h-t)/2),g=Math.round(r.a.getUniformInt(0,c-e)/2);for(;n+u+t>=s;)u?u--:t--;for(;i+g+e>=a;)g?g--:e--;n+=u,i+=g,this.rooms[p][l].x=n,this.rooms[p][l].y=i,this.rooms[p][l].width=t,this.rooms[p][l].height=e;for(let r=n;r<n+t;r++)for(let t=i;t<i+e;t++)this.map[r][t]=0}}_getWallPosition(t,e){let n,i,o;return 1==e||3==e?(n=r.a.getUniformInt(t.x+1,t.x+t.width-2),1==e?(i=t.y-2,o=i+1):(i=t.y+t.height+1,o=i-1),this.map[n][o]=0):(i=r.a.getUniformInt(t.y+1,t.y+t.height-2),2==e?(n=t.x+t.width+1,o=n-1):(n=t.x-2,o=n+1),this.map[o][i]=0),[n,i]}_drawCorridor(t,e){let n,i,o,s,a=e[0]-t[0],l=e[1]-t[1],u=t[0],h=t[1],c=[],f=Math.abs(a),d=Math.abs(l),p=r.a.getUniform(),g=p,m=1-p;for(i=a>0?2:6,o=l>0?4:0,f<d?(n=Math.ceil(d*g),c.push([o,n]),c.push([i,f]),n=Math.floor(d*m),c.push([o,n])):(n=Math.ceil(f*g),c.push([i,n]),c.push([o,d]),n=Math.floor(f*m),c.push([i,n])),this.map[u][h]=0;c.length>0;)for(s=c.pop();s[1]>0;)u+=k[8][s[0]][0],h+=k[8][s[0]][1],this.map[u][h]=0,s[1]=s[1]-1}_createCorridors(){let t,e,n,i,r,o=this._options.cellWidth,s=this._options.cellHeight;for(let a=0;a<o;a++)for(let o=0;o<s;o++){t=this.rooms[a][o];for(let o=0;o<t.connections.length;o++)e=t.connections[o],n=this.rooms[e[0]][e[1]],n.cellx>t.cellx?(i=2,r=4):n.cellx<t.cellx?(i=4,r=2):n.celly>t.celly?(i=3,r=1):(i=1,r=3),this._drawCorridor(this._getWallPosition(t,i),this._getWallPosition(n,r))}}}};Math.sqrt(3),Math.sqrt(3);class B{constructor(t,e,n,i={}){this._toX=t,this._toY=e,this._passableCallback=n,this._options=Object.assign({topology:8},i),this._dirs=k[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(t,e){let n=[];for(let i=0;i<this._dirs.length;i++){let r=this._dirs[i],o=t+r[0],s=e+r[1];this._passableCallback(o,s)&&n.push([o,s])}return n}}var z={Dijkstra:class extends B{constructor(t,e,n,i){super(t,e,n,i),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,n){let i=t+","+e;if(i in this._computed||this._compute(t,e),!(i in this._computed))return;let r=this._computed[i];for(;r;)n(r.x,r.y),r=r.prev}_compute(t,e){for(;this._todo.length;){let n=this._todo.shift();if(n.x==t&&n.y==e)return;let i=this._getNeighbors(n.x,n.y);for(let t=0;t<i.length;t++){let e=i[t],r=e[0],o=e[1];r+","+o in this._computed||this._add(r,o,n)}}}_add(t,e,n){let i={x:t,y:e,prev:n};this._computed[t+","+e]=i,this._todo.push(i)}},AStar:class extends B{constructor(t,e,n,i={}){super(t,e,n,i),this._todo=[],this._done={}}compute(t,e,n){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){let n=this._todo.shift(),i=n.x+","+n.y;if(i in this._done)continue;if(this._done[i]=n,n.x==t&&n.y==e)break;let r=this._getNeighbors(n.x,n.y);for(let t=0;t<r.length;t++){let e=r[t],i=e[0],o=e[1];i+","+o in this._done||this._add(i,o,n)}}let i=this._done[t+","+e];if(i)for(;i;)n(i.x,i.y),i=i.prev}_add(t,e,n){let i=this._distance(t,e),r={x:t,y:e,prev:n,g:n?n.g+1:0,h:i},o=r.g+r.h;for(let t=0;t<this._todo.length;t++){let e=this._todo[t],n=e.g+e.h;if(o<n||o==n&&i<e.h)return void this._todo.splice(t,0,r)}this._todo.push(r)}_distance(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:let n=Math.abs(t-this._fromX),i=Math.abs(e-this._fromY);return i+Math.max(0,(n-i)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}}}};const q=c;function H(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var X=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,i;return e=t,i=[{key:"key",value:function(t,e){return t+","+e}},{key:"parseKey",value:function(t){var e=t.split(",");return[parseInt(e[0]),parseInt(e[1])]}},{key:"grayscale",value:function(e){return e>1&&(e=1),e<0&&(e=0),q.toHex(q.interpolate(t.minGray,t.maxGray,e))}}],(n=null)&&H(e.prototype,n),i&&H(e,i),t}();function K(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Y(X,"colors",{bright:"#f5efeb",blood:"#d3473d",water:"#316a96",important:"#f6ad0f",dark:"#2e243f",gray:"#bebebe",black:"#000000"}),Y(X,"minGray",q.fromString(X.colors.dark)),Y(X,"maxGray",q.fromString(X.colors.bright));var J=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,i;return e=t,i=[{key:"roll",value:function(t){return Math.floor(t*Math.random()+1)}},{key:"attack",value:function(e,n){var i=t.getAttackValue(e)-t.getDefenseValue(n)+10,r=this.roll(20);if(1==r)return 0;if(r>=i||20==r){var o=this.roll(e.weapon)-n.armor;return o<1?1:o}return 0}},{key:"getAttackValue",value:function(t){return t.attack+t.weapon}},{key:"getDefenseValue",value:function(t){return t.defense+t.armor}}],(n=null)&&K(e.prototype,n),i&&K(e,i),t}();function $(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var tt=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n,this.game=i,this.setStats(10,1,1,2,0),this.token="x",this.color=X.colors.important,this.background="black",this.name="Monster",this.dead=!1,this.lastHit=null}var e,n,i;return e=t,(n=[{key:"setToken",value:function(t,e){this.token=t,this.color=e}},{key:"draw",value:function(t){var e=X.key(this.x,this.y);if(null==t||e in t){var n=$(this.game.worldToScreen([this.x,this.y]),2),i=n[0],r=n[1];this.game.display.draw(i,r,this.getToken(),this.getColor(),this.background)}}},{key:"getToken",value:function(){return this.token}},{key:"getColor",value:function(){return this.color}},{key:"isVisible",value:function(t){var e=X.key(this.x,this.y);return null==t||e in t}},{key:"heal",value:function(t){this.hp+=t,this.hp>this.maxHp&&(this.hp=this.maxHp)}},{key:"combat",value:function(t){if(!this.dead){var e=J.attack(this,t);t.hp-=e,t.checkDeath(),this.lastHit=t,this.onCombat(e,t)}}},{key:"checkDeath",value:function(){this.hp<=0&&(this.dead=!0)}},{key:"onCombat",value:function(t,e){var n=this.coloredName(),i=e.coloredName();if(t){var r="%c{red}".concat(t,"%c{}");this.game.messages.push("".concat(n," hit ").concat(i," for ").concat(r," damage."))}else this.game.messages.push("".concat(n," missed ").concat(i,"."))}},{key:"colored",value:function(t){return"%c{".concat(this.color,"}").concat(t,"%c{}")}},{key:"coloredName",value:function(){return"%c{".concat(this.color,"}").concat(this.name,"%c{}")}},{key:"setStats",value:function(t,e,n,i,r){this.hp=t,this.maxHp=t,this.attack=e,this.defense=n,this.weapon=i,this.armor=r}}])&&Z(e.prototype,n),i&&Z(e,i),t}();function et(t){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return it(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return it(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function rt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ot(t,e){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function st(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=ut(t);if(e){var r=ut(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return at(this,n)}}function at(t,e){return!e||"object"!==et(e)&&"function"!=typeof e?lt(t):e}function lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ut(t){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ot(t,e)}(o,t);var e,n,i,r=st(o);function o(t,e,n){var i,s,a,l;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i=r.call(this,t,e,n),s=lt(i),l=function(t,e){var n={38:0,33:1,39:2,34:3,40:4,35:5,37:6,36:7};Ut.debug&&(77==t.keyCode&&(i.game.hasMap=!0),78==t.keyCode&&i.game.onExit());var r=t.keyCode;if(r in n){t.preventDefault();var o=k[8][n[r]],s=i.x+o[0],a=i.y+o[1];if(X.key(i.x,i.y),i.game.canPlayerMove(s,a))i.x=s,i.y=a;else{var l=i.game.getMonster(s,a);l?i.combat(l):i.game.messages.push("The stone wall is cold.")}e(!0)}else e(!1)},(a="handleEvent")in s?Object.defineProperty(s,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[a]=l,i.setToken("ベ","#ffffff"),i.points=0,i.upgrade_size_pts=20,i.size=1,i.promise=null,i.maxTime=15,i.name="player",i.interval=.5,i.nextTurn=i.interval,i.selfHarm=!0,i}return e=o,(n=[{key:"upgrade_size",value:function(){return this.points>=this.upgrade_size_pts&&(this.game.play_sfx("achieved"),this.points-=this.upgrade_size_pts,this.size++,this.upgrade_size_pts*=2,!0)}},{key:"draw",value:function(){var t=nt(this.game.worldToScreen([this.x,this.y]),2),e=t[0],n=t[1],i=[0,0],r=[0,0];switch(this.size){case 1:i=[-.15,0],r=[0,.1],this.game.display.draw(e+i[0],n+i[1],".",X.colors.blood),this.game.display.draw(e-i[0],n+i[1],".",X.colors.blood),this.game.display.draw(e+r[0],n+r[1],'"');break;case 2:i=[-.3,0],r=[.8,.2],this.game.display.draw(e+i[0],n+i[1],".",X.colors.blood),this.game.display.draw(e-i[0],n+i[1],".",X.colors.blood),this.game.display.draw(e-r[0],n+r[1],"("),this.game.display.draw(e+r[0],n+r[1],")");break;default:case 3:i=[-.3,0],r=[.5,0];var o=[1.3,.2];this.game.display.draw(e+i[0],n+i[1],".",X.colors.blood),this.game.display.draw(e-i[0],n+i[1],".",X.colors.blood),this.game.display.draw(e-r[0],n+r[1],")"),this.game.display.draw(e-o[0],n+o[1],"("),this.game.display.draw(e+r[0],n+r[1],"("),this.game.display.draw(e+o[0],n+o[1],")")}}},{key:"update",value:function(){this.size<this.game.maxSize&&this.upgrade_size(),this.nextTurn-=this.game.deltaTime,this.nextTurn<=0&&(this.nextTurn+=this.interval,this.selfHarm=!0)}},{key:"act",value:function(){if(this.game.dialogue.showing)return Promise.resolve(!0);var t=this.handleEvent;return new Promise((function(e){window.addEventListener("keydown",(function(n){t(n,e)}),{once:!0})}))}},{key:"hurtSelf",value:function(t){this.selfHarm&&(this.game.screenShake(),this.game.countdown-=t,this.game.messages.push("I'm not big enough yet!"),this.selfHarm=!1)}},{key:"addXP",value:function(t){this.xp+=t,this.xp>this.nextLevel&&(this.xp=this.xp-this.nextLevel,this.nextLevel=Math.trunc(1.5*this.nextLevel),this.hp=this.maxHp,this.game.dialogue.play("levelup"))}}])&&rt(e.prototype,n),i&&rt(e,i),o}(tt);function ct(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ft=n(92).Story,dt=function(){function t(e,n){var i,r,o,s=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=function(t,e){t.preventDefault();var n=s.story.currentChoices;if(n.length>0){var i=event.key;i>=1&&i<n.length+1&&(s.story.ChooseChoiceIndex(i-1),s.resetText(),s.continue())}if(13==event.keyCode){if(s.story.canContinue)return s.resetText(),s.continue(),void e(!0);if(!s.story.canContinue&&n.length<1)return s.showing=!1,s.callback&&(s.callback(),s.callback=null),void e(!0)}e(!0),s.draw()},(r="handleEvent")in(i=this)?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,this.game=n,this.story=new ft(e),this.padding=5,this.resetText(),this.showing=!1,this.callback=null}var e,n,i;return e=t,(n=[{key:"play",value:function(t,e){this.game.pushVariables(),this.story.ChoosePathString(t),this.showing=!0,this.callback=e,this.resetText(),this.continue(),this.waitForEvent=null}},{key:"draw",value:function(){if(this.showing){var t=this.padding,e=this.padding,n=this.game.width-this.padding,i=this.game.height-this.padding;this.drawBox(t-1,e-1,n+1,i+1),this.drawBorder(t,e,n,i,"-","|","+"),this.drawText()}}},{key:"drawText",value:function(){var t=[this.padding+1,this.padding+1],e=this.text.join("\n\n");this.game.display.drawText(t[0]+2,t[1]+1,e,this.textWidth()-4)}},{key:"pushText",value:function(t){this.text.push(t)}},{key:"resetText",value:function(){this.text=[]}},{key:"act",value:function(){if(this.showing){this.draw();var t=this.handleEvent;return new Promise((function(e){window.addEventListener("keydown",(function(n){t(n,e)}),{once:!0})}))}return Promise.resolve(!0)}},{key:"continue",value:function(){console.log("calling continue");var t=X.colors.important;if(this.story.canContinue){for(var e=[],n=!1;this.story.canContinue&&!n;){var i=this.fetchText(e);console.log(i),null!=i&&":br"!=i?this.pushText(i):":br"==i&&(n=!0)}for(var r=this.story.currentChoices,o=0;o<r.length;o++){var s=r[o];this.pushText("%c{".concat(t,"}")+(o+1)+"%c{}: "+s.text)}0==r.length&&this.pushText("Push %c{".concat(t,"}enter%c{} to continue")),this.handleStoryEvents(e)}}},{key:"handleStoryEvents",value:function(t){var e=this;t.forEach((function(t){e.game.handleStoryEvent(t)}))}},{key:"fetchText",value:function(t){var e=this.story.Continue();return":br"==e.trim()?":br":":"==e[0]?(t.push(e.trim().split(",")),null):e.trim()}},{key:"textWidth",value:function(){return this.game.width-2*this.padding-1}},{key:"drawBox",value:function(t,e,n,i,r){for(var o=t;o<=n;o++)for(var s=e;s<=i;s++)this.game.display.draw(o,s,r)}},{key:"drawBorder",value:function(t,e,n,i,r,o,s){var a=0,l=0;for(l=e;l<=i;l++)this.game.display.draw(t,l,o);for(l=e;l<=i;l++)this.game.display.draw(n,l,o);for(a=t;a<=n;a++)this.game.display.draw(a,e,r);for(a=t;a<=n;a++)this.game.display.draw(a,i,r);this.game.display.draw(t,e,s),this.game.display.draw(t,i,s),this.game.display.draw(n,e,s),this.game.display.draw(n,i,s)}}])&&ct(e.prototype,n),i&&ct(e,i),t}();function pt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n(92).Story;var gt=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.game=e,this.reset(),this.textLife=2,this.height=n,this.text=[],this.quickTip="La la la, I love carrots..."}var e,n,i;return e=t,(n=[{key:"draw",value:function(){if(this.text.length>0)if(this.text[0][1]>0){var t=this.text[0][0].length,e=this.game.width/2-t/2,n=this.game.statusHeight-1;this.game.display.drawText(e,n,this.text[0][0]),this.text[0][1]-=this.game.deltaTime}else this.text.shift();else{var i=this.findItem(),r="";r=null!=i?"Hmm, "+i.name+" ("+i.token+"), it looks "+(i.size<=this.game.player.size?"tasty":"too big"):this.quickTip;var o=this.game.width/2-r.length/2,s=this.game.statusHeight-1;this.game.display.drawText(o,s,r)}}},{key:"findItem",value:function(){for(var t=this.game.player.x-1;t<this.game.player.x+2;t++)for(var e=this.game.player.y-1;e<this.game.player.y+2;e++){var n=this.game.getItem(t,e);if(null!=n)return n}return null}},{key:"push",value:function(t){this.text=[[t,this.textLife]].concat(this.text).slice(0,this.height+1),this.text.length>2&&this.text.shift()}},{key:"reset",value:function(){this.text=[]}},{key:"act",value:function(){this.draw()}}])&&pt(e.prototype,n),i&&pt(e,i),t}();function mt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n(92).Story;var vt=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.game=e,this.monsters=[],this.items=[],this.rect=[0,0,this.game.width,n],this.width=this.rect[2]-this.rect[0],this.height=this.rect[3]-this.rect[1],this.cursorY=1,this.cursorX=1,this.spinnerToken="-",this.animFrame=0,this.interval=.1,this.timeTokenTimer=this.interval,this.spinnerFrames=["-","\\","|","/"],this.rainbow=["#ff0000","#ffa500","#ffff00","#008000","#0000ff","#4b0082","#ee82ee"]}var e,n,i;return e=t,(n=[{key:"draw",value:function(){this.cursorY=1;var t=this.game.player;this.bar("Nap Time: ",this.game.countdown,this.game.maxTime,X.colors.blood),this.bar("Food:     ",t.points,t.upgrade_size_pts,X.colors.water),this.bar("Size:     ",t.size,this.game.maxSize,X.colors.water,!0)}},{key:"drawItem",value:function(t){this.text(t.colored(t.token)+": "+t.name)}},{key:"drawMonster",value:function(t){this.text(t.colored(t.token)+": "+t.name),this.text(this.bar("HP",t.hp,t.maxHp,X.colors.blood))}},{key:"modifier",value:function(t){var e=X.colors.important;return 0==t?"":t<0?"(%c{".concat(e,"}").concat(t,"%c{}"):"(".concat(t,")")}},{key:"text",value:function(t){this.game.display.drawText(this.cursorX,this.cursorY,t,this.width),this.cursorY+=1}},{key:"bar",value:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.game.display.drawText(1,this.cursorY,t);var o=t.length+2,s=this.width-o-1;r&&(s=n);for(var a=0;a<s;a++){var l=a/(s-1),u=i;l>=e/n&&(u=X.colors.gray);var h=[.1,.1];a%2==0?this.game.display.draw(a+o,this.cursorY-h[1],"o",u):this.game.display.draw(a+o,this.cursorY+h[1],"o",u)}this.cursorY+=1}}])&&mt(e.prototype,n),i&&mt(e,i),t}();function yt(t){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return _t(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _t(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function St(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function wt(t,e){return(wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function xt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Nt(t);if(e){var r=Nt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Ct(this,n)}}function Ct(t,e){return!e||"object"!==yt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Nt(t){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Tt,kt,Et,Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wt(t,e)}(o,t);var e,n,i,r=xt(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).setToken("i",X.colors.blood),i.onPickup=null,i.pickedUp=!1,i.story=null,i.xp=1,i.moves=!1,i.path=[],i.interval=.75,i.slowInterval=.75,i.maxRange=10,i.lastMove=i.interval,i.id=o.idIndex++,i}return e=o,(n=[{key:"pickup",value:function(t){this.pickedUp=!0,null!=this.onPickup&&this.onPickup(t,this),this.story&&this.game.dialogue.play(this.story)}},{key:"act",value:function(){if(this.moves&&(this.lastMove-=this.game.deltaTime,this.lastMove<=0))if(this.path.length>this.maxRange?this.lastMove+=this.interval:this.lastMove+=this.slowInterval,this.path.length>1)if(this.size>this.game.player.size){var t=bt(this.path.shift(),2),e=t[0],n=t[1];this.x=e,this.y=n}else this.wander();else 1==this.path.length&&this.size>this.game.player.size&&(this.game.countdown-=2,this.game.screenShake(),this.game.messages.push("Ouch!"))}},{key:"wander",value:function(){switch(Math.floor(4*Math.random())){case 0:this.move(1,0);break;case 1:this.move(-1,0);break;case 2:this.move(0,1);break;case 3:this.move(0,-1)}}},{key:"move",value:function(t,e){this.game.canMonsterMove(this.x+t,this.y+e)&&(this.x+=t,this.y+=e)}},{key:"calculatePath",value:function(){this.moves&&(this.path=this.game.pathToPlayer(this.x,this.y,this.id))}},{key:"getToken",value:function(){return this.game.player.size,this.size,this.token}},{key:"getColor",value:function(){return this.game.player.size<this.size?this.game.rainbow.getSpriteAnim([this.color,X.colors.blood],0,.5):this.color}},{key:"setToken",value:function(t,e){this.token=t,this.color=e}}])&&St(e.prototype,n),i&&St(e,i),o}(tt);function Ot(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Et=1,(kt="idIndex")in(Tt=Pt)?Object.defineProperty(Tt,kt,{value:Et,enumerable:!0,configurable:!0,writable:!0}):Tt[kt]=Et;var It=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.display=e}var e,n,i;return e=t,(n=[{key:"drawBox",value:function(t,e){for(var n=t[0];n<=t[2];n++)for(var i=t[1];i<=t[3];i++)this.display.draw(n,i,e)}},{key:"drawBorder",value:function(t,e,n,i){var r=0,o=0;for(r=t[0];r<=t[2];r++)this.display.draw(r,t[1],e);for(r=t[0];r<=t[2];r++)this.display.draw(r,t[3],e);for(o=t[1];o<=t[3];o++)this.display.draw(t[0],o,n);for(o=t[1];o<=t[3];o++)this.display.draw(t[2],o,n);this.display.draw(t[0],t[1],i),this.display.draw(t[0],t[3],i),this.display.draw(t[2],t[1],i),this.display.draw(t[2],t[3],i)}},{key:"drawLine",value:function(t,e,n,i,r,o){for(var s=t,a=e,l=t>n?-1:1,u=e>i?-1:1;s!=n||a!=i;)s!=n&&(s+=l),a!=i&&(a+=u),this.display.draw(s,a,r);this.display.draw(t,e,o),this.display.draw(n,i,o)}}])&&Ot(e.prototype,n),i&&Ot(e,i),t}();function At(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ft=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.game=e,this.rainbow=["#ff0000","#ffa500","#ffff00","#008000","#0000ff","#4b0082","#ee82ee"],this.animFrame=0,this.interval=.1,this.timeTokenTimer=this.interval}var e,n,i;return e=t,(n=[{key:"rainbowText",value:function(t,e,n){for(var i=0;i<n.length;i++)this.game.display.draw(i+t,e+this.getSpriteAnim([0,.05],i,.2),n[i],this.getSpriteAnim(this.rainbow,i,.2),"#444444")}},{key:"update",value:function(){this.timeTokenTimer<=0&&(this.animFrame+=1,this.timeTokenTimer+=this.interval),this.timeTokenTimer-=this.game.deltaTime}},{key:"getSpriteAnim",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t[(e+Math.floor(this.animFrame*n))%t.length]}}])&&At(e.prototype,n),i&&At(e,i),t}();function Wt(t,e,n,i,r,o,s){try{var a=t[o](s),l=a.value}catch(t){return void n(t)}a.done?e(l):Promise.resolve(l).then(i,r)}function Mt(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){Wt(o,i,r,s,a,"next",t)}function a(t){Wt(o,i,r,s,a,"throw",t)}s(void 0)}))}}function Rt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function jt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Vt=n(315),Dt=n(316),Ut=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Gt(this,"handleEvent",(function(n){var i={38:0,33:1,39:2,34:3,40:4,35:5,37:6,36:7};t.debug&&(77==n.keyCode&&(e.game.hasMap=!0),78==n.keyCode&&e.game.onExit());var r=n.keyCode;if(r in i){n.preventDefault();var o=k[8][i[r]];e.inputDiff=o}})),this.engine=null,this.player=null,this.width=70,this.height=25,this.inputDiff=[0,0],this.display=new O({width:this.width,height:this.height,fg:X.colors.bright,bg:"black",fontSize:20}),document.getElementById("container").appendChild(this.display.getContainer()),document.getElementById("container"),this.drawer=new It(this.display),this.statusHeight=5,this.mapWidth=this.width,this.mapHeight=this.height-this.statusHeight-1,this.messages=new gt(this,3),this.dialogue=new dt(Vt,this),this.status=new vt(this,this.statusHeight),this.countdown=10,this.pointGoal=50,this.lastTime=this.ms(),this.fps=20,this.deltaTime=0,this.rainbow=new Ft(this),this.blinking=!1,this.ignoreItemId=-1,this.music=null,this.sfx={};["coin","bling","hit","achieved","arrow_hit"].map((function(t){return e.load_sfx(t)}));this.sfx.nearly_dead=new Dt.Sound({source:"file",options:{path:"./sounds/nearly_dead.ogg",loop:!0}});var n=this.handleEvent;window.addEventListener("keydown",(function(t){return n(t)})),this.restart(),this.mainLoop()}var e,n,i,o,s,a;return e=t,(n=[{key:"playMusic",value:function(){this.music.attack=.9,this.music.volume=.6,this.music.play()}},{key:"load_sfx",value:function(t){this.sfx[t]=new Dt.Sound({source:"file",options:{path:"./sounds/"+t+".ogg"}})}},{key:"play_sfx",value:function(t){this.sfx[t].clone().play()}},{key:"restart",value:function(){this.createItemTypes(),this.player=new ht(0,0,this),this.monsters=[],this.items=[],this.visible=[],this.level=1,this.hasMap=!1,this.dialogue.play("title")}},{key:"pushOptions",value:function(t,e){var n=this.game.display.getOptions();this.game.display.setOptions(t),e(),this.game.display.setOptions(n)}},{key:"screenShake",value:function(){var t=this;this.display.getContainer().className="shake",this.play_sfx("hit"),setTimeout((function(){t.display.getContainer().className=""}),100)}},{key:"blinkScreen",value:function(t){t&&!this.blinking&&(document.getElementById("body").className="blink_slow",this.sfx.nearly_dead.play()),!t&&this.blinking&&(document.getElementById("body").className="",this.sfx.nearly_dead.stop()),this.blinking=t}},{key:"timestamp",value:function(){return(new Date).getTime()/1e3}},{key:"ms",value:function(){return(new Date).getTime()}},{key:"createItemTypes",value:function(){this.itemTypes={pellet:{token:".",size:1,xp:1,moves:!1},peach:{token:"@",size:2,xp:2,moves:!1},"rabbit poop":{token:":",size:1,xp:1,moves:!1},sake:{token:"S",size:3,xp:2,moves:!1},toddler:{token:"T",size:3,xp:3,moves:!0,interval:.75,slowInterval:1.5},parent:{token:"P",size:4,xp:10,moves:!0,interval:.5,slowInterval:1}}}},{key:"placeItem",value:function(t,e,n){var i=this,r=this.itemTypes[t],o=new Pt(e,n,this);o.setToken(r.token,X.colors.blood),o.name=t,o.size=r.size,o.color=X.colors.important,o.xp=r.xp,o.moves=r.moves,o.onPickup=function(e){i.player.size>=o.size?(i.messages.push(o.name+", yum +"+o.xp),i.player.points+=o.xp,i.countdown+=2,i.play_sfx("bling"),i.placeItemRandomly(t),null!=i.onPickupItem&&i.onPickupItem(t),i.countdown>i.maxTime&&(i.countdown=i.maxTime)):i.messages.push(o.name+" is too big to eat")},this.items.push(o)}},{key:"onExit",value:function(){this.level++,this.hasMap=!1,this.restart()}},{key:"level1",value:function(){var t=this;this.player=new ht(0,0,this),this.messages.quickTip="Eat enough food to grow big before nap time",this.maxTime=25,this.maxSize=2,this.countdown=20,this.lastTime=this.ms(),this.startTime=this.timestamp(),this.generateSingleRoom(Math.floor(this.width/2)-10,Math.floor(this.height/2)-10,15,15),this.resetMonsterPathFinder();for(var e=0,n=Object.entries({pellet:5,"rabbit poop":3});e<n.length;e++)for(var i=Rt(n[e],2),r=i[0],o=i[1],s=0;s<o;s++)this.placeItemRandomly(r);this.onUpdate=function(){2==t.player.size&&t.dialogue.play("level2")}}},{key:"level2",value:function(){var t=this;this.player=new ht(0,0,this),this.messages.quickTip="Eat enough food to grow big and take out the toddler (T)",this.maxTime=50,this.maxSize=3,this.countdown=45,this.lastTime=this.ms(),this.startTime=this.timestamp(),this.generateMap(),this.resetMonsterPathFinder();for(var e=0,n=Object.entries({pellet:20,"rabbit poop":10,peach:5,sake:2,toddler:1});e<n.length;e++)for(var i=Rt(n[e],2),r=i[0],o=i[1],s=0;s<o;s++)this.placeItemRandomly(r);this.onUpdate=function(){},this.onPickupItem=function(e){"toddler"==e&&t.dialogue.play("level3")}}},{key:"level3",value:function(){var t=this;this.player=new ht(0,0,this),this.messages.quickTip="Eat enough food to grow big and take out the parents (P)",this.player.size=3,this.maxTime=65,this.maxSize=4,this.countdown=45,this.lastTime=this.ms(),this.startTime=this.timestamp(),this.generateMap(),this.resetMonsterPathFinder();for(var e=0,n=Object.entries({pellet:20,"rabbit poop":10,peach:5,sake:2,parent:2});e<n.length;e++)for(var i=Rt(n[e],2),r=i[0],o=i[1],s=0;s<o;s++)this.placeItemRandomly(r);this.onUpdate=function(){},this.parents=2,this.onPickupItem=function(e){"parent"==e&&(t.parents--,0==t.parents&&t.dialogue.play("level4"))}}},{key:"resetMonsterPathFinder",value:function(){var t=this;this.monsterPathFinder=new z.AStar(this.player.x,this.player.y,(function(e,n){return t.canMonsterMove(e,n)}))}},{key:"placeItemRandomly",value:function(t){var e=Rt(this.randomFreeCell(this.freeCells),2),n=e[0],i=e[1],r=this.placeItemsRandomly;this.placeItem(t,n,i,r)}},{key:"checkPlayerMovement",value:function(){if(0==this.inputDiff[0]&&0==this.inputDiff[1])return!1;var t=this.player.x+this.inputDiff[0],e=this.player.y+this.inputDiff[1];if(this.inputDiff=[0,0],X.key(this.player.x,this.player.y),this.canPlayerMove(t,e)){var n=this.getItem(t,e);null!=n&&n.size>this.player.size?n.moves||this.player.hurtSelf(1):(this.player.x=t,this.player.y=e)}else{var i=this.getMonster(t,e);i&&this.combat(i)}return!0}},{key:"handleStoryEvent",value:function(t){var e=this;switch(t[0].trim()){case":level1":this.lastLevel=":level1",this.level1();break;case":level2":this.lastLevel=":level2",this.level2();break;case":level3":this.lastLevel=":level3",this.level3();break;case":level4":this.level4();break;case":restart":this.restart();break;case":music":this.music=new Dt.Sound({source:"file",options:{path:"./sounds/8bitninja.mp3",loop:!0}},(function(){return e.playMusic()}));break;case":stopmusic":this.music.stop();break;case":continue":this.handleStoryEvent([this.lastLevel])}}},{key:"sleep",value:function(t){return new Promise((function(e){return setTimeout(e,t)}))}},{key:"mainLoop",value:(a=Mt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.dialogue.showing){t.next=6;break}return t.next=4,this.mainDialogue();case 4:t.next=8;break;case 6:return t.next=8,this.mainDungeon();case 8:t.next=0;break;case 10:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"mainDialogue",value:(s=Mt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.music&&(this.music.volume=.6),this.blinkScreen(!1),this.display.clear(),this.pushVariables(),t.next=6,this.dialogue.act();case 6:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"mainDungeon",value:(o=Mt(regeneratorRuntime.mark((function t(){var e,n,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n in this.music&&(this.music.volume=.9),(e=this.checkPlayerMovement())&&this.resetMonsterPathFinder(),this.items)e&&this.items[n].calculatePath(),this.items[n].act();if(e&&this.checkItems(),this.rainbow.update(),this.player.update(),this.onUpdate&&this.onUpdate(),this.checkGameOver(),this.blinkScreen(this.countdown<10),this.draw(),i=this.ms(),!((r=1e3/this.fps-(i-this.lastTime))>0)){t.next=19;break}return t.next=16,this.sleep(r);case 16:this.deltaTime=1/this.fps,t.next=22;break;case 19:return t.next=21,this.sleep(10);case 21:this.deltaTime=1/this.fps;case 22:this.lastTime=i;case 23:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"removeDeadMonsters",value:function(){var t=this;this.monsters.forEach((function(e){e.dead&&t.player.addXP(e.xp)})),this.monsters=this.monsters.filter((function(t){return!t.dead}))}},{key:"checkItems",value:function(){var t=this.getItem(this.player.x,this.player.y);t&&(this.player.size>=t.size?(t.pickup(this.player),this.items=this.items.filter((function(t){return!t.pickedUp}))):this.messages.push(t.name+" is too big to eat"))}},{key:"checkGameOver",value:function(){this.player.dead&&this.dialogue.play("gameover"),this.countdown-=this.deltaTime,this.countdown<=0&&(this.dialogue.play("gameover"),this.countdown=0)}},{key:"canMonsterMove",value:function(t,e){var n=X.key(t,e),i=this.getItem(t,e);return(!i||i.id==this.ignoreItemId||!i.moves)&&n in this.map&&"#"!=this.map[n]}},{key:"canPlayerMove",value:function(t,e){if(this.getMonster(t,e))return!1;var n=X.key(t,e);return n in this.map&&"#"!=this.map[n]}},{key:"getMonster",value:function(t,e){for(var n=0;n<this.monsters.length;n++){var i=this.monsters[n];if(i.x==t&&i.y==e)return i}return null}},{key:"getItem",value:function(t,e){for(var n=0;n<this.items.length;n++){var i=this.items[n];if(i.x==t&&i.y==e)return i}return null}},{key:"generateSingleRoom",value:function(t,e,n,i){this.map={},this.knownMap={},this.items=[],this.monsters=[],this.freeCells=[];for(var r=t-1;r<t+n+1;r++)for(var o=e-1;o<e+i+1;o++){var s=X.key(r,o);r==t-1||r==t+n||o==e-1||o==e+i?this.map[s]="#":(this.map[s]=" ",this.freeCells.push(s))}return this.freeRooms=[new L(t,e,t+n,e+i,void 0,void 0)],this.setPlayerPositionRandom(),this.freeCells}},{key:"generateMap",value:function(){this.map={},this.knownMap={},this.items=[],this.monsters=[];var t=new U.Digger(this.mapWidth,this.mapHeight,{roomWidth:[10,15],roomHeight:[10,15],dugPercentage:.6});return this.freeCells=[],t.create(function(t,e,n){var i=X.key(t,e);n?this.map[i]="#":(this.map[i]=" ",this.freeCells.push(i))}.bind(this)),this.freeRooms=r.a.shuffle(t.getRooms()),this.setPlayerPositionRandom(),this.freeCells}},{key:"fillDungeon",value:function(){var t={};for(var e in this.itemTypes)t[e]=1;this.placeMonstersAndItemsInRooms(t)}},{key:"nextRoom",value:function(){return this.freeRooms.pop()}},{key:"roomCenter",value:function(t){return[Math.trunc((t.getLeft()+t.getRight())/2),Math.trunc((t.getTop()+t.getBottom())/2)]}},{key:"setPlayerPositionRandom",value:function(){var t=this.nextRoom(),e=this.roomCenter(t);this.player.x=e[0],this.player.y=e[1]}},{key:"placeMonstersAndItemsInRooms",value:function(t){for(var e;e=this.nextRoom();){var n=r.a.getWeightedValue(t),i=this.roomCenter(e);this.placeAround(n,i,2)}}},{key:"placeAround",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=e[0]-n;i<e[0]+n;i++)for(var r=e[1]-n;r<e[1]+n;r++)this.placeItem(t,i,r)}},{key:"randomFreeCell",value:function(t){var e=Math.floor(r.a.getUniform()*t.length),n=t.splice(e,1)[0],i=Rt(X.parseKey(n),2);return[i[0],i[1]]}},{key:"drawWholeMap",value:function(){for(var t in this.map){var e=Rt(this.worldToScreen(X.parseKey(t)),2),n=e[0],i=e[1],r=this.map[t];if("ロ"==r){var o=X.grayscale(.1),s=this.rainbow.getSpriteAnim([o,Math.clamp(o-.5,0,1)],0,.1);this.display.draw(n,i,r,s)}}}},{key:"drawMapFieldOfView",value:function(){var t=this,e=new F.PreciseShadowcasting((function(e,n){var i=e+","+n;return i in t.map&&" "===t.map[i]}));this.fov={},e.compute(this.player.x,this.player.y,10,(function(e,n,i,r){var o=X.key(e,n),s=Rt(t.worldToScreen([e,n]),2);s[0],s[1],t.fov[o]=i,t.knownMap[o]=1}))}},{key:"drawCompositeMap",value:function(){var t=this.hasMap?this.map:this.knownMap;for(var e in t){var n=Rt(this.worldToScreen(X.parseKey(e)),2),i=n[0],o=n[1],s=q.toHex(X.minGray),a=q.toHex(X.minGray);if("#"==this.map[e]){if(e in this.fov){var l=this.rainbow.getSpriteAnim([1,1-r.a.getUniform()/10],0,1);s=X.grayscale((1-this.fov[e]/10)*l),a=X.grayscale((1-this.fov[e]/10)*l*.5)}var u=[.2,.1];this.display.draw(i-u[0],o-u[1],".",s,"black"),this.display.draw(i+u[0],o+u[1],";",a,"black")}}}},{key:"draw",value:function(){var t=this;this.display.clear(),this.drawMapFieldOfView(),this.drawCompositeMap(),this.items.forEach((function(e){return e.draw(t.fov)})),this.player.draw(),this.monsters.forEach((function(e){return e.draw(t.fov)})),this.status.monsters=this.monsters.filter((function(e){return e.isVisible(t.fov)}));var e=this.items.filter((function(e){return e.isVisible(t.fov)})).reduce((function(t,e){return t[e.name]=e,t}),{}),n=Object.keys(e).sort();this.status.items=n.map((function(t){return e[t]})),this.dialogue&&this.dialogue.draw(),this.messages&&this.messages.draw(),this.status&&this.status.draw(),this.drawer.drawLine(0,this.statusHeight,this.width,this.statusHeight,"-","-")}},{key:"worldToScreen",value:function(t){var e=Rt(t,2);return[e[0],e[1]+this.statusHeight+1]}},{key:"pushVariables",value:function(){this.dialogue.story.variablesState.points=this.player.points,this.dialogue.story.variablesState.size=this.player.size,this.dialogue.story.variablesState.time=this.maxTime,this.dialogue.story.variablesState.size_cost=this.player.upgrade_size_pts}},{key:"pathToPlayer",value:function(t,e,n){var i=[];return this.ignoreItemId=n,this.monsterPathFinder.compute(t,e,(function(t,e){return i.push([t,e])})),this.ignoreItemId=-1,i.shift(),i}}])&&jt(e.prototype,n),i&&jt(e,i),t}();Gt(Ut,"debug",!1),document.body.onload=function(){new Ut}}]);